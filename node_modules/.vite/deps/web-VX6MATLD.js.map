{
  "version": 3,
  "sources": ["../../@aparajita/capacitor-biometric-auth/dist/esm/web.js"],
  "sourcesContent": ["import { BiometricAuthBase } from './base.js';\nimport { BiometryError, BiometryErrorType, BiometryType, } from './definitions.js';\nimport { getBiometryName } from './web-utils.js';\n/* eslint-disable @typescript-eslint/require-await */\nexport class BiometricAuthWeb extends BiometricAuthBase {\n    constructor() {\n        super(...arguments);\n        this.biometryType = BiometryType.none;\n        this.biometryTypes = [];\n        this.biometryIsEnrolled = false;\n        this.deviceIsSecure = false;\n    }\n    // On the web, return the fake biometry set by setBiometryType().\n    async checkBiometry() {\n        const hasBiometry = this.biometryType !== BiometryType.none;\n        const available = hasBiometry && this.biometryIsEnrolled;\n        let reason = '';\n        let code = BiometryErrorType.none;\n        if (!hasBiometry) {\n            reason = 'No biometry is available';\n            code = BiometryErrorType.biometryNotAvailable;\n        }\n        else if (!this.biometryIsEnrolled) {\n            reason = 'Biometry is not enrolled';\n            code = BiometryErrorType.biometryNotEnrolled;\n        }\n        return {\n            isAvailable: available,\n            strongBiometryIsAvailable: this.biometryIsEnrolled && this.hasStrongBiometry(),\n            biometryType: this.biometryType,\n            biometryTypes: this.biometryTypes,\n            deviceIsSecure: this.deviceIsSecure,\n            reason,\n            code,\n        };\n    }\n    hasStrongBiometry() {\n        return this.biometryTypes.some((type) => type === BiometryType.faceId ||\n            type === BiometryType.touchId ||\n            type === BiometryType.fingerprintAuthentication);\n    }\n    // On the web, fake authentication with a confirm dialog.\n    async internalAuthenticate(options) {\n        const result = await this.checkBiometry();\n        // First try biometry if available.\n        if (result.isAvailable &&\n            // oxlint-disable-next-line no-alert\n            confirm(\n            // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing -- we want to use the default value if options?.reason is an empty string\n            (options === null || options === void 0 ? void 0 : options.reason) ||\n                `Authenticate with ${result.biometryTypes\n                    .map((type) => getBiometryName(type))\n                    .join(' or ')}?`)) {\n            return;\n        }\n        if (options === null || options === void 0 ? void 0 : options.allowDeviceCredential) {\n            // Either biometry is not available, or the user declined to use it\n            // and device security is allowed.\n            if (result.deviceIsSecure) {\n                // oxlint-disable-next-line no-alert\n                if (confirm('Authenticate with device security?')) {\n                    return;\n                }\n                throw new BiometryError('User cancelled', BiometryErrorType.userCancel);\n            }\n            else if (result.isAvailable) {\n                throw new BiometryError('Device is not secure', BiometryErrorType.noDeviceCredential);\n            }\n        }\n        else if (!result.isAvailable) {\n            // Biometry is not available and device security is not allowed.\n            throw result.biometryType === BiometryType.none\n                ? new BiometryError('Biometry is not available', BiometryErrorType.biometryNotAvailable)\n                : new BiometryError('Biometry is not enrolled', BiometryErrorType.biometryNotEnrolled);\n        }\n        // The user declined to use biometry and device credentials not allowed.\n        throw new BiometryError('User cancelled', BiometryErrorType.userCancel);\n    }\n    // Web only, used for simulating biometric authentication.\n    async setBiometryType(type) {\n        if (type === undefined) {\n            return;\n        }\n        const types = Array.isArray(type) ? type : [type];\n        this.biometryTypes = [];\n        this.biometryType = BiometryType.none;\n        if (types.length === 0) {\n            return;\n        }\n        if (isBiometryTypes(types)) {\n            this.biometryType = types[0];\n            if (this.biometryType !== BiometryType.none) {\n                this.biometryTypes = types;\n            }\n        }\n        else {\n            for (const [i, theType] of types.entries()) {\n                if (isBiometryType(theType)) {\n                    if (this.biometryType === BiometryType.none) {\n                        this.biometryTypes = [];\n                    }\n                    else {\n                        this.biometryTypes.push(theType);\n                    }\n                    if (i === 0) {\n                        this.biometryType = theType;\n                    }\n                }\n            }\n        }\n    }\n    // Web only, used for simulating device unlock security.\n    async setBiometryIsEnrolled(enrolled) {\n        this.biometryIsEnrolled = enrolled;\n    }\n    // Web only, used for simulating device unlock security.\n    async setDeviceIsSecure(isSecure) {\n        this.deviceIsSecure = isSecure;\n    }\n}\nfunction isBiometryType(value) {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-type-assertion\n    return Object.values(BiometryType).includes(value);\n}\nfunction isBiometryTypes(value) {\n    return value.every((type) => isBiometryType(type));\n}\n/* eslint-enable @typescript-eslint/require-await */\n"],
  "mappings": ";;;;;;;;;;;;;;;;AAIO,IAAM,mBAAN,cAA+B,kBAAkB;AAAA,EACpD,cAAc;AACV,UAAM,GAAG,SAAS;AAClB,SAAK,eAAe,aAAa;AACjC,SAAK,gBAAgB,CAAC;AACtB,SAAK,qBAAqB;AAC1B,SAAK,iBAAiB;AAAA,EAC1B;AAAA;AAAA,EAEA,MAAM,gBAAgB;AAClB,UAAM,cAAc,KAAK,iBAAiB,aAAa;AACvD,UAAM,YAAY,eAAe,KAAK;AACtC,QAAI,SAAS;AACb,QAAI,OAAO,kBAAkB;AAC7B,QAAI,CAAC,aAAa;AACd,eAAS;AACT,aAAO,kBAAkB;AAAA,IAC7B,WACS,CAAC,KAAK,oBAAoB;AAC/B,eAAS;AACT,aAAO,kBAAkB;AAAA,IAC7B;AACA,WAAO;AAAA,MACH,aAAa;AAAA,MACb,2BAA2B,KAAK,sBAAsB,KAAK,kBAAkB;AAAA,MAC7E,cAAc,KAAK;AAAA,MACnB,eAAe,KAAK;AAAA,MACpB,gBAAgB,KAAK;AAAA,MACrB;AAAA,MACA;AAAA,IACJ;AAAA,EACJ;AAAA,EACA,oBAAoB;AAChB,WAAO,KAAK,cAAc,KAAK,CAAC,SAAS,SAAS,aAAa,UAC3D,SAAS,aAAa,WACtB,SAAS,aAAa,yBAAyB;AAAA,EACvD;AAAA;AAAA,EAEA,MAAM,qBAAqB,SAAS;AAChC,UAAM,SAAS,MAAM,KAAK,cAAc;AAExC,QAAI,OAAO;AAAA,IAEP;AAAA;AAAA,OAEC,YAAY,QAAQ,YAAY,SAAS,SAAS,QAAQ,WACvD,qBAAqB,OAAO,cACvB,IAAI,CAAC,SAAS,gBAAgB,IAAI,CAAC,EACnC,KAAK,MAAM,CAAC;AAAA,IAAG,GAAG;AAC3B;AAAA,IACJ;AACA,QAAI,YAAY,QAAQ,YAAY,SAAS,SAAS,QAAQ,uBAAuB;AAGjF,UAAI,OAAO,gBAAgB;AAEvB,YAAI,QAAQ,oCAAoC,GAAG;AAC/C;AAAA,QACJ;AACA,cAAM,IAAI,cAAc,kBAAkB,kBAAkB,UAAU;AAAA,MAC1E,WACS,OAAO,aAAa;AACzB,cAAM,IAAI,cAAc,wBAAwB,kBAAkB,kBAAkB;AAAA,MACxF;AAAA,IACJ,WACS,CAAC,OAAO,aAAa;AAE1B,YAAM,OAAO,iBAAiB,aAAa,OACrC,IAAI,cAAc,6BAA6B,kBAAkB,oBAAoB,IACrF,IAAI,cAAc,4BAA4B,kBAAkB,mBAAmB;AAAA,IAC7F;AAEA,UAAM,IAAI,cAAc,kBAAkB,kBAAkB,UAAU;AAAA,EAC1E;AAAA;AAAA,EAEA,MAAM,gBAAgB,MAAM;AACxB,QAAI,SAAS,QAAW;AACpB;AAAA,IACJ;AACA,UAAM,QAAQ,MAAM,QAAQ,IAAI,IAAI,OAAO,CAAC,IAAI;AAChD,SAAK,gBAAgB,CAAC;AACtB,SAAK,eAAe,aAAa;AACjC,QAAI,MAAM,WAAW,GAAG;AACpB;AAAA,IACJ;AACA,QAAI,gBAAgB,KAAK,GAAG;AACxB,WAAK,eAAe,MAAM,CAAC;AAC3B,UAAI,KAAK,iBAAiB,aAAa,MAAM;AACzC,aAAK,gBAAgB;AAAA,MACzB;AAAA,IACJ,OACK;AACD,iBAAW,CAAC,GAAG,OAAO,KAAK,MAAM,QAAQ,GAAG;AACxC,YAAI,eAAe,OAAO,GAAG;AACzB,cAAI,KAAK,iBAAiB,aAAa,MAAM;AACzC,iBAAK,gBAAgB,CAAC;AAAA,UAC1B,OACK;AACD,iBAAK,cAAc,KAAK,OAAO;AAAA,UACnC;AACA,cAAI,MAAM,GAAG;AACT,iBAAK,eAAe;AAAA,UACxB;AAAA,QACJ;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AAAA;AAAA,EAEA,MAAM,sBAAsB,UAAU;AAClC,SAAK,qBAAqB;AAAA,EAC9B;AAAA;AAAA,EAEA,MAAM,kBAAkB,UAAU;AAC9B,SAAK,iBAAiB;AAAA,EAC1B;AACJ;AACA,SAAS,eAAe,OAAO;AAE3B,SAAO,OAAO,OAAO,YAAY,EAAE,SAAS,KAAK;AACrD;AACA,SAAS,gBAAgB,OAAO;AAC5B,SAAO,MAAM,MAAM,CAAC,SAAS,eAAe,IAAI,CAAC;AACrD;",
  "names": []
}
