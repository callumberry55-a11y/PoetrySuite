const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-2dP_p1EG.js","assets/index-CX-VgEhY.css"])))=>i.map(i=>d[i]);
import{r,_ as V,j as e,T as re,s as p,C as Ne,D as Ae,O as Te,g as ie,i as ge,M as ve,u as ze,U as Le,c as ye}from"./index-2dP_p1EG.js";import{K as ae,f as xe,d as me,g as fe,b as se,W as be,C as $e,H as ke,A as qe,e as Be,S as Ke,B as Oe,c as Ue,G as Me,a as we}from"./wallet-DehrIEnc.js";import{A as W}from"./activity-CciE9zHV.js";import{C as oe}from"./clock-DJOLL9Lo.js";import{P as De}from"./plus-BwuWPFcm.js";import{E as Pe}from"./eye-BXeyh3Pv.js";import{C as Q}from"./circle-check-big-Dekx_aag.js";import{T as Ee}from"./trash-2-oGW_IUac.js";import{R as pe}from"./refresh-cw-efhXDZ7z.js";import{D as ue}from"./dollar-sign-ICVN2oor.js";import{B as he,L as _e}from"./loader-circle-C-6CshF_.js";import{C as ce}from"./coins-XiO7lNo2.js";import{T as Se}from"./triangle-alert-BXrlFpw0.js";import{S as Re}from"./search-CwD-o-3E.js";import{S as Ve}from"./send-CguWdOWq.js";import{L as Ce}from"./lock-R6dZoUXY.js";function Je(){const[i,U]=r.useState([]),[d,T]=r.useState([]),[y,$]=r.useState({total_requests:0,requests_today:0,requests_this_hour:0,avg_response_time:0}),[E,R]=r.useState(!1),[f,_]=r.useState(""),[S,h]=r.useState(1e3),[j,L]=r.useState({read_poems:!0,read_public_profiles:!0,read_contests:!1,read_badges:!1,read_workshops:!1}),[q,M]=r.useState(null),[w,B]=r.useState(!1);r.useEffect(()=>{c(),o()},[]);const c=async()=>{try{const{supabase:l}=await V(async()=>{const{supabase:N}=await import("./index-2dP_p1EG.js").then(v=>v.a1);return{supabase:N}},__vite__mapDeps([0,1])),{data:x}=await l.from("external_api_keys").select("*").order("created_at",{ascending:!1});x&&U(x)}catch(l){console.error("Error loading API keys:",l)}},o=async()=>{try{const{supabase:l}=await V(async()=>{const{supabase:Y}=await import("./index-2dP_p1EG.js").then(J=>J.a1);return{supabase:Y}},__vite__mapDeps([0,1])),x=new Date,N=new Date(x.getFullYear(),x.getMonth(),x.getDate()),v=new Date(x.getFullYear(),x.getMonth(),x.getDate(),x.getHours()),{data:t,count:g}=await l.from("external_api_usage").select("*",{count:"exact"}),{count:z}=await l.from("external_api_usage").select("*",{count:"exact",head:!0}).gte("created_at",N.toISOString()),{count:P}=await l.from("external_api_usage").select("*",{count:"exact",head:!0}).gte("created_at",v.toISOString()),te=t!=null&&t.length?t.reduce((Y,J)=>Y+(J.response_time_ms||0),0)/t.length:0;$({total_requests:g||0,requests_today:z||0,requests_this_hour:P||0,avg_response_time:Math.round(te)})}catch(l){console.error("Error loading usage stats:",l)}},u=async l=>{try{const{supabase:x}=await V(async()=>{const{supabase:v}=await import("./index-2dP_p1EG.js").then(t=>t.a1);return{supabase:v}},__vite__mapDeps([0,1])),{data:N}=await x.from("external_api_usage").select("*").eq("api_key_id",l).order("created_at",{ascending:!1}).limit(50);N&&(T(N),B(!0))}catch(x){console.error("Error loading usage:",x)}},A=async()=>{if(f.trim())try{const{supabase:l}=await V(async()=>{const{supabase:g}=await import("./index-2dP_p1EG.js").then(z=>z.a1);return{supabase:g}},__vite__mapDeps([0,1])),{data:{user:x}}=await l.auth.getUser();if(!x)return;const N="sk_"+Array.from(crypto.getRandomValues(new Uint8Array(32))).map(g=>g.toString(16).padStart(2,"0")).join(""),v=N.substring(0,12),{error:t}=await l.from("external_api_keys").insert({name:f,key_hash:N,key_prefix:v,permissions:j,rate_limit_per_hour:S,created_by:x.id,is_active:!0});if(t)throw t;M(N),_(""),h(1e3),L({read_poems:!0,read_public_profiles:!0,read_contests:!1,read_badges:!1,read_workshops:!1}),c()}catch(l){console.error("Error generating API key:",l)}},C=async(l,x)=>{try{const{supabase:N}=await V(async()=>{const{supabase:v}=await import("./index-2dP_p1EG.js").then(t=>t.a1);return{supabase:v}},__vite__mapDeps([0,1]));await N.from("external_api_keys").update({is_active:!x}).eq("id",l),c()}catch(N){console.error("Error toggling key status:",N)}},n=async l=>{if(confirm("Are you sure you want to delete this API key? This action cannot be undone."))try{const{supabase:x}=await V(async()=>{const{supabase:N}=await import("./index-2dP_p1EG.js").then(v=>v.a1);return{supabase:N}},__vite__mapDeps([0,1]));await x.from("external_api_keys").delete().eq("id",l),c()}catch(x){console.error("Error deleting API key:",x)}},K=l=>{navigator.clipboard.writeText(l)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(ae,{className:"text-blue-600 dark:text-blue-400",size:24})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:i.filter(l=>l.is_active).length}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Active Keys"}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500 mt-1",children:[i.length," total"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(W,{className:"text-green-600 dark:text-green-400",size:24})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:y.total_requests.toLocaleString()}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total Requests"}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500 mt-1",children:[y.requests_today," today"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(re,{className:"text-purple-600 dark:text-purple-400",size:24})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:y.requests_this_hour}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Requests This Hour"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(oe,{className:"text-orange-600 dark:text-orange-400",size:24})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:y.avg_response_time}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Avg Response (ms)"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:"API Keys"}),e.jsxs("button",{onClick:()=>R(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(De,{size:18}),"New API Key"]})]}),i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ae,{className:"mx-auto mb-4 text-slate-300 dark:text-slate-600",size:48}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"No API Keys Yet"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Create your first API key to allow external access."}),e.jsx("button",{onClick:()=>R(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Create API Key"})]}):e.jsx("div",{className:"space-y-3",children:i.map(l=>e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg border border-slate-200 dark:border-slate-600",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:l.name}),e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${l.is_active?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400"}`,children:l.is_active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("code",{className:"text-sm font-mono text-slate-600 dark:text-slate-400 bg-white dark:bg-slate-800 px-2 py-1 rounded",children:[l.key_prefix,"..."]}),e.jsx("button",{onClick:()=>K(l.key_prefix),className:"p-1 hover:bg-slate-200 dark:hover:bg-slate-600 rounded transition-colors",title:"Copy prefix",children:e.jsx(xe,{size:14,className:"text-slate-600 dark:text-slate-400"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:Object.entries(l.permissions).map(([x,N])=>N&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded",children:x.replace("read_","").replace(/_/g," ")},x))}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:["Rate limit: ",l.rate_limit_per_hour,"/hour • Created ",new Date(l.created_at).toLocaleDateString(),l.last_used_at&&` • Last used ${new Date(l.last_used_at).toLocaleDateString()}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>u(l.id),className:"p-2 hover:bg-slate-200 dark:hover:bg-slate-600 rounded transition-colors",title:"View usage",children:e.jsx(Pe,{size:18,className:"text-slate-600 dark:text-slate-400"})}),e.jsx("button",{onClick:()=>C(l.id,l.is_active),className:"p-2 hover:bg-slate-200 dark:hover:bg-slate-600 rounded transition-colors",title:l.is_active?"Deactivate":"Activate",children:l.is_active?e.jsx(me,{size:18,className:"text-red-600 dark:text-red-400"}):e.jsx(Q,{size:18,className:"text-green-600 dark:text-green-400"})}),e.jsx("button",{onClick:()=>n(l.id),className:"p-2 hover:bg-red-100 dark:hover:bg-red-900/30 rounded transition-colors",title:"Delete",children:e.jsx(Ee,{size:18,className:"text-red-600 dark:text-red-400"})})]})]})},l.id))})]}),E&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-4",children:"Create New API Key"}),q?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Q,{className:"text-green-600 dark:text-green-400",size:20}),e.jsx("p",{className:"font-semibold text-green-900 dark:text-green-100",children:"API Key Created!"})]}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mb-3",children:"Copy this key now. You won't be able to see it again."}),e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-slate-800 p-3 rounded border border-green-300 dark:border-green-700",children:[e.jsx("code",{className:"flex-1 text-sm font-mono text-slate-900 dark:text-white break-all",children:q}),e.jsx("button",{onClick:()=>K(q),className:"flex-shrink-0 p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded transition-colors",title:"Copy",children:e.jsx(xe,{size:18,className:"text-slate-600 dark:text-slate-400"})})]})]}),e.jsx("button",{onClick:()=>{R(!1),M(null)},className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Done"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Key Name"}),e.jsx("input",{type:"text",value:f,onChange:l=>_(l.target.value),placeholder:"e.g., Mobile App API",className:"w-full px-4 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Rate Limit (requests per hour)"}),e.jsx("input",{type:"number",value:S,onChange:l=>h(parseInt(l.target.value)||1e3),className:"w-full px-4 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(j).map(([l,x])=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:N=>L({...j,[l]:N.target.checked}),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:l.replace("read_","Read ").replace(/_/g," ")})]},l))})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{R(!1),_("")},className:"flex-1 px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:A,disabled:!f.trim(),className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 dark:disabled:bg-slate-600 text-white rounded-lg transition-colors disabled:cursor-not-allowed",children:"Generate"})]})]})]})}),w&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-4xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"API Usage"}),e.jsx("button",{onClick:()=>B(!1),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded transition-colors",children:e.jsx(me,{size:20,className:"text-slate-600 dark:text-slate-400"})})]}),d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(W,{className:"mx-auto mb-4 text-slate-300 dark:text-slate-600",size:48}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"No usage records yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:"Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:"Method"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:"Endpoint"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:"IP"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:d.map(l=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/30",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-slate-900 dark:text-white whitespace-nowrap",children:new Date(l.created_at).toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded font-mono",children:l.method})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600 dark:text-slate-400 font-mono",children:l.endpoint}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded ${l.status_code>=200&&l.status_code<300?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":l.status_code>=400?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-400"}`,children:l.status_code})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600 dark:text-slate-400 font-mono",children:l.ip_address||"-"})]},l.id))})]})})]})})]})}function Ye(){const[i,U]=r.useState([]),[d,T]=r.useState(null),[y,$]=r.useState(null),[E,R]=r.useState(null),[f,_]=r.useState(!0),[S,h]=r.useState(!1),[j,L]=r.useState("overview");r.useEffect(()=>{q()},[]);const q=async()=>{try{_(!0);const{data:o}=await p.from("paas_billing_periods").select("*").order("period_start",{ascending:!1}).limit(50);U(o||[]);const{data:u}=await p.from("paas_api_usage").select("execution_time_ms, request_size, response_size");if(u&&u.length>0){const A={totalRequests:u.length,totalDataMB:u.reduce((C,n)=>C+(n.request_size+n.response_size)/1048576,0),totalCost:(o==null?void 0:o.reduce((C,n)=>C+parseFloat(n.final_cost_points||"0"),0))||0,avgExecutionTime:u.reduce((C,n)=>C+n.execution_time_ms,0)/u.length};R(A)}}catch(o){console.error("Error loading billing data:",o)}finally{_(!1)}},M=async o=>{try{const{data:u}=await p.from("paas_ai_banker_decisions").select("*").eq("billing_period_id",o).maybeSingle();$(u)}catch(u){console.error("Error loading AI decision:",u)}},w=async o=>{try{h(!0);const u=prompt("Enter admin API key to calculate billing:");if(!u)return;const A=await fetch("https://mablckeofkddwjgxhnbe.supabase.co/functions/v1/paas-billing-processor?action=calculate_billing",{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":u,Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1hYmxja2VvZmtkZHdqZ3hobmJlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNDUxNTQsImV4cCI6MjA4MTgyMTE1NH0.mO0bo8MtAF4RJUrCqQLYfz-BFbH8eUj5WmhCT2-hn-c"},body:JSON.stringify({action:"calculate_billing",billingPeriodId:o})});if(!A.ok){const n=await A.json();throw new Error(n.error||"Failed to calculate billing")}const C=await A.json();alert(`Billing calculated successfully!

Base Cost: ${C.data.pricing.baseCost.toFixed(2)} points
AI Adjustment: ${C.data.pricing.adjustmentFactor}x
Final Cost: ${C.data.pricing.finalCost.toFixed(2)} points

AI Reasoning: ${C.data.aiDecision.reasoning}`),await q()}catch(u){console.error("Error calculating billing:",u),alert("Failed to calculate billing: "+(u instanceof Error?u.message:"Unknown error"))}finally{h(!1)}},B=async o=>{try{h(!0);const u=prompt("Enter admin API key to process payment:");if(!u)return;const A=await fetch("https://mablckeofkddwjgxhnbe.supabase.co/functions/v1/paas-billing-processor?action=process_payment",{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":u,Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1hYmxja2VvZmtkZHdqZ3hobmJlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNDUxNTQsImV4cCI6MjA4MTgyMTE1NH0.mO0bo8MtAF4RJUrCqQLYfz-BFbH8eUj5WmhCT2-hn-c"},body:JSON.stringify({action:"process_payment",billingPeriodId:o})});if(!A.ok){const n=await A.json();throw new Error(n.error||"Failed to process payment")}const C=await A.json();alert(`Payment processed successfully!

Amount Paid: ${C.data.amountPaid.toFixed(2)} points
New Balance: ${C.data.newBalance.toFixed(2)} points`),await q()}catch(u){console.error("Error processing payment:",u),alert("Failed to process payment: "+(u instanceof Error?u.message:"Unknown error"))}finally{h(!1)}},c=o=>{switch(o){case"paid":return e.jsx(Q,{className:"w-5 h-5 text-green-500"});case"calculated":return e.jsx(oe,{className:"w-5 h-5 text-blue-500"});case"pending":return e.jsx(se,{className:"w-5 h-5 text-yellow-500"});default:return e.jsx(oe,{className:"w-5 h-5 text-gray-500"})}};return f?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(pe,{className:"w-8 h-8 animate-spin text-blue-500"})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"API Billing & Usage"}),e.jsx("p",{className:"text-gray-600",children:"AI-powered billing system for PaaS API usage"})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>L("overview"),className:`px-6 py-3 rounded-lg font-medium transition-colors ${j==="overview"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(W,{className:"w-5 h-5 inline mr-2"}),"Overview"]}),e.jsxs("button",{onClick:()=>L("periods"),className:`px-6 py-3 rounded-lg font-medium transition-colors ${j==="periods"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(Ne,{className:"w-5 h-5 inline mr-2"}),"Billing Periods"]}),e.jsxs("button",{onClick:()=>L("usage"),className:`px-6 py-3 rounded-lg font-medium transition-colors ${j==="usage"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(re,{className:"w-5 h-5 inline mr-2"}),"Usage Stats"]})]}),j==="overview"&&E&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-gray-600 text-sm font-medium",children:"Total Requests"}),e.jsx(W,{className:"w-5 h-5 text-blue-500"})]}),e.jsx("p",{className:"text-3xl font-bold",children:E.totalRequests.toLocaleString()})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-gray-600 text-sm font-medium",children:"Data Transferred"}),e.jsx(Ae,{className:"w-5 h-5 text-green-500"})]}),e.jsxs("p",{className:"text-3xl font-bold",children:[E.totalDataMB.toFixed(2)," MB"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-gray-600 text-sm font-medium",children:"Total Cost"}),e.jsx(ue,{className:"w-5 h-5 text-purple-500"})]}),e.jsxs("p",{className:"text-3xl font-bold",children:[E.totalCost.toFixed(2)," pts"]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["≈ £",(E.totalCost*.75).toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-gray-600 text-sm font-medium",children:"Avg Response Time"}),e.jsx(oe,{className:"w-5 h-5 text-orange-500"})]}),e.jsxs("p",{className:"text-3xl font-bold",children:[E.avgExecutionTime.toFixed(0),"ms"]})]})]}),j==="periods"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-bold",children:"Billing Periods"})}),e.jsxs("div",{className:"divide-y divide-gray-200",children:[i.map(o=>e.jsx("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[c(o.status),e.jsxs("span",{className:"font-mono text-sm text-gray-500",children:[new Date(o.period_start).toLocaleDateString()," - ",new Date(o.period_end).toLocaleDateString()]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${o.status==="paid"?"bg-green-100 text-green-700":o.status==="calculated"?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700"}`,children:o.status.toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Requests"}),e.jsx("p",{className:"text-lg font-semibold",children:o.total_requests.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Data Transfer"}),e.jsxs("p",{className:"text-lg font-semibold",children:[parseFloat(String(o.total_data_transferred_mb||"0")).toFixed(2)," MB"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Base Cost"}),e.jsxs("p",{className:"text-lg font-semibold",children:[parseFloat(String(o.base_cost_points||"0")).toFixed(2)," pts"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Final Cost"}),e.jsxs("p",{className:"text-lg font-bold text-purple-600",children:[parseFloat(String(o.final_cost_points||"0")).toFixed(2)," pts"]})]})]}),o.ai_reasoning&&e.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(he,{className:"w-5 h-5 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"AI Banker Analysis"}),e.jsx("p",{className:"text-sm text-blue-700",children:o.ai_reasoning})]})]})})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[o.status==="pending"&&e.jsxs("button",{onClick:()=>w(o.id),disabled:S,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(he,{className:"w-4 h-4 inline mr-2"}),"Calculate"]}),o.status==="calculated"&&e.jsxs("button",{onClick:()=>B(o.id),disabled:S,className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(fe,{className:"w-4 h-4 inline mr-2"}),"Process Payment"]}),e.jsx("button",{onClick:()=>{T(o),M(o.id)},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Details"})]})]})},o.id)),i.length===0&&e.jsxs("div",{className:"p-12 text-center text-gray-500",children:[e.jsx(Ne,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No billing periods found"})]})]})]}),d&&y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold",children:"AI Banker Decision Details"}),e.jsx("button",{onClick:()=>{T(null),$(null)},className:"text-gray-500 hover:text-gray-700",children:"×"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Usage Summary"}),e.jsx("pre",{className:"bg-gray-50 p-4 rounded-lg text-sm overflow-x-auto",children:JSON.stringify(y.usage_summary,null,2)})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"AI Analysis"}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsx("p",{className:"text-sm",children:y.ai_analysis})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Base Cost"}),e.jsxs("p",{className:"text-lg font-semibold",children:[y.base_calculation.toFixed(2)," pts"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"AI Adjustment"}),e.jsxs("p",{className:"text-lg font-semibold",children:[y.ai_adjustment_factor,"x"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Final Cost"}),e.jsxs("p",{className:"text-lg font-bold text-purple-600",children:[y.final_cost.toFixed(2)," pts"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Reasoning"}),e.jsx("p",{className:"text-sm text-gray-700",children:y.reasoning})]})]})]})})]})}const Ge={activity:W,"credit-card":fe,server:Ke,code:Be,"alert-circle":se,wallet:be,coins:ue};function He(){const[i,U]=r.useState([]),[d,T]=r.useState(null),[y,$]=r.useState(null),[E,R]=r.useState([]),[f,_]=r.useState([]),[S,h]=r.useState(!0),[j,L]=r.useState("overview"),[q,M]=r.useState(!1),[w,B]=r.useState(null),[c,o]=r.useState({allocationPercentage:0,budgetLimit:0,autoRefillEnabled:!1,autoRefillThreshold:0,autoRefillAmount:0});r.useEffect(()=>{u(),C()},[]);const u=async()=>{try{h(!0);const{data:{user:t}}=await p.auth.getUser();if(!t)return;const{data:g}=await p.from("paas_developers").select("id").eq("user_id",t.id).maybeSingle();if(!g)return;const{data:z}=await p.from("paas_developer_reserves").select(`
          *,
          paas_reserve_categories (*)
        `).eq("developer_id",g.id).eq("is_active",!0).order("created_at",{ascending:!0});U(z||[]);const{data:P}=await p.from("paas_reserve_ai_recommendations").select("*").eq("developer_id",g.id).eq("applied",!1).order("created_at",{ascending:!1}).limit(1);P&&P.length>0&&(T(P[0]),M(!0))}catch(t){console.error("Error loading reserves:",t)}finally{h(!1)}},A=async t=>{try{const{data:g}=await p.from("paas_reserve_transactions").select("*").eq("reserve_id",t).order("created_at",{ascending:!1}).limit(50);R(g||[]);const{data:z}=await p.from("paas_reserve_allocations").select("*").eq("reserve_id",t).order("created_at",{ascending:!1}).limit(50);_(z||[])}catch(g){console.error("Error loading history:",g)}},C=()=>{const t=p.channel("developer_reserves_changes").on("postgres_changes",{event:"*",schema:"public",table:"paas_developer_reserves"},()=>u()).on("postgres_changes",{event:"*",schema:"public",table:"paas_reserve_ai_recommendations"},()=>u()).subscribe();return()=>{p.removeChannel(t)}},n=async()=>{if(d)try{const{data:{user:t}}=await p.auth.getUser();if(!t)return;const{data:g}=await p.from("paas_developers").select("id").eq("user_id",t.id).maybeSingle();if(!g)return;const z=d.recommended_allocations;for(const P of i){const te=P.paas_reserve_categories.name,Y=z[te];Y!==void 0&&await p.from("paas_developer_reserves").update({allocation_percentage:Y}).eq("id",P.id)}await p.from("paas_reserve_ai_recommendations").update({applied:!0,applied_at:new Date().toISOString()}).eq("id",d.id),M(!1),await u(),alert("AI recommendation applied successfully!")}catch(t){console.error("Error applying AI recommendation:",t),alert("Failed to apply recommendation")}},K=async()=>{if(w)try{const{error:t}=await p.from("paas_developer_reserves").update({allocation_percentage:c.allocationPercentage,budget_limit_points:c.budgetLimit||null,auto_refill_enabled:c.autoRefillEnabled,auto_refill_threshold:c.autoRefillThreshold,auto_refill_amount:c.autoRefillAmount,updated_at:new Date().toISOString()}).eq("id",w.id);if(t)throw t;B(null),await u(),alert("Settings updated successfully!")}catch(t){console.error("Error updating settings:",t),alert("Failed to update settings")}},l=t=>Ge[t]||be,x=i.reduce((t,g)=>t+parseFloat(g.balance_points.toString()),0),N=i.reduce((t,g)=>t+parseFloat(g.total_allocated.toString()),0),v=i.reduce((t,g)=>t+parseFloat(g.total_spent.toString()),0);return S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(pe,{className:"w-8 h-8 animate-spin text-blue-500"})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Developer Reserve Pools"}),e.jsx("p",{className:"text-gray-600",children:"Manage and allocate your funding across different categories"})]}),q&&d&&e.jsx("div",{className:"mb-6 bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(he,{className:"w-8 h-8 text-blue-500 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"AI Banker Recommendation"}),e.jsx("p",{className:"text-gray-700 mb-4",children:d.reasoning}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-4",children:Object.entries(d.recommended_allocations).map(([t,g])=>e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:t.replace("_"," ").toUpperCase()}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[g,"%"]})]},t))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Apply Recommendation"}),e.jsx("button",{onClick:()=>M(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Dismiss"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-gray-600 text-sm font-medium",children:"Total Reserve Balance"}),e.jsx(be,{className:"w-5 h-5 text-green-500"})]}),e.jsxs("p",{className:"text-3xl font-bold",children:[x.toFixed(2)," pts"]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["≈ £",(x*.75).toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-gray-600 text-sm font-medium",children:"Total Allocated"}),e.jsx(re,{className:"w-5 h-5 text-blue-500"})]}),e.jsxs("p",{className:"text-3xl font-bold",children:[N.toFixed(2)," pts"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-gray-600 text-sm font-medium",children:"Total Spent"}),e.jsx(ue,{className:"w-5 h-5 text-purple-500"})]}),e.jsxs("p",{className:"text-3xl font-bold",children:[v.toFixed(2)," pts"]})]})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>L("overview"),className:`px-6 py-3 rounded-lg font-medium transition-colors ${j==="overview"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx($e,{className:"w-5 h-5 inline mr-2"}),"Overview"]}),e.jsxs("button",{onClick:()=>L("settings"),className:`px-6 py-3 rounded-lg font-medium transition-colors ${j==="settings"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(Te,{className:"w-5 h-5 inline mr-2"}),"Settings"]}),e.jsxs("button",{onClick:()=>L("history"),className:`px-6 py-3 rounded-lg font-medium transition-colors ${j==="history"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(ke,{className:"w-5 h-5 inline mr-2"}),"History"]})]}),j==="overview"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(t=>{const g=l(t.paas_reserve_categories.icon),z=t.budget_limit_points?parseFloat(t.total_spent.toString())/parseFloat(t.budget_limit_points.toString())*100:0;return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-50 rounded-lg",children:e.jsx(g,{className:"w-6 h-6 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:t.paas_reserve_categories.display_name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.allocation_percentage,"% allocation"]})]})]})}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:t.paas_reserve_categories.description}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Balance"}),e.jsxs("span",{className:"text-lg font-bold",children:[parseFloat(t.balance_points.toString()).toFixed(2)," pts"]})]})}),e.jsx("div",{children:e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Allocated"}),e.jsxs("span",{className:"text-sm font-semibold",children:[parseFloat(t.total_allocated.toString()).toFixed(2)," pts"]})]})}),e.jsx("div",{children:e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Spent"}),e.jsxs("span",{className:"text-sm font-semibold",children:[parseFloat(t.total_spent.toString()).toFixed(2)," pts"]})]})}),t.budget_limit_points&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Budget Utilization"}),e.jsxs("span",{className:"text-sm font-semibold",children:[z.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${z>80?"bg-red-500":z>60?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(z,100)}%`}})})]}),t.auto_refill_enabled&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-2",children:e.jsxs("p",{className:"text-xs text-green-700",children:[e.jsx(Q,{className:"w-3 h-3 inline mr-1"}),"Auto-refill enabled"]})})]}),e.jsxs("button",{onClick:()=>{$(t),A(t.id),L("history")},className:"mt-4 w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:["View Details",e.jsx(qe,{className:"w-4 h-4 inline ml-2"})]})]})},t.id)})}),j==="settings"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-bold",children:"Reserve Settings"})}),e.jsx("div",{className:"divide-y divide-gray-200",children:i.map(t=>{const g=l(t.paas_reserve_categories.icon),z=(w==null?void 0:w.id)===t.id;return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"w-6 h-6 text-blue-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:t.paas_reserve_categories.display_name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.paas_reserve_categories.description})]})]}),!z&&e.jsx("button",{onClick:()=>{B(t),o({allocationPercentage:t.allocation_percentage,budgetLimit:t.budget_limit_points||0,autoRefillEnabled:t.auto_refill_enabled,autoRefillThreshold:t.auto_refill_threshold,autoRefillAmount:t.auto_refill_amount})},className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Edit"})]}),z?e.jsxs("div",{className:"space-y-4 bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Allocation Percentage"}),e.jsx("input",{type:"number",min:"0",max:"100",value:c.allocationPercentage,onChange:P=>o({...c,allocationPercentage:parseFloat(P.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Budget Limit (points)"}),e.jsx("input",{type:"number",min:"0",value:c.budgetLimit,onChange:P=>o({...c,budgetLimit:parseFloat(P.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:c.autoRefillEnabled,onChange:P=>o({...c,autoRefillEnabled:P.target.checked}),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Enable Auto-Refill"})]})}),c.autoRefillEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Refill Threshold (points)"}),e.jsx("input",{type:"number",min:"0",value:c.autoRefillThreshold,onChange:P=>o({...c,autoRefillThreshold:parseFloat(P.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Refill Amount (points)"}),e.jsx("input",{type:"number",min:"0",value:c.autoRefillAmount,onChange:P=>o({...c,autoRefillAmount:parseFloat(P.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:K,className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:"Save Changes"}),e.jsx("button",{onClick:()=>B(null),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"})]})]}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Allocation"}),e.jsxs("p",{className:"text-lg font-bold",children:[t.allocation_percentage,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Budget Limit"}),e.jsx("p",{className:"text-lg font-bold",children:t.budget_limit_points?`${t.budget_limit_points} pts`:"None"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Auto-Refill"}),e.jsx("p",{className:"text-lg font-bold",children:t.auto_refill_enabled?"Enabled":"Disabled"})]}),t.auto_refill_enabled&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Refill At"}),e.jsxs("p",{className:"text-lg font-bold",children:[t.auto_refill_threshold," pts"]})]})]})]},t.id)})})]}),j==="history"&&y&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Transaction History"}),e.jsx("p",{className:"text-sm text-gray-600",children:y.paas_reserve_categories.display_name})]}),e.jsxs("div",{className:"divide-y divide-gray-200 max-h-96 overflow-y-auto",children:[E.map(t=>e.jsx("div",{className:"p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.transaction_type.replace("_"," ").toUpperCase()}),e.jsx("p",{className:"text-sm text-gray-600",children:t.description||"No description"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(t.created_at).toLocaleString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`text-lg font-bold ${parseFloat(t.amount_points.toString())<0?"text-red-500":"text-green-500"}`,children:[parseFloat(t.amount_points.toString())>0?"+":"",parseFloat(t.amount_points.toString()).toFixed(2)," pts"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Balance: ",parseFloat(t.balance_after.toString()).toFixed(2)," pts"]})]})]})},t.id)),E.length===0&&e.jsxs("div",{className:"p-12 text-center text-gray-500",children:[e.jsx(ke,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No transactions yet"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-bold",children:"Allocation History"})}),e.jsxs("div",{className:"divide-y divide-gray-200 max-h-96 overflow-y-auto",children:[f.map(t=>e.jsx("div",{className:"p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.source.replace("_"," ").toUpperCase()}),e.jsx("p",{className:"text-sm text-gray-600",children:t.allocation_reason}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(t.created_at).toLocaleString()})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-lg font-bold text-green-500",children:["+",parseFloat(t.amount_points.toString()).toFixed(2)," pts"]})})]})},t.id)),f.length===0&&e.jsxs("div",{className:"p-12 text-center text-gray-500",children:[e.jsx(re,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No allocations yet"})]})]})]})]})]})}function Ze({onLogout:i}){const[U]=r.useState(!0),[d,T]=r.useState("overview"),[y,$]=r.useState([]),[E,R]=r.useState([]),[f,_]=r.useState([]),[S,h]=r.useState({totalDevelopers:0,activeDevelopers:0,totalPoints:0,totalRevenue:0,apiCalls24h:0}),[j,L]=r.useState([]),[q,M]=r.useState(""),[w,B]=r.useState("all"),[c,o]=r.useState(null),[u,A]=r.useState(!1),[C,n]=r.useState(""),[K,l]=r.useState("");r.useEffect(()=>(U&&(x(),t()),()=>{g()}),[U]);const x=async()=>{try{const{supabase:s}=await V(async()=>{const{supabase:X}=await import("./index-2dP_p1EG.js").then(ee=>ee.a1);return{supabase:X}},__vite__mapDeps([0,1])),{data:b}=await s.from("paas_developers").select("*").order("created_at",{ascending:!1}),{data:I}=await s.from("paas_security_events").select("*").order("created_at",{ascending:!1}).limit(50),{data:D}=await s.from("paas_transactions").select("*").order("created_at",{ascending:!1}).limit(100),{data:F}=await s.from("paas_point_accounts").select("balance_points, total_spent"),G=(F==null?void 0:F.reduce((X,ee)=>X+parseFloat(ee.balance_points),0))||0,Z=(F==null?void 0:F.reduce((X,ee)=>X+parseFloat(ee.total_spent),0))||0;$(b||[]),R(I||[]),_(D||[]),h({totalDevelopers:(b==null?void 0:b.length)||0,activeDevelopers:(b==null?void 0:b.filter(X=>X.subscription_status==="active").length)||0,totalPoints:G,totalRevenue:Z*.75,apiCalls24h:(D==null?void 0:D.filter(X=>{const ee=new Date(X.created_at),ne=new Date(Date.now()-1440*60*1e3);return ee>ne}).length)||0})}catch(s){console.error("Error loading PaaS data:",s)}},N=async s=>{try{const{supabase:b}=await V(async()=>{const{supabase:I}=await import("./index-2dP_p1EG.js").then(D=>D.a1);return{supabase:I}},__vite__mapDeps([0,1]));await b.from("paas_developers").update({is_verified:!0,verification_date:new Date().toISOString()}).eq("id",s),x()}catch(b){console.error("Error verifying developer:",b)}},v=async s=>{try{const{supabase:b}=await V(async()=>{const{supabase:I}=await import("./index-2dP_p1EG.js").then(D=>D.a1);return{supabase:I}},__vite__mapDeps([0,1]));await b.from("paas_developers").update({subscription_status:"suspended"}).eq("id",s),x()}catch(b){console.error("Error suspending developer:",b)}},t=async()=>{try{const{supabase:s}=await V(async()=>{const{supabase:G}=await import("./index-2dP_p1EG.js").then(Z=>Z.a1);return{supabase:G}},__vite__mapDeps([0,1])),b=s.channel("paas-developers-changes").on("postgres_changes",{event:"*",schema:"public",table:"paas_developers"},()=>{x()}).subscribe(),I=s.channel("paas-security-changes").on("postgres_changes",{event:"*",schema:"public",table:"paas_security_events"},()=>{x()}).subscribe(),D=s.channel("paas-transactions-changes").on("postgres_changes",{event:"*",schema:"public",table:"paas_transactions"},()=>{x()}).subscribe(),F=s.channel("paas-accounts-changes").on("postgres_changes",{event:"*",schema:"public",table:"paas_point_accounts"},()=>{x()}).subscribe();L([b,I,D,F])}catch(s){console.error("Error setting up real-time subscriptions:",s)}},g=async()=>{try{const{supabase:s}=await V(async()=>{const{supabase:b}=await import("./index-2dP_p1EG.js").then(I=>I.a1);return{supabase:b}},__vite__mapDeps([0,1]));j.forEach(b=>{s.removeChannel(b)}),L([])}catch(s){console.error("Error cleaning up subscriptions:",s)}},z=async s=>{try{const{supabase:b}=await V(async()=>{const{supabase:G}=await import("./index-2dP_p1EG.js").then(Z=>Z.a1);return{supabase:G}},__vite__mapDeps([0,1])),{data:I}=await b.from("paas_developers").select("*").eq("id",s).single(),{data:D}=await b.from("paas_point_accounts").select("*").eq("developer_id",s).maybeSingle(),{data:F}=await b.from("paas_api_keys").select("*").eq("developer_id",s);o({...I,point_account:D,api_keys:F||[]}),A(!0)}catch(b){console.error("Error loading developer details:",b)}},P=async()=>{if(!(!c||!C||!K))try{const{supabase:s}=await V(async()=>{const{supabase:G}=await import("./index-2dP_p1EG.js").then(Z=>Z.a1);return{supabase:G}},__vite__mapDeps([0,1])),b=parseFloat(C),{data:I}=await s.from("paas_point_accounts").select("balance_points").eq("developer_id",c.id).single(),D=parseFloat((I==null?void 0:I.balance_points)||"0"),F=D+b;await s.from("paas_transactions").insert({developer_id:c.id,transaction_type:"grant",amount_points:b,balance_before:D,balance_after:F,metadata:{reason:K,admin_action:!0}}),n(""),l(""),A(!1),x()}catch(s){console.error("Error adding points:",s)}},te=async s=>{try{const{supabase:b}=await V(async()=>{const{supabase:I}=await import("./index-2dP_p1EG.js").then(D=>D.a1);return{supabase:I}},__vite__mapDeps([0,1]));await b.from("paas_api_keys").update({is_active:!1}).eq("id",s),c&&z(c.id)}catch(b){console.error("Error revoking API key:",b)}},Y=()=>{const s={developers:y,transactions:f.slice(0,100),securityEvents:E.slice(0,50),stats:S,exportedAt:new Date().toISOString()},b=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),I=URL.createObjectURL(b),D=document.createElement("a");D.href=I,D.download=`paas-admin-export-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(I)},J=y.filter(s=>{const b=s.email.toLowerCase().includes(q.toLowerCase())||(s.organization_name||"").toLowerCase().includes(q.toLowerCase()),I=w==="all"||s.subscription_status===w;return b&&I});return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"text-blue-600 dark:text-blue-400",size:32}),e.jsx("h2",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"Stanzalink PaaS Admin"})]}),i&&e.jsx("button",{onClick:i,className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg font-medium transition-colors",children:"Logout"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ge,{className:"text-blue-600 dark:text-blue-400",size:24}),e.jsx("span",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:S.totalDevelopers})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total Developers"}),e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:[S.activeDevelopers," active"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ce,{className:"text-amber-600 dark:text-amber-400",size:24}),e.jsx("span",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:S.totalPoints.toLocaleString()})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total Points"}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:["£",(S.totalPoints*.75).toFixed(2)," value"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ue,{className:"text-green-600 dark:text-green-400",size:24}),e.jsxs("span",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:["£",S.totalRevenue.toFixed(2)]})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total Revenue"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"£0.75 per point spent"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(re,{className:"text-blue-600 dark:text-blue-400",size:24}),e.jsx("span",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:S.apiCalls24h})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"API Calls (24h)"}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:"Active system"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm mb-8",children:[e.jsx("div",{className:"border-b border-slate-200 dark:border-slate-700 overflow-x-auto",children:e.jsxs("div",{className:"flex gap-2 px-4 md:gap-4 md:px-6 min-w-max md:min-w-0",children:[e.jsxs("button",{onClick:()=>T("overview"),className:`py-3 px-3 md:py-4 md:px-4 border-b-2 font-medium transition-colors whitespace-nowrap flex items-center gap-2 ${d==="overview"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(W,{size:18}),e.jsx("span",{children:"Overview"})]}),e.jsxs("button",{onClick:()=>T("developers"),className:`py-3 px-3 md:py-4 md:px-4 border-b-2 font-medium transition-colors whitespace-nowrap flex items-center gap-2 ${d==="developers"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(ge,{size:18}),e.jsx("span",{children:"Developers"})]}),e.jsxs("button",{onClick:()=>T("security"),className:`py-3 px-3 md:py-4 md:px-4 border-b-2 font-medium transition-colors whitespace-nowrap flex items-center gap-2 ${d==="security"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(Se,{size:18}),e.jsx("span",{children:"Security"})]}),e.jsxs("button",{onClick:()=>T("transactions"),className:`py-3 px-3 md:py-4 md:px-4 border-b-2 font-medium transition-colors whitespace-nowrap flex items-center gap-2 ${d==="transactions"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(ce,{size:18}),e.jsx("span",{children:"Transactions"})]}),e.jsxs("button",{onClick:()=>T("api-keys"),className:`py-3 px-3 md:py-4 md:px-4 border-b-2 font-medium transition-colors whitespace-nowrap flex items-center gap-2 ${d==="api-keys"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(ae,{size:18}),e.jsx("span",{children:"External API"})]}),e.jsxs("button",{onClick:()=>T("billing"),className:`py-3 px-3 md:py-4 md:px-4 border-b-2 font-medium transition-colors whitespace-nowrap flex items-center gap-2 ${d==="billing"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(fe,{size:18}),e.jsx("span",{children:"Billing"})]}),e.jsxs("button",{onClick:()=>T("reserves"),className:`py-3 px-3 md:py-4 md:px-4 border-b-2 font-medium transition-colors whitespace-nowrap flex items-center gap-2 ${d==="reserves"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(be,{size:18}),e.jsx("span",{children:"Reserves"})]})]})}),e.jsxs("div",{className:"p-6",children:[d==="overview"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-900 dark:text-white mb-4",children:"System Health"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsx(Q,{className:"text-green-600 dark:text-green-400 mb-2",size:24}),e.jsx("p",{className:"font-semibold text-green-900 dark:text-green-100",children:"All Systems Operational"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mt-1",children:"99.9% uptime"})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx(W,{className:"text-blue-600 dark:text-blue-400 mb-2",size:24}),e.jsx("p",{className:"font-semibold text-blue-900 dark:text-blue-100",children:"API Response Time"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1",children:"Average 120ms"})]}),e.jsxs("div",{className:"p-4 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:[e.jsx(ie,{className:"text-amber-600 dark:text-amber-400 mb-2",size:24}),e.jsx("p",{className:"font-semibold text-amber-900 dark:text-amber-100",children:"Security Events"}),e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 mt-1",children:[E.length," total"]})]})]})]})}),d==="developers"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:"Developer Management"}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx("button",{onClick:()=>x(),className:"p-2 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg transition-colors",title:"Refresh",children:e.jsx(pe,{size:18})}),e.jsxs("button",{onClick:Y,className:"flex items-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm",children:[e.jsx(Ae,{size:18}),"Export"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{type:"text",value:q,onChange:s=>M(s.target.value),placeholder:"Search by email or organization...",className:"w-full pl-10 pr-4 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white"})]}),e.jsxs("select",{value:w,onChange:s=>B(s.target.value),className:"px-4 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"suspended",children:"Suspended"})]})]}),e.jsxs("div",{className:"space-y-3",children:[J.map(s=>e.jsx("div",{className:"p-4 border border-slate-200 dark:border-slate-700 rounded-lg hover:border-slate-300 dark:hover:border-slate-600 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:s.email})}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:[s.organization_name||"No organization"," • Joined ",new Date(s.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded ${s.subscription_status==="active"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":s.subscription_status==="suspended"?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-400"}`,children:s.subscription_status}),s.is_verified&&e.jsxs("span",{className:"px-2 py-1 text-xs rounded bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 flex items-center gap-1",children:[e.jsx(Q,{size:12}),"Verified"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>z(s.id),className:"px-3 py-1.5 bg-blue-500 hover:bg-blue-600 text-white text-sm rounded-lg transition-colors flex items-center gap-1",children:[e.jsx(Pe,{size:14}),"Details"]}),!s.is_verified&&e.jsxs("button",{onClick:()=>N(s.id),className:"px-3 py-1.5 bg-green-500 hover:bg-green-600 text-white text-sm rounded-lg transition-colors flex items-center gap-1",children:[e.jsx(Q,{size:14}),"Verify"]}),s.subscription_status!=="suspended"&&e.jsxs("button",{onClick:()=>v(s.id),className:"px-3 py-1.5 bg-red-500 hover:bg-red-600 text-white text-sm rounded-lg transition-colors flex items-center gap-1",children:[e.jsx(Oe,{size:14}),"Suspend"]})]})]})},s.id)),J.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ge,{className:"mx-auto mb-4 text-slate-300 dark:text-slate-600",size:48}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"No developers found"})]})]})]}),d==="security"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-900 dark:text-white mb-4",children:"Security Events"}),e.jsx("div",{className:"space-y-3",children:E.map(s=>e.jsx("div",{className:"p-4 border border-slate-200 dark:border-slate-700 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[s.severity==="critical"?e.jsx(me,{className:"text-red-600 dark:text-red-400 mt-1",size:20}):e.jsx(Se,{className:"text-amber-600 dark:text-amber-400 mt-1",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:s.event_type}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:s.reason}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-500 mt-1",children:new Date(s.created_at).toLocaleString()})]})]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${s.severity==="critical"?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400":s.severity==="high"?"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400":"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400"}`,children:s.severity})]})},s.id))})]}),d==="transactions"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-900 dark:text-white mb-4",children:"Recent Transactions"}),e.jsx("div",{className:"space-y-3",children:f.map(s=>e.jsx("div",{className:"p-4 border border-slate-200 dark:border-slate-700 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:s.transaction_type}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:s.endpoint||"No endpoint"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-500 mt-1",children:new Date(s.created_at).toLocaleString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`font-semibold ${parseFloat(s.amount_points.toString())>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[parseFloat(s.amount_points.toString())>0?"+":"",s.amount_points," points"]}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:["£",Math.abs(parseFloat(s.amount_gbp.toString())).toFixed(2)]})]})]})},s.id))})]}),d==="api-keys"&&e.jsx(Je,{}),d==="billing"&&e.jsx(Ye,{}),d==="reserves"&&e.jsx(He,{})]})]}),u&&c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:c.email}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:c.organization_name||"No organization"})]}),e.jsx("button",{onClick:()=>A(!1),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(me,{className:"text-slate-600 dark:text-slate-400",size:24})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(ie,{size:20}),"Account Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Status"}),e.jsx("span",{className:`inline-block mt-1 px-2 py-1 text-xs rounded ${c.subscription_status==="active"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-400"}`,children:c.subscription_status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Verified"}),e.jsx("p",{className:"font-medium text-slate-900 dark:text-white mt-1",children:c.is_verified?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Member Since"}),e.jsx("p",{className:"font-medium text-slate-900 dark:text-white mt-1",children:new Date(c.created_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Developer ID"}),e.jsx("p",{className:"font-mono text-xs text-slate-900 dark:text-white mt-1 break-all",children:c.id})]})]})]}),c.point_account&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(ce,{size:20}),"Point Account"]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Balance"}),e.jsx("p",{className:"text-lg font-bold text-slate-900 dark:text-white",children:parseFloat(c.point_account.balance_points.toString()).toLocaleString()}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"points"})]}),e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"GBP Value"}),e.jsxs("p",{className:"text-lg font-bold text-slate-900 dark:text-white",children:["£",parseFloat(c.point_account.balance_gbp.toString()).toFixed(2)]})]}),e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Total Earned"}),e.jsx("p",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:parseFloat(c.point_account.total_earned.toString()).toLocaleString()})]}),e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Total Spent"}),e.jsx("p",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:parseFloat(c.point_account.total_spent.toString()).toLocaleString()})]})]}),e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsx("h5",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-3",children:"Add Points"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"number",value:C,onChange:s=>n(s.target.value),placeholder:"Amount",className:"w-full px-3 py-2 bg-white dark:bg-slate-700 border border-blue-300 dark:border-blue-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white"}),e.jsx("input",{type:"text",value:K,onChange:s=>l(s.target.value),placeholder:"Reason for grant",className:"w-full px-3 py-2 bg-white dark:bg-slate-700 border border-blue-300 dark:border-blue-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white"}),e.jsx("button",{onClick:P,disabled:!C||!K,className:"w-full py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 dark:disabled:bg-slate-600 text-white rounded-lg font-medium transition-colors disabled:cursor-not-allowed",children:"Grant Points"})]})]})]}),c.api_keys&&c.api_keys.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(ae,{size:20}),"API Keys (",c.api_keys.length,")"]}),e.jsx("div",{className:"space-y-3",children:c.api_keys.map(s=>e.jsx("div",{className:"p-3 border border-slate-200 dark:border-slate-700 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:s.name}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 font-mono",children:[s.key_prefix,"..."]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${s.is_active?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400"}`,children:s.is_active?"Active":"Revoked"}),s.last_used_at&&e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Last used: ",new Date(s.last_used_at).toLocaleDateString()]})]})]}),s.is_active&&e.jsx("button",{onClick:()=>te(s.id),className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white text-sm rounded-lg transition-colors",children:"Revoke"})]})},s.id))})]})]})]})})]})}function Xe(){const[i,U]=r.useState(null),[d,T]=r.useState([]),[y,$]=r.useState(!0);if(r.useEffect(()=>{(async()=>{try{const[h,j]=await Promise.all([p.from("distribution_progress").select("*").order("started_at",{ascending:!1}).limit(1).maybeSingle(),p.from("economy_funds").select("fund_type, remaining_amount").order("fund_type")]);if(h.error)throw h.error;if(j.error)throw j.error;U(h.data),T(j.data||[])}catch(h){console.error("Error fetching data:",h)}finally{$(!1)}})();const S=p.channel("distribution_realtime").on("postgres_changes",{event:"*",schema:"public",table:"distribution_progress"},h=>{U(h.new),$(!1)}).on("postgres_changes",{event:"*",schema:"public",table:"economy_funds"},async()=>{const{data:h}=await p.from("economy_funds").select("fund_type, remaining_amount").order("fund_type");h&&T(h)}).subscribe();return()=>{p.removeChannel(S)}},[]),y)return e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(_e,{className:"w-6 h-6 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600 dark:text-gray-300",children:"Loading distribution status..."})]})});if(!i)return e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"No distribution progress available"})});const E=i.status==="running",R=i.status==="completed",f=i.status==="failed";return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Daily Distribution Progress"}),e.jsxs("div",{className:"flex items-center gap-2",children:[E&&e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-5 h-5 animate-spin text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-600",children:"Running"})]}),R&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-600",children:"Completed"})]}),f&&e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-sm font-medium text-red-600",children:"Failed"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-300 mb-2",children:[e.jsxs("span",{children:[i.processed_users.toLocaleString()," / ",i.total_users.toLocaleString()," users"]}),e.jsxs("span",{className:"font-semibold",children:[i.progress_percentage.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-300 rounded-full ${R?"bg-green-600":f?"bg-red-600":"bg-blue-600 animate-pulse"}`,style:{width:`${i.progress_percentage}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Points per User"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:i.points_per_user})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Total Distributed"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:i.total_points_distributed.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Batch Progress"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:[i.current_batch," / ",i.total_batches]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Distribution Date"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:new Date(i.distribution_date).toLocaleDateString()})]})]}),d.length>0&&e.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Economy Fund Balance (Real-Time)"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:d.map(_=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 capitalize mb-1",children:_.fund_type}),e.jsxs("p",{className:"text-sm font-bold text-gray-900 dark:text-white",children:["£",(Number(_.remaining_amount)/1e9).toFixed(2),"B"]})]},_.fund_type))}),e.jsx("div",{className:"mt-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium",children:["Total Annual Budget: £",(d.reduce((_,S)=>_+Number(S.remaining_amount),0)/1e9).toFixed(2),"B remaining"]})})]}),f&&i.error_message&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200 font-medium",children:"Error:"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:i.error_message})]}),i.completed_at&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:[R?"Completed":"Failed"," at"," ",new Date(i.completed_at).toLocaleTimeString()]})]})]})}function Qe(){const[i,U]=r.useState(null),[d,T]=r.useState(null),[y,$]=r.useState([]),[E,R]=r.useState([]),[f,_]=r.useState([]),[S,h]=r.useState(!1),[j,L]=r.useState(""),[q,M]=r.useState(null),[w,B]=r.useState("overview"),[c,o]=r.useState(!0),[u,A]=r.useState(!1),[C,n]=r.useState(null),[K,l]=r.useState(!1),[x,N]=r.useState(""),[v,t]=r.useState("user"),[g,z]=r.useState(""),[P,te]=r.useState(""),[Y,J]=r.useState(null),[s,b]=r.useState([]),[I,D]=r.useState(!1),[F,G]=r.useState(null);r.useEffect(()=>{Z()},[]),r.useEffect(()=>{if(!i)return;const a=p.channel("developer-realtime").on("postgres_changes",{event:"*",schema:"public",table:"paas_developers",filter:`id=eq.${i.id}`},m=>{m.eventType==="UPDATE"&&U(m.new)}).on("postgres_changes",{event:"*",schema:"public",table:"paas_point_accounts",filter:`developer_id=eq.${i.id}`},m=>{if(m.eventType==="UPDATE"||m.eventType==="INSERT"){const k=m.new;T(O=>{if(O&&k.balance_points!==O.balance_points){const H=parseFloat(k.balance_points.toString())-parseFloat(O.balance_points.toString());H!==0&&console.log(`Points ${H>0?"added":"deducted"}: ${Math.abs(H)}`)}return k})}}).on("postgres_changes",{event:"*",schema:"public",table:"paas_api_keys",filter:`developer_id=eq.${i.id}`},async m=>{if(m.eventType==="INSERT"){const{data:k}=await p.from("paas_api_keys").select("*").eq("developer_id",i.id).order("created_at",{ascending:!1});k&&$(k)}else m.eventType==="UPDATE"?$(k=>k.map(O=>O.id===m.new.id?m.new:O)):m.eventType==="DELETE"&&$(k=>k.filter(O=>O.id!==m.old.id))}).on("postgres_changes",{event:"INSERT",schema:"public",table:"paas_transactions",filter:`developer_id=eq.${i.id}`},async m=>{const{data:k}=await p.from("paas_transactions").select("*").eq("developer_id",i.id).order("created_at",{ascending:!1}).limit(20);if(k){R(k);const O=m.new;console.log(`New transaction: ${O.transaction_type} - ${O.amount_points} points`)}}).on("postgres_changes",{event:"INSERT",schema:"public",table:"feedback"},async()=>{const{data:m}=await p.from("feedback").select("*, user_profiles(display_name)").order("created_at",{ascending:!1}).limit(50);m&&(_(m),console.log("New feedback received"))}).subscribe(m=>{m==="SUBSCRIBED"?(l(!0),console.log("Real-time connected")):(m==="CLOSED"||m==="CHANNEL_ERROR")&&(l(!1),console.log("Real-time disconnected"))});return()=>{p.removeChannel(a),l(!1)}},[i]);const Z=async(a=!1)=>{try{a?A(!0):o(!0),n(null);const{data:{user:m}}=await p.auth.getUser();if(!m){n("Not authenticated"),o(!1),A(!1);return}const{data:k,error:O}=await p.from("paas_developers").select("*").eq("user_id",m.id).maybeSingle();if(O||!k){n("Developer profile not found"),o(!1),A(!1);return}const[{data:H},{data:le},{data:de},{data:Fe}]=await Promise.all([p.from("paas_point_accounts").select("*").eq("developer_id",k.id).maybeSingle(),p.from("paas_api_keys").select("*").eq("developer_id",k.id).order("created_at",{ascending:!1}),p.from("paas_transactions").select("*").eq("developer_id",k.id).order("created_at",{ascending:!1}).limit(20),p.from("feedback").select("*, user_profiles(display_name)").order("created_at",{ascending:!1}).limit(50)]);U(k),T(H||null),$(le||[]),R(de||[]),_(Fe||[]),o(!1),A(!1)}catch(m){console.error("Error loading developer data:",m),n("Failed to load dashboard data"),o(!1),A(!1)}},X=async()=>{if(!(!j.trim()||!i))try{const a="pk_"+Array.from(crypto.getRandomValues(new Uint8Array(32))).map(H=>H.toString(16).padStart(2,"0")).join(""),m=a.substring(0,12),{error:k}=await p.from("paas_api_keys").insert({developer_id:i.id,key_hash:a,key_prefix:m,name:j,is_active:!0}).select().single();if(k)throw k;M(a),L("");const{data:O}=await p.from("paas_api_keys").select("*").eq("developer_id",i.id).order("created_at",{ascending:!1});$(O||[])}catch(a){console.error("Error generating API key:",a)}},ee=async a=>{if(i)try{await p.from("paas_api_keys").update({is_active:!1}).eq("id",a);const{data:m}=await p.from("paas_api_keys").select("*").eq("developer_id",i.id).order("created_at",{ascending:!1});$(m||[])}catch(m){console.error("Error revoking API key:",m)}},ne=a=>{navigator.clipboard.writeText(a)},je=async()=>{if(x.trim())try{if(D(!0),b([]),G(null),v==="user"){const{data:a,error:m}=await p.from("user_profiles").select("user_id, username").or(`username.ilike.%${x}%`).limit(10);if(m)throw m;b(a||[])}else{const{data:a,error:m}=await p.from("paas_developers").select("id, email, organization_name, is_verified").ilike("email",`%${x}%`).limit(10);if(m)throw m;b(a||[])}}catch(a){console.error("Error searching recipients:",a),J({type:"error",message:"Failed to search recipients"})}finally{D(!1)}},Ie=async()=>{if(!F||!g||!P.trim()){J({type:"error",message:"Please fill all required fields"});return}const a=parseFloat(g);if(isNaN(a)||a<=0){J({type:"error",message:"Please enter a valid positive number"});return}try{const m=v==="user"?F.user_id:F.id;if(v==="user"){const{data:k,error:O}=await p.from("user_profiles").select("points_balance, points_earned_total").eq("user_id",m).maybeSingle();if(O)throw O;if(!k){J({type:"error",message:"User profile not found"});return}const H=(k.points_balance||0)+a,le=(k.points_earned_total||0)+a,{error:de}=await p.from("user_profiles").update({points_balance:H,points_earned_total:le}).eq("user_id",m);if(de)throw de;J({type:"success",message:`Successfully granted ${a} points to @${F.username}`})}else{const{data:k,error:O}=await p.from("paas_point_accounts").select("*").eq("developer_id",m).maybeSingle();if(O)throw O;if(!k)await p.from("paas_point_accounts").insert({developer_id:m,balance_points:a,balance_gbp:a*.75,total_earned:a,total_spent:0});else{const H=parseFloat(k.balance_points)+a,le=parseFloat(k.total_earned)+a;await p.from("paas_point_accounts").update({balance_points:H,balance_gbp:H*.75,total_earned:le}).eq("developer_id",m)}await p.from("paas_transactions").insert({developer_id:m,transaction_type:"admin_grant",amount_points:a,endpoint:"/admin/manual-grant",metadata:{reason:P,granted_by:i==null?void 0:i.email}}),J({type:"success",message:`Successfully granted ${a} points to ${F.organization_name||F.email}`})}N(""),z(""),te(""),G(null),b([]),setTimeout(()=>J(null),5e3)}catch(m){console.error("Error granting points:",m),J({type:"error",message:"Failed to grant points. Please try again."})}};return c?e.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(W,{className:"animate-spin mx-auto mb-4 text-blue-600",size:48}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Loading dashboard..."})]})}):C||!i?e.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[e.jsx(se,{className:"mx-auto mb-4 text-red-600",size:48}),e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:C||"Developer profile not found"}),e.jsx("button",{onClick:()=>Z(),className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Try Again"})]})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 p-4 sm:p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2",children:"Developer Dashboard"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:i.email}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("span",{className:`px-3 py-1 text-sm rounded-full ${i.subscription_status==="active"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-400"}`,children:i.subscription_status}),i.is_verified&&e.jsxs("span",{className:"px-3 py-1 text-sm rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 flex items-center gap-1",children:[e.jsx(Q,{size:14}),"Verified"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[K&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm text-green-700 dark:text-green-400 font-medium",children:"Live"})]}),e.jsxs("button",{onClick:()=>Z(!0),disabled:u,className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-300 border border-slate-300 dark:border-slate-600 rounded-lg transition-colors disabled:opacity-50",title:"Refresh data",children:[e.jsx(pe,{size:18,className:u?"animate-spin":""}),"Refresh"]})]})]}),e.jsxs("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:[e.jsx("button",{onClick:()=>B("overview"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${w==="overview"?"bg-blue-600 text-white":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:"Overview"}),e.jsx("button",{onClick:()=>B("keys"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${w==="keys"?"bg-blue-600 text-white":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:"API Keys"}),e.jsx("button",{onClick:()=>B("usage"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${w==="usage"?"bg-blue-600 text-white":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:"Usage"}),e.jsx("button",{onClick:()=>B("billing"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${w==="billing"?"bg-blue-600 text-white":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:"Billing"}),e.jsx("button",{onClick:()=>B("admin"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${w==="admin"?"bg-blue-600 text-white":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:"Admin"})]}),w==="overview"&&e.jsxs("div",{className:"space-y-6",children:[!i.is_verified&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(se,{className:"text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5",size:20}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-yellow-900 dark:text-yellow-100",children:"Account Verification Pending"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:"Your account is pending verification. Some features may be limited until verification is complete."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(ce,{className:"text-blue-600 dark:text-blue-400",size:24})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:d?parseFloat(d.balance_points.toString()).toLocaleString():"0"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Available Points"}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500 mt-1",children:["≈ £",d?parseFloat(d.balance_gbp.toString()).toFixed(2):"0.00"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(ae,{className:"text-green-600 dark:text-green-400",size:24})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:y.filter(a=>a.is_active).length}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Active API Keys"}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500 mt-1",children:[y.length," total"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(re,{className:"text-purple-600 dark:text-purple-400",size:24})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:d?parseFloat(d.total_earned.toString()).toLocaleString():"0"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total Earned"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(W,{className:"text-red-600 dark:text-red-400",size:24})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:d?parseFloat(d.total_spent.toString()).toLocaleString():"0"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total Spent"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white mb-4",children:"Getting Started"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold",children:"1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:"Create an API Key"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"Generate your first API key to start making requests to our platform."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold",children:"2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:"Read the Documentation"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"Check out our API documentation to learn how to integrate with our services."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold",children:"3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:"Monitor Your Usage"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"Track your API calls and point consumption in the Usage tab."})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(ve,{size:20}),"User Feedback"]}),e.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded-full",children:f.length})]}),f.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ve,{className:"mx-auto mb-3 text-slate-300 dark:text-slate-600",size:40}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"No feedback yet"})]}):e.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto",children:f.map(a=>{var m;return e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg border border-slate-200 dark:border-slate-600",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white text-sm line-clamp-1",children:a.title}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:[((m=a.user_profiles)==null?void 0:m.display_name)||"Anonymous"," • ",new Date(a.created_at).toLocaleDateString()]})]}),e.jsx("span",{className:`px-2 py-0.5 text-xs rounded whitespace-nowrap ${a.category==="bug"?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400":a.category==="feature"?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":a.category==="improvement"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-400"}`,children:a.category})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-2",children:a.message})]},a.id)})})]})]})]}),w==="keys"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:"API Keys"}),e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(De,{size:18}),"New Key"]})]}),y.length===0?e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-12 border border-slate-200 dark:border-slate-700 text-center",children:[e.jsx(ae,{className:"mx-auto mb-4 text-slate-300 dark:text-slate-600",size:48}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"No API Keys Yet"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Create your first API key to get started."}),e.jsx("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Create API Key"})]}):e.jsx("div",{className:"space-y-3",children:y.map(a=>e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:a.name}),e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${a.is_active?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400"}`,children:a.is_active?"Active":"Revoked"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("code",{className:"text-sm font-mono text-slate-600 dark:text-slate-400 bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded",children:[a.key_prefix,"..."]}),e.jsx("button",{onClick:()=>ne(a.key_prefix),className:"p-1 hover:bg-slate-100 dark:hover:bg-slate-700 rounded transition-colors",title:"Copy prefix",children:e.jsx(xe,{size:16,className:"text-slate-600 dark:text-slate-400"})})]}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:["Created ",new Date(a.created_at).toLocaleDateString(),a.last_used_at&&` • Last used ${new Date(a.last_used_at).toLocaleDateString()}`]})]}),a.is_active&&e.jsxs("button",{onClick:()=>ee(a.id),className:"flex items-center gap-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors",children:[e.jsx(Ee,{size:16}),"Revoke"]})]})},a.id))})]}),w==="usage"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:"Recent Transactions"}),E.length===0?e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-12 border border-slate-200 dark:border-slate-700 text-center",children:[e.jsx(W,{className:"mx-auto mb-4 text-slate-300 dark:text-slate-600",size:48}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"No Transactions Yet"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Your API usage will appear here."})]}):e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:"Endpoint"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:"Points"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:E.map(a=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/30 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-900 dark:text-white",children:new Date(a.created_at).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded ${a.transaction_type==="api_call"?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":a.transaction_type==="grant"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-400"}`,children:a.transaction_type})}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600 dark:text-slate-400",children:a.endpoint||"-"}),e.jsxs("td",{className:`px-6 py-4 whitespace-nowrap text-sm text-right font-medium ${a.amount_points>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[a.amount_points>0?"+":"",parseFloat(a.amount_points.toString()).toLocaleString()]})]},a.id))})]})})})]}),w==="billing"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:"Billing & Points"}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-4",children:"Point Balance"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Current Balance"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:d?parseFloat(d.balance_points.toString()).toLocaleString():"0"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-500 mt-1",children:"points"})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"GBP Value"}),e.jsxs("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:["£",d?parseFloat(d.balance_gbp.toString()).toFixed(2):"0.00"]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Lifetime Earned"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:d?parseFloat(d.total_earned.toString()).toLocaleString():"0"})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"How Points Work"}),e.jsxs("ul",{className:"text-sm text-blue-700 dark:text-blue-300 space-y-1",children:[e.jsx("li",{children:"• 1 point = £0.75"}),e.jsx("li",{children:"• Points are deducted for each API call based on usage"}),e.jsx("li",{children:"• Add more points to continue using the platform"}),e.jsx("li",{children:"• Contact support for bulk point purchases"})]})]})]})]}),w==="admin"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(Xe,{}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Me,{className:"text-blue-600 dark:text-blue-400",size:28}),e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:"Manual Point Distribution"})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Grant points directly to users or developers"}),Y&&e.jsx("div",{className:`p-4 rounded-lg border ${Y.type==="success"?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[Y.type==="success"?e.jsx(Q,{className:"text-green-600 dark:text-green-400",size:20}):e.jsx(se,{className:"text-red-600 dark:text-red-400",size:20}),e.jsx("p",{className:`text-sm font-medium ${Y.type==="success"?"text-green-900 dark:text-green-100":"text-red-900 dark:text-red-100"}`,children:Y.message})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Recipient Type"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"user",checked:v==="user",onChange:a=>{t(a.target.value),b([]),G(null)},className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"Regular User"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"developer",checked:v==="developer",onChange:a=>{t(a.target.value),b([]),G(null)},className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"Developer"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Search ",v==="user"?"User":"Developer"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:x,onChange:a=>N(a.target.value),placeholder:v==="user"?"Username":"Email or organization",className:"flex-1 px-4 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white",onKeyDown:a=>a.key==="Enter"&&je()}),e.jsxs("button",{onClick:je,disabled:I||!x.trim(),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-400 dark:disabled:bg-slate-600 text-white rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(Re,{size:18}),"Search"]})]}),s.length>0&&e.jsx("div",{className:"mt-3 border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden",children:e.jsx("div",{className:"max-h-60 overflow-y-auto",children:s.map(a=>e.jsx("button",{onClick:()=>{G(a),b([])},className:"w-full px-4 py-3 text-left hover:bg-slate-50 dark:hover:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700 last:border-b-0 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:v==="user"?`@${a.username}`:a.organization_name||a.email}),v==="developer"&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:a.email})]}),v==="developer"&&a.is_verified&&e.jsx(Q,{className:"text-blue-600 dark:text-blue-400",size:18})]})},v==="user"?a.user_id:a.id))})}),F&&e.jsx("div",{className:"mt-3 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:"Selected:"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:v==="user"?`@${F.username}`:`${F.organization_name||F.email}`})]}),e.jsx("button",{onClick:()=>G(null),className:"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 text-sm",children:"Change"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Points to Grant"}),e.jsx("input",{type:"number",value:g,onChange:a=>z(a.target.value),placeholder:"Enter amount",min:"0",step:"1",className:"w-full px-4 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white"}),g&&!isNaN(parseFloat(g))&&e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:["≈ £",(parseFloat(g)*.75).toFixed(2)," GBP"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Reason for Grant"}),e.jsx("textarea",{value:P,onChange:a=>te(a.target.value),placeholder:"Enter reason for granting points (required for audit trail)",rows:3,className:"w-full px-4 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white resize-none"})]}),e.jsxs("button",{onClick:Ie,disabled:!F||!g||!P.trim(),className:"w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-400 dark:disabled:bg-slate-600 text-white rounded-lg transition-colors flex items-center justify-center gap-2 font-medium disabled:cursor-not-allowed",children:[e.jsx(Ve,{size:18}),"Grant Points"]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(se,{className:"text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5",size:18}),e.jsxs("div",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Important Notes:"}),e.jsxs("ul",{className:"space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Points are granted immediately and cannot be revoked"}),e.jsx("li",{children:"All transactions are logged for audit purposes"}),e.jsx("li",{children:"Provide a clear reason for accountability"}),e.jsx("li",{children:"1 point = £0.75 GBP value"})]})]})]})})]})})]})]}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-4",children:"Create New API Key"}),q?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Q,{className:"text-green-600 dark:text-green-400",size:20}),e.jsx("p",{className:"font-semibold text-green-900 dark:text-green-100",children:"API Key Created!"})]}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mb-3",children:"Copy this key now. You won't be able to see it again."}),e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-slate-800 p-3 rounded border border-green-300 dark:border-green-700",children:[e.jsx("code",{className:"flex-1 text-sm font-mono text-slate-900 dark:text-white break-all",children:q}),e.jsx("button",{onClick:()=>ne(q),className:"flex-shrink-0 p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded transition-colors",title:"Copy",children:e.jsx(xe,{size:18,className:"text-slate-600 dark:text-slate-400"})})]})]}),e.jsx("button",{onClick:()=>{h(!1),M(null)},className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Done"})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:j,onChange:a=>L(a.target.value),placeholder:"Key name (e.g., Production API)",className:"w-full px-4 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white mb-4"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{h(!1),L("")},className:"flex-1 px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:X,disabled:!j.trim(),className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 dark:disabled:bg-slate-600 text-white rounded-lg transition-colors disabled:cursor-not-allowed",children:"Generate"})]})]})]})})]})}function ut(){const{user:i}=ze(),[U,d]=r.useState("select"),[T,y]=r.useState("none"),[$,E]=r.useState(""),[R,f]=r.useState(""),[_,S]=r.useState(""),[h,j]=r.useState(""),[L,q]=r.useState(""),[M,w]=r.useState(""),[B,c]=r.useState(!1),o=()=>{$==="1798"?(y("admin"),f("")):f("Invalid admin code")},u=async()=>{if(!_||!h||!L||!M){f("All fields are required");return}c(!0),f("");try{const{supabase:n}=await V(async()=>{const{supabase:x}=await import("./index-2dP_p1EG.js").then(N=>N.a1);return{supabase:x}},__vite__mapDeps([0,1])),{data:K,error:l}=await n.auth.signUp({email:_,password:h});if(l)throw l.message.includes("already registered")?new Error("This email is already registered. Please login instead."):l;if(K.user){const{data:x,error:N}=await n.rpc("verify_developer_access_code",{access_code:M,user_id:K.user.id});if(N)throw await n.auth.signOut(),new Error(N.message||"Invalid or expired access code.");const{error:v}=await n.from("paas_developers").insert({user_id:K.user.id,email:K.user.email,organization_name:L,subscription_status:"inactive",is_verified:!1,access_code_id:x});if(v)throw v.message.includes("duplicate")||v.code==="23505"?new Error("Developer account already exists. Please login instead."):new Error("Failed to create developer profile. Please contact support.");y("developer")}}catch(n){f(n.message||"Signup failed")}finally{c(!1)}},A=async()=>{if(!_||!h){f("Email and password are required");return}c(!0),f("");try{const{supabase:n}=await V(async()=>{const{supabase:l}=await import("./index-2dP_p1EG.js").then(x=>x.a1);return{supabase:l}},__vite__mapDeps([0,1])),{error:K}=await n.auth.signInWithPassword({email:_,password:h});if(K)throw K;y("developer")}catch(n){f(n.message||"Login failed")}finally{c(!1)}},C=async()=>{try{const{supabase:n}=await V(async()=>{const{supabase:K}=await import("./index-2dP_p1EG.js").then(l=>l.a1);return{supabase:K}},__vite__mapDeps([0,1]));await n.auth.signOut(),y("none"),d("select"),S(""),j(""),q(""),w(""),E("")}catch(n){console.error("Logout error:",n)}};return T==="admin"?e.jsx(Ze,{onLogout:()=>{y("none"),d("select")}}):T==="developer"&&i?e.jsxs("div",{children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"PaaS Platform"}),e.jsx("button",{onClick:C,className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg transition-colors",children:"Logout"})]})}),e.jsx(Qe,{})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-slate-50 to-purple-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-2xl mb-4",children:e.jsx(ie,{className:"text-white",size:32})}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2",children:"PaaS Platform"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Access your developer dashboard or admin panel"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-8 border border-slate-200 dark:border-slate-700",children:[U==="select"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>d("admin"),className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-xl font-semibold transition-all transform hover:scale-105",children:[e.jsx(ie,{size:20}),"Admin Access"]}),e.jsxs("button",{onClick:()=>d("developer-login"),className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white rounded-xl font-semibold transition-all transform hover:scale-105",children:[e.jsx(Le,{size:20}),"Developer Login"]}),e.jsxs("button",{onClick:()=>d("developer-signup"),className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-900 dark:text-white rounded-xl font-semibold transition-colors",children:[e.jsx(we,{size:20}),"Developer Signup"]})]}),U==="admin"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-6",children:"Admin Access"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Admin Code"}),e.jsx("input",{type:"password",value:$,onChange:n=>E(n.target.value),onKeyPress:n=>n.key==="Enter"&&o(),placeholder:"Enter admin code",className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white"})]}),R&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-sm text-red-700 dark:text-red-400",children:R}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{d("select"),f(""),E("")},className:"flex-1 px-4 py-3 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg font-medium transition-colors",children:"Back"}),e.jsx("button",{onClick:o,className:"flex-1 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Access"})]})]})]}),U==="developer-login"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-6",children:"Developer Login"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(ye,{className:"inline mr-2",size:16}),"Email"]}),e.jsx("input",{type:"email",value:_,onChange:n=>S(n.target.value),placeholder:"your@email.com",className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(Ce,{className:"inline mr-2",size:16}),"Password"]}),e.jsx("input",{type:"password",value:h,onChange:n=>j(n.target.value),onKeyPress:n=>n.key==="Enter"&&A(),placeholder:"••••••••",className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-900 dark:text-white"})]}),R&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-sm text-red-700 dark:text-red-400",children:R}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{d("select"),f(""),S(""),j("")},className:"flex-1 px-4 py-3 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg font-medium transition-colors",children:"Back"}),e.jsx("button",{onClick:A,disabled:B,className:"flex-1 px-4 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-slate-300 dark:disabled:bg-slate-600 text-white rounded-lg font-medium transition-colors disabled:cursor-not-allowed",children:B?"Loading...":"Login"})]}),e.jsxs("p",{className:"text-center text-sm text-slate-600 dark:text-slate-400",children:["Don't have an account?"," ",e.jsx("button",{onClick:()=>{d("developer-signup"),f("")},className:"text-purple-600 dark:text-purple-400 hover:underline font-medium",children:"Sign up"})]})]})]}),U==="developer-signup"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-6",children:"Developer Signup"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(ye,{className:"inline mr-2",size:16}),"Email"]}),e.jsx("input",{type:"email",value:_,onChange:n=>S(n.target.value),placeholder:"your@email.com",className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(we,{className:"inline mr-2",size:16}),"Organization Name"]}),e.jsx("input",{type:"text",value:L,onChange:n=>q(n.target.value),placeholder:"Your Company",className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(ae,{className:"inline mr-2",size:16}),"Developer Access Code"]}),e.jsx("input",{type:"text",value:M,onChange:n=>w(n.target.value.toUpperCase()),placeholder:"POET2026",className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-900 dark:text-white font-mono"}),e.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:"Contact support to obtain a valid access code"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(Ce,{className:"inline mr-2",size:16}),"Password"]}),e.jsx("input",{type:"password",value:h,onChange:n=>j(n.target.value),onKeyPress:n=>n.key==="Enter"&&u(),placeholder:"••••••••",className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-900 dark:text-white"})]}),R&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-sm text-red-700 dark:text-red-400",children:R}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{d("select"),f(""),S(""),j(""),q(""),w("")},className:"flex-1 px-4 py-3 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg font-medium transition-colors",children:"Back"}),e.jsx("button",{onClick:u,disabled:B,className:"flex-1 px-4 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-slate-300 dark:disabled:bg-slate-600 text-white rounded-lg font-medium transition-colors disabled:cursor-not-allowed",children:B?"Creating...":"Sign Up"})]}),e.jsxs("p",{className:"text-center text-sm text-slate-600 dark:text-slate-400",children:["Already have an account?"," ",e.jsx("button",{onClick:()=>{d("developer-login"),f("")},className:"text-purple-600 dark:text-purple-400 hover:underline font-medium",children:"Log in"})]})]})]})]}),e.jsx("p",{className:"text-center text-sm text-slate-600 dark:text-slate-400 mt-6",children:"Secure access to the PaaS platform"})]})})}export{ut as default};
