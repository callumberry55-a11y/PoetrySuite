import{c as R,u as K,r as d,s as c,j as e,b as S,X as E}from"./index-DSaTw0cA.js";import{P as Q}from"./plus-DSQlmcyZ.js";import{C}from"./clock-DTUxbmlB.js";import{T}from"./trash-2-DSuqYn0V.js";const q=R("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);const P=R("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),W="ee83f990-591a-4b31-80cc-0655c2b32010";function ae(){const{user:r}=K(),[n,A]=d.useState("journal"),[u,I]=d.useState([]),[b,O]=d.useState([]),[L,j]=d.useState(!0),[Y,f]=d.useState(!1),[$,v]=d.useState(!1),[D,M]=d.useState([]),[l,h]=d.useState({poem_id:"",venue_name:"",venue_type:"journal",submission_date:new Date().toISOString().split("T")[0],notes:""}),[p,N]=d.useState({poem_id:"",submission_notes:""}),[k,_]=d.useState({}),i=r?.id===W;d.useEffect(()=>{n==="journal"?w():g(),U()},[n]);const w=async()=>{if(r){j(!0);try{const{data:t,error:s}=await c.from("submissions").select(`
          *,
          poems(title)
        `).eq("user_id",r.id).order("submission_date",{ascending:!1});if(s)throw s;I(t||[])}catch(t){console.error("Error loading submissions:",t)}finally{j(!1)}}},U=async()=>{if(r)try{const{data:t,error:s}=await c.from("poems").select("id, title").eq("user_id",r.id).order("created_at",{ascending:!1});if(s)throw s;M(t||[])}catch(t){console.error("Error loading poems:",t)}},J=async t=>{if(t.preventDefault(),!!r)try{const{error:s}=await c.from("submissions").insert({...l,user_id:r.id,status:"pending"});if(s)throw s;f(!1),h({poem_id:"",venue_name:"",venue_type:"journal",submission_date:new Date().toISOString().split("T")[0],notes:""}),await w()}catch(s){console.error("Error adding submission:",s)}},z=async(t,s,a)=>{try{const o={status:s};a&&(o.response_date=a);const{error:x}=await c.from("submissions").update(o).eq("id",t);if(x)throw x;await w()}catch(o){console.error("Error updating submission:",o)}},V=async t=>{if(confirm("Are you sure you want to delete this submission?"))try{const{error:s}=await c.from("submissions").delete().eq("id",t);if(s)throw s;await w()}catch(s){console.error("Error deleting submission:",s)}},g=async()=>{if(r){j(!0);try{let t=c.from("community_submissions").select(`
          *,
          poems(title, content, user_id),
          user_profiles(display_name, username)
        `).order("submitted_at",{ascending:!1});i||(t=t.eq("user_id",r.id));const{data:s,error:a}=await t;if(a)throw a;O(s||[])}catch(t){console.error("Error loading community submissions:",t)}finally{j(!1)}}},X=async t=>{if(t.preventDefault(),!!r)try{const{error:s}=await c.from("community_submissions").insert({user_id:r.id,poem_id:p.poem_id,submission_notes:p.submission_notes||null,status:"pending"});if(s)throw s;v(!1),N({poem_id:"",submission_notes:""}),await g()}catch(s){console.error("Error adding community submission:",s),s.code==="23505"?alert("This poem has already been submitted to the community showcase."):alert("Failed to submit poem. Please try again.")}},B=async(t,s)=>{if(i)try{const{error:a}=await c.from("community_submissions").update({status:"approved",reviewed_at:new Date().toISOString(),reviewed_by:r?.id,review_notes:s||null}).eq("id",t);if(a)throw a;await g(),_(o=>{const x={...o};return delete x[t],x})}catch(a){console.error("Error approving submission:",a),alert("Failed to approve submission")}},G=async(t,s)=>{if(i)try{const{error:a}=await c.from("community_submissions").update({status:"rejected",reviewed_at:new Date().toISOString(),reviewed_by:r?.id,review_notes:s||null}).eq("id",t);if(a)throw a;await g(),_(o=>{const x={...o};return delete x[t],x})}catch(a){console.error("Error rejecting submission:",a),alert("Failed to reject submission")}},H=async t=>{if(confirm("Are you sure you want to delete this submission?"))try{const{error:s}=await c.from("community_submissions").delete().eq("id",t);if(s)throw s;await g()}catch(s){console.error("Error deleting community submission:",s)}},F=t=>{switch(t){case"accepted":return"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300";case"rejected":return"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300";case"withdrawn":return"bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-300";default:return"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-300"}},y={total:u.length,pending:u.filter(t=>t.status==="pending").length,accepted:u.filter(t=>t.status==="accepted").length,rejected:u.filter(t=>t.status==="rejected").length},m={total:b.length,pending:b.filter(t=>t.status==="pending").length,approved:b.filter(t=>t.status==="approved").length,rejected:b.filter(t=>t.status==="rejected").length};return e.jsxs("div",{className:"h-full flex flex-col bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-slate-800",children:[e.jsxs("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2",children:n==="journal"?"Submission Tracker":"Community Showcase"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:n==="journal"?"Track your poetry submissions to journals and contests":"Submit your poems for community approval and showcase"})]}),e.jsxs("button",{onClick:()=>n==="journal"?f(!0):v(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(Q,{size:18}),n==="journal"?"Add Submission":"Submit Poem"]})]}),e.jsxs("div",{className:"flex gap-2 mb-6 border-b border-slate-200 dark:border-slate-700 pb-4",children:[e.jsx("button",{onClick:()=>A("journal"),className:`px-4 py-2 font-medium transition-colors border-b-2 ${n==="journal"?"border-blue-500 text-blue-500":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{size:18}),"Journal Submissions"]})}),e.jsx("button",{onClick:()=>A("community"),className:`px-4 py-2 font-medium transition-colors border-b-2 ${n==="community"?"border-blue-500 text-blue-500":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{size:18}),"Community Showcase",i&&m.pending>0&&e.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:m.pending})]})})]}),n==="journal"?e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:y.total}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600 dark:text-amber-400",children:y.pending}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Pending"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:y.accepted}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Accepted"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:y.rejected}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Rejected"})]})]}):e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:m.total}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600 dark:text-amber-400",children:m.pending}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Pending"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:m.approved}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Approved"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:m.rejected}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Rejected"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:L?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}):n==="journal"?e.jsxs("div",{className:"max-w-5xl mx-auto space-y-4",children:[u.map(t=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-1",children:t.poems?.title||"Untitled"}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:[t.venue_name," (",t.venue_type,")"]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${F(t.status)}`,children:t.status})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-600 dark:text-slate-400 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{size:14}),"Submitted: ",new Date(t.submission_date).toLocaleDateString()]}),t.response_date&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(C,{size:14}),"Response: ",new Date(t.response_date).toLocaleDateString()]})]}),t.notes&&e.jsx("p",{className:"text-slate-700 dark:text-slate-300 mb-4 text-sm",children:t.notes}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>z(t.id,"accepted",new Date().toISOString().split("T")[0]),className:"flex items-center gap-1 px-3 py-1.5 bg-green-100 dark:bg-green-900/30 hover:bg-green-200 dark:hover:bg-green-900/50 text-green-700 dark:text-green-300 rounded-lg text-sm transition-colors",children:[e.jsx(P,{size:14}),"Accepted"]}),e.jsxs("button",{onClick:()=>z(t.id,"rejected",new Date().toISOString().split("T")[0]),className:"flex items-center gap-1 px-3 py-1.5 bg-red-100 dark:bg-red-900/30 hover:bg-red-200 dark:hover:bg-red-900/50 text-red-700 dark:text-red-300 rounded-lg text-sm transition-colors",children:[e.jsx(E,{size:14}),"Rejected"]})]}),e.jsx("button",{onClick:()=>V(t.id),className:"ml-auto flex items-center gap-1 px-3 py-1.5 text-slate-600 dark:text-slate-400 hover:text-red-600 dark:hover:text-red-400 transition-colors",children:e.jsx(T,{size:14})})]})]},t.id)),u.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(S,{className:"mx-auto mb-4 text-slate-400",size:48}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"No submissions yet"}),e.jsx("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Add Your First Submission"})]})]}):e.jsxs("div",{className:"max-w-5xl mx-auto space-y-4",children:[i&&m.pending>0&&e.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-amber-800 dark:text-amber-200",children:[e.jsx(C,{size:20}),e.jsxs("span",{className:"font-medium",children:[m.pending," submission",m.pending!==1?"s":""," awaiting review"]})]})}),b.map(t=>{const s=t.user_profiles?.display_name||t.user_profiles?.username||"Anonymous",a=t.user_id===r?.id;return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-1",children:t.poems?.title||"Untitled"}),!a&&i&&e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:["by ",s]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${F(t.status)}`,children:t.status})]}),t.poems?.content&&e.jsx("div",{className:"bg-slate-50 dark:bg-slate-900 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-slate-700 dark:text-slate-300 whitespace-pre-wrap font-serif text-sm line-clamp-6",children:t.poems.content})}),t.submission_notes&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Submission Notes:"}),e.jsx("p",{className:"text-slate-700 dark:text-slate-300 text-sm",children:t.submission_notes})]}),t.review_notes&&e.jsxs("div",{className:"mb-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-medium text-blue-700 dark:text-blue-300 mb-1",children:"Review Notes:"}),e.jsx("p",{className:"text-blue-800 dark:text-blue-200 text-sm",children:t.review_notes})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400 mb-4",children:[e.jsx(C,{size:14}),"Submitted: ",new Date(t.submitted_at).toLocaleDateString(),t.reviewed_at&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-2",children:"â€¢"}),"Reviewed: ",new Date(t.reviewed_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="pending"&&i&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",placeholder:"Add review notes (optional)...",value:k[t.id]||"",onChange:o=>_({...k,[t.id]:o.target.value}),className:"flex-1 px-3 py-1.5 text-sm bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white"}),e.jsxs("button",{onClick:()=>B(t.id,k[t.id]),className:"flex items-center gap-1 px-3 py-1.5 bg-green-100 dark:bg-green-900/30 hover:bg-green-200 dark:hover:bg-green-900/50 text-green-700 dark:text-green-300 rounded-lg text-sm transition-colors",children:[e.jsx(P,{size:14}),"Approve"]}),e.jsxs("button",{onClick:()=>G(t.id,k[t.id]),className:"flex items-center gap-1 px-3 py-1.5 bg-red-100 dark:bg-red-900/30 hover:bg-red-200 dark:hover:bg-red-900/50 text-red-700 dark:text-red-300 rounded-lg text-sm transition-colors",children:[e.jsx(E,{size:14}),"Reject"]})]}),(a||i)&&e.jsx("button",{onClick:()=>H(t.id),className:"ml-auto flex items-center gap-1 px-3 py-1.5 text-slate-600 dark:text-slate-400 hover:text-red-600 dark:hover:text-red-400 transition-colors",children:e.jsx(T,{size:14})})]})]},t.id)}),b.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(q,{className:"mx-auto mb-4 text-slate-400",size:48}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:i?"No submissions yet":"You haven't submitted any poems yet"}),!i&&e.jsx("button",{onClick:()=>v(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Submit Your First Poem"})]})]})}),Y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-xl max-w-lg w-full p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-6",children:"Add Submission"}),e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Poem"}),e.jsxs("select",{value:l.poem_id,onChange:t=>h({...l,poem_id:t.target.value}),className:"w-full px-4 py-2 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",required:!0,children:[e.jsx("option",{value:"",children:"Select a poem"}),D.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Venue Name"}),e.jsx("input",{type:"text",value:l.venue_name,onChange:t=>h({...l,venue_name:t.target.value}),className:"w-full px-4 py-2 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Venue Type"}),e.jsxs("select",{value:l.venue_type,onChange:t=>h({...l,venue_type:t.target.value}),className:"w-full px-4 py-2 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",children:[e.jsx("option",{value:"journal",children:"Journal"}),e.jsx("option",{value:"contest",children:"Contest"}),e.jsx("option",{value:"anthology",children:"Anthology"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Submission Date"}),e.jsx("input",{type:"date",value:l.submission_date,onChange:t=>h({...l,submission_date:t.target.value}),className:"w-full px-4 py-2 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:l.notes,onChange:t=>h({...l,notes:t.target.value}),className:"w-full px-4 py-2 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",rows:3})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Add Submission"}),e.jsx("button",{type:"button",onClick:()=>f(!1),className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-900 dark:text-white rounded-lg font-medium transition-colors",children:"Cancel"})]})]})]})}),$&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-xl max-w-lg w-full p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-6",children:"Submit Poem to Community"}),e.jsxs("form",{onSubmit:X,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Poem"}),e.jsxs("select",{value:p.poem_id,onChange:t=>N({...p,poem_id:t.target.value}),className:"w-full px-4 py-2 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",required:!0,children:[e.jsx("option",{value:"",children:"Select a poem"}),D.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:p.submission_notes,onChange:t=>N({...p,submission_notes:t.target.value}),className:"w-full px-4 py-2 bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white",rows:3,placeholder:"Add any context or information about your poem..."})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:"Your poem will be reviewed before appearing in the community showcase. You'll be notified once it's reviewed."})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Submit for Review"}),e.jsx("button",{type:"button",onClick:()=>v(!1),className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-900 dark:text-white rounded-lg font-medium transition-colors",children:"Cancel"})]})]})]})})]})}export{ae as default};
