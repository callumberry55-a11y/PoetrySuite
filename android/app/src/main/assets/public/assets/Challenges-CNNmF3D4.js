import{u as C,r as l,s as r,j as e,p as x,Z as f,m as b}from"./index-CGemffCt.js";import{C as g}from"./circle-check-big-gJTh1YIL.js";import{C as S}from"./clock-CH5mnwFd.js";function D(){const{user:s}=C(),[p,j]=l.useState([]),[o,w]=l.useState(null),[v,h]=l.useState(!0),c=l.useCallback(async()=>{if(!s)return;const t=new Date().toISOString(),{data:a,error:d}=await r.from("challenges").select("*").lte("start_date",t).gte("end_date",t).order("end_date",{ascending:!0});if(d){console.error("Error loading challenges:",d),h(!1);return}const m=await Promise.all((a||[]).map(async i=>{const{count:k}=await r.from("challenge_participations").select("id",{count:"exact",head:!0}).eq("challenge_id",i.id),{data:n}=await r.from("challenge_participations").select("completed").eq("challenge_id",i.id).eq("user_id",s.id).maybeSingle();return{...i,participant_count:k||0,user_has_joined:!!n,user_completed:(n==null?void 0:n.completed)||!1}}));j(m),h(!1)},[s]),u=l.useCallback(async()=>{if(!s)return;const t=new Date().toISOString().split("T")[0],{data:a,error:d}=await r.from("daily_prompts").select("*").eq("prompt_date",t).maybeSingle();if(d||!a){console.error("Error loading prompt:",d);return}const{count:m}=await r.from("prompt_responses").select("id",{count:"exact",head:!0}).eq("prompt_id",a.id),{data:i}=await r.from("prompt_responses").select("id").eq("prompt_id",a.id).eq("user_id",s.id).maybeSingle();w({...a,response_count:m||0,user_has_responded:!!i})},[s]);l.useEffect(()=>{s&&(c(),u())},[s,c,u]);const N=async t=>{if(!s)return;const{error:a}=await r.from("challenge_participations").insert([{challenge_id:t,user_id:s.id}]);if(a){console.error("Error joining challenge:",a);return}c()},_=t=>{switch(t){case"timed":return e.jsx(S,{size:20});case"word_count":return e.jsx(b,{size:20});case"form":return e.jsx(x,{size:20});case"daily":return e.jsx(f,{size:20});default:return e.jsx(b,{size:20})}},y=t=>new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-slate-50 via-white to-slate-50 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950 pb-24",children:[e.jsxs("div",{className:"relative bg-gradient-to-r from-violet-600 via-purple-600 to-fuchsia-600 h-32 sm:h-40",children:[e.jsx("div",{className:"absolute inset-0 bg-black/20"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-white",children:[e.jsx(x,{className:"w-10 h-10 sm:w-12 sm:h-12 mb-2 animate-pulse"}),e.jsx("h1",{className:"text-2xl sm:text-4xl font-bold mb-1",children:"Challenges & Prompts"}),e.jsx("p",{className:"text-sm sm:text-base opacity-90",children:"Push your creative boundaries"})]})]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 -mt-8 space-y-6",children:[o&&e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-3xl shadow-xl border border-slate-200 dark:border-slate-800 p-6 sm:p-8 hover:shadow-2xl transition-all duration-300",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4 gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h3",{className:"text-xl sm:text-2xl font-bold text-slate-900 dark:text-white mb-2 flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-violet-500 to-purple-500 rounded-2xl shadow-lg",children:e.jsx(f,{className:"text-white",size:24})}),"Today's Writing Prompt"]}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 font-medium",children:[o.response_count," poets have responded today"]})]}),o.user_has_responded&&e.jsxs("span",{className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl text-sm font-semibold shadow-lg flex-shrink-0",children:[e.jsx(g,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Completed"})]})]}),e.jsxs("p",{className:"text-lg sm:text-xl text-slate-900 dark:text-white font-serif mb-4 italic leading-relaxed",children:['"',o.prompt_text,'"']}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-sm px-4 py-2 bg-gradient-to-br from-violet-100 to-purple-100 dark:from-violet-900/30 dark:to-purple-900/30 text-violet-700 dark:text-violet-300 rounded-xl font-semibold border border-violet-200 dark:border-violet-800",children:o.category})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:v?e.jsx("div",{className:"col-span-full flex items-center justify-center py-16",children:e.jsxs("div",{className:"relative w-16 h-16",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-slate-200 dark:border-slate-800"}),e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-violet-600 border-t-transparent animate-spin"})]})}):p.length===0?e.jsxs("div",{className:"col-span-full text-center py-16 bg-white dark:bg-slate-900 rounded-3xl border border-slate-200 dark:border-slate-800 shadow-lg",children:[e.jsx(x,{className:"w-16 h-16 mx-auto mb-4 text-slate-300 dark:text-slate-700"}),e.jsx("p",{className:"text-lg text-slate-500 dark:text-slate-400 font-medium",children:"No active challenges at the moment"})]}):p.map(t=>e.jsxs("div",{className:"group bg-white dark:bg-slate-900 rounded-3xl shadow-lg border border-slate-200 dark:border-slate-800 p-6 hover:shadow-2xl transition-all duration-300 hover:scale-[1.02]",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:"p-3 rounded-2xl bg-gradient-to-br from-violet-500 to-purple-500 text-white shadow-lg",children:_(t.challenge_type)}),t.user_completed&&e.jsxs("span",{className:"flex items-center gap-2 px-3 py-1 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl text-xs font-semibold shadow-lg",children:[e.jsx(g,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:"Done"})]})]}),e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-2",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4 line-clamp-2 leading-relaxed",children:t.description}),e.jsxs("div",{className:"space-y-2 mb-6 p-4 bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-800 dark:to-slate-800/50 rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400 font-medium",children:"Target:"}),e.jsxs("span",{className:"font-bold text-slate-900 dark:text-white",children:[t.target_value," ",t.challenge_type==="word_count"?"words":t.challenge_type==="timed"?"minutes":"poems"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400 font-medium",children:"Ends:"}),e.jsx("span",{className:"font-bold text-slate-900 dark:text-white",children:y(t.end_date)})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400 font-medium",children:"Participants:"}),e.jsx("span",{className:"font-bold text-slate-900 dark:text-white",children:t.participant_count})]})]}),t.user_has_joined?e.jsx("button",{disabled:!0,className:"w-full px-6 py-3 bg-slate-200 dark:bg-slate-800 text-slate-600 dark:text-slate-400 rounded-xl font-semibold cursor-not-allowed",children:t.user_completed?"Completed":"In Progress"}):e.jsx("button",{onClick:()=>N(t.id),className:"w-full px-6 py-3 bg-gradient-to-r from-violet-500 to-purple-500 hover:from-violet-600 hover:to-purple-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105",children:"Join Challenge"})]},t.id))})]})]})}export{D as default};
