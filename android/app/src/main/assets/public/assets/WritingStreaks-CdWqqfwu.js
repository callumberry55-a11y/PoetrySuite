import{u as j,r as c,s as i,j as e,a as b,C as u,B as f,T as N,A as w}from"./index-2dP_p1EG.js";import{C as p}from"./clock-DJOLL9Lo.js";import{F as _}from"./file-text-igh_SNiR.js";function E(){const{user:s}=j(),[a,o]=c.useState(null),[m,x]=c.useState([]),[r,g]=c.useState(null),[v,h]=c.useState(!0);c.useEffect(()=>(s&&(k(),y()),()=>{i.channel("writing_streaks_channel").unsubscribe(),i.channel("user_achievements_channel").unsubscribe(),i.channel("daily_writing_logs_channel").unsubscribe()}),[s]);const k=async()=>{h(!0);try{const d=new Date().toISOString().split("T")[0],{data:t}=await i.from("writing_streaks").select("*").eq("user_id",s==null?void 0:s.id).maybeSingle(),{data:l}=await i.from("user_achievements").select("*").eq("user_id",s==null?void 0:s.id).order("earned_at",{ascending:!1}),{data:n}=await i.from("daily_writing_logs").select("*").eq("user_id",s==null?void 0:s.id).eq("write_date",d).maybeSingle();o(t),x(l||[]),g(n)}catch(d){console.error("Error loading data:",d)}finally{h(!1)}},y=()=>{if(!(s!=null&&s.id))return;const d=new Date().toISOString().split("T")[0];i.channel("writing_streaks_channel").on("postgres_changes",{event:"*",schema:"public",table:"writing_streaks",filter:`user_id=eq.${s.id}`},t=>{(t.eventType==="INSERT"||t.eventType==="UPDATE")&&o(t.new)}).subscribe(),i.channel("user_achievements_channel").on("postgres_changes",{event:"*",schema:"public",table:"user_achievements",filter:`user_id=eq.${s.id}`},t=>{t.eventType==="INSERT"?x(l=>[t.new,...l]):t.eventType==="UPDATE"?x(l=>l.map(n=>n.id===t.new.id?t.new:n)):t.eventType==="DELETE"&&x(l=>l.filter(n=>n.id!==t.old.id))}).subscribe(),i.channel("daily_writing_logs_channel").on("postgres_changes",{event:"*",schema:"public",table:"daily_writing_logs",filter:`user_id=eq.${s.id}`},t=>{(t.eventType==="INSERT"||t.eventType==="UPDATE")&&t.new.write_date===d&&g(t.new)}).subscribe()};return v?e.jsx("div",{className:"max-w-4xl mx-auto p-6 flex items-center justify-center h-96",children:e.jsx("div",{className:"inline-block w-8 h-8 border-4 border-emerald-600 border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(b,{className:"w-8 h-8 text-orange-600 dark:text-orange-400"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Writing Streaks"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg border border-blue-200 dark:border-blue-800 p-6 mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),"Today's Activity"]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-lg bg-white dark:bg-gray-800",children:e.jsx(p,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:(r==null?void 0:r.minutes_spent)||0}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Minutes"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-lg bg-white dark:bg-gray-800",children:e.jsx(f,{className:"w-6 h-6 text-emerald-600 dark:text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:(r==null?void 0:r.poems_written)||0}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Poems"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-lg bg-white dark:bg-gray-800",children:e.jsx(_,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:(r==null?void 0:r.word_count)||0}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Words"})]})]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 rounded-lg border-2 border-orange-200 dark:border-orange-800 p-6",children:[e.jsx(b,{className:"w-8 h-8 text-orange-600 dark:text-orange-400 mb-3"}),e.jsx("div",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-1",children:(a==null?void 0:a.current_streak)||0}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Day Streak"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx(N,{className:"w-8 h-8 text-emerald-600 dark:text-emerald-400 mb-3"}),e.jsx("div",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-1",children:(a==null?void 0:a.longest_streak)||0}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Longest Streak"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx(u,{className:"w-8 h-8 text-blue-600 dark:text-blue-400 mb-3"}),e.jsx("div",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-1",children:(a==null?void 0:a.total_writing_days)||0}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Days"})]})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(w,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400"}),"Achievements"]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:m.length===0?e.jsx("div",{className:"col-span-2 text-center py-12 text-gray-500 dark:text-gray-400",children:"No achievements yet. Keep writing to unlock them!"}):m.map((d,t)=>e.jsx("div",{className:"bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(w,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white mb-1",children:d.achievement_name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:d.achievement_description})]})]})},t))})]})]})}export{E as default};
