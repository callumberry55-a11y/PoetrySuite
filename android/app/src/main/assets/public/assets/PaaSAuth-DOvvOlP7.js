const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CGemffCt.js","assets/index-D3HZ0LqU.css"])))=>i.map(i=>d[i]);
import{r as l,_ as M,j as e,T as re,s as p,R as pe,D as Ae,l as he,C as se,d as Te,e as ie,n as ge,h as ve,z as ze,M as Ne,u as Le,U as qe,f as ye}from"./index-CGemffCt.js";import{K as ae,c as xe,d as fe,W as me,C as $e,H as ke,A as Be,b as Ke,S as Oe,B as Ue,G as Me,a as we}from"./wallet-dBNc6hNb.js";import{A as W}from"./activity-CDnKOozp.js";import{C as oe}from"./clock-CH5mnwFd.js";import{P as De}from"./plus-zAg5GACl.js";import{E as Ee}from"./eye-CihzmZqK.js";import{C as ue}from"./circle-x-Dj4cGIT8.js";import{C as Q}from"./circle-check-big-gJTh1YIL.js";import{T as Pe}from"./trash-2-CpZgBkr4.js";import{C as _e}from"./calendar-_Ckto2X5.js";import{D as be}from"./dollar-sign-Z4LvFGwQ.js";import{C as ce}from"./coins-DSr2Mgwt.js";import{S as Re}from"./search-CC5W77On.js";import{L as Se}from"./loader-circle-afWaHuD7.js";import{S as Ve}from"./send-DpFuWiTj.js";import{L as Ce}from"./lock-Bpvz4WVX.js";function Je(){const[i,U]=l.useState([]),[d,z]=l.useState([]),[f,$]=l.useState({total_requests:0,requests_today:0,requests_this_hour:0,avg_response_time:0}),[R,I]=l.useState(!1),[v,_]=l.useState(""),[S,j]=l.useState(1e3),[y,q]=l.useState({read_poems:!0,read_public_profiles:!0,read_contests:!1,read_badges:!1,read_workshops:!1}),[B,V]=l.useState(null),[w,K]=l.useState(!1);l.useEffect(()=>{x(),c()},[]);const x=async()=>{try{const{supabase:r}=await M(async()=>{const{supabase:h}=await import("./index-CGemffCt.js").then(N=>N.a9);return{supabase:h}},__vite__mapDeps([0,1])),{data:o}=await r.from("external_api_keys").select("*").order("created_at",{ascending:!1});o&&U(o)}catch(r){console.error("Error loading API keys:",r)}},c=async()=>{try{const{supabase:r}=await M(async()=>{const{supabase:Y}=await import("./index-CGemffCt.js").then(J=>J.a9);return{supabase:Y}},__vite__mapDeps([0,1])),o=new Date,h=new Date(o.getFullYear(),o.getMonth(),o.getDate()),N=new Date(o.getFullYear(),o.getMonth(),o.getDate(),o.getHours()),{data:t,count:g}=await r.from("external_api_usage").select("*",{count:"exact"}),{count:L}=await r.from("external_api_usage").select("*",{count:"exact",head:!0}).gte("created_at",h.toISOString()),{count:P}=await r.from("external_api_usage").select("*",{count:"exact",head:!0}).gte("created_at",N.toISOString()),te=t!=null&&t.length?t.reduce((Y,J)=>Y+(J.response_time_ms||0),0)/t.length:0;$({total_requests:g||0,requests_today:L||0,requests_this_hour:P||0,avg_response_time:Math.round(te)})}catch(r){console.error("Error loading usage stats:",r)}},b=async r=>{try{const{supabase:o}=await M(async()=>{const{supabase:N}=await import("./index-CGemffCt.js").then(t=>t.a9);return{supabase:N}},__vite__mapDeps([0,1])),{data:h}=await o.from("external_api_usage").select("*").eq("api_key_id",r).order("created_at",{ascending:!1}).limit(50);h&&(z(h),K(!0))}catch(o){console.error("Error loading usage:",o)}},A=async()=>{if(v.trim())try{const{supabase:r}=await M(async()=>{const{supabase:g}=await import("./index-CGemffCt.js").then(L=>L.a9);return{supabase:g}},__vite__mapDeps([0,1])),{data:{user:o}}=await r.auth.getUser();if(!o)return;const h="sk_"+Array.from(crypto.getRandomValues(new Uint8Array(32))).map(g=>g.toString(16).padStart(2,"0")).join(""),N=h.substring(0,12),{error:t}=await r.from("external_api_keys").insert({name:v,key_hash:h,key_prefix:N,permissions:y,rate_limit_per_hour:S,created_by:o.id,is_active:!0});if(t)throw t;V(h),_(""),j(1e3),q({read_poems:!0,read_public_profiles:!0,read_contests:!1,read_badges:!1,read_workshops:!1}),x()}catch(r){console.error("Error generating API key:",r)}},C=async(r,o)=>{try{const{supabase:h}=await M(async()=>{const{supabase:N}=await import("./index-CGemffCt.js").then(t=>t.a9);return{supabase:N}},__vite__mapDeps([0,1]));await h.from("external_api_keys").update({is_active:!o}).eq("id",r),x()}catch(h){console.error("Error toggling key status:",h)}},n=async r=>{if(confirm("Are you sure you want to delete this API key? This action cannot be undone."))try{const{supabase:o}=await M(async()=>{const{supabase:h}=await import("./index-CGemffCt.js").then(N=>N.a9);return{supabase:h}},__vite__mapDeps([0,1]));await o.from("external_api_keys").delete().eq("id",r),x()}catch(o){console.error("Error deleting API key:",o)}},E=r=>{navigator.clipboard.writeText(r)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(ae,{className:"text-blue-600 dark:text-blue-400",size:24})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:i.filter(r=>r.is_active).length}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Active Keys"}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500 mt-1",children:[i.length," total"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(W,{className:"text-green-600 dark:text-green-400",size:24})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:f.total_requests.toLocaleString()}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total Requests"}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500 mt-1",children:[f.requests_today," today"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(re,{className:"text-purple-600 dark:text-purple-400",size:24})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:f.requests_this_hour}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Requests This Hour"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(oe,{className:"text-orange-600 dark:text-orange-400",size:24})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:f.avg_response_time}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Avg Response (ms)"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:"API Keys"}),e.jsxs("button",{onClick:()=>I(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(De,{size:18}),"New API Key"]})]}),i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ae,{className:"mx-auto mb-4 text-slate-300 dark:text-slate-600",size:48}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"No API Keys Yet"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Create your first API key to allow external access."}),e.jsx("button",{onClick:()=>I(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Create API Key"})]}):e.jsx("div",{className:"space-y-3",children:i.map(r=>e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg border border-slate-200 dark:border-slate-600",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:r.name}),e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${r.is_active?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400"}`,children:r.is_active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("code",{className:"text-sm font-mono text-slate-600 dark:text-slate-400 bg-white dark:bg-slate-800 px-2 py-1 rounded",children:[r.key_prefix,"..."]}),e.jsx("button",{onClick:()=>E(r.key_prefix),className:"p-1 hover:bg-slate-200 dark:hover:bg-slate-600 rounded transition-colors",title:"Copy prefix",children:e.jsx(xe,{size:14,className:"text-slate-600 dark:text-slate-400"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:Object.entries(r.permissions).map(([o,h])=>h&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded",children:o.replace("read_","").replace(/_/g," ")},o))}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:["Rate limit: ",r.rate_limit_per_hour,"/hour • Created ",new Date(r.created_at).toLocaleDateString(),r.last_used_at&&` • Last used ${new Date(r.last_used_at).toLocaleDateString()}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>b(r.id),className:"p-2 hover:bg-slate-200 dark:hover:bg-slate-600 rounded transition-colors",title:"View usage",children:e.jsx(Ee,{size:18,className:"text-slate-600 dark:text-slate-400"})}),e.jsx("button",{onClick:()=>C(r.id,r.is_active),className:"p-2 hover:bg-slate-200 dark:hover:bg-slate-600 rounded transition-colors",title:r.is_active?"Deactivate":"Activate",children:r.is_active?e.jsx(ue,{size:18,className:"text-red-600 dark:text-red-400"}):e.jsx(Q,{size:18,className:"text-green-600 dark:text-green-400"})}),e.jsx("button",{onClick:()=>n(r.id),className:"p-2 hover:bg-red-100 dark:hover:bg-red-900/30 rounded transition-colors",title:"Delete",children:e.jsx(Pe,{size:18,className:"text-red-600 dark:text-red-400"})})]})]})},r.id))})]}),R&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-4",children:"Create New API Key"}),B?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Q,{className:"text-green-600 dark:text-green-400",size:20}),e.jsx("p",{className:"font-semibold text-green-900 dark:text-green-100",children:"API Key Created!"})]}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mb-3",children:"Copy this key now. You won't be able to see it again."}),e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-slate-800 p-3 rounded border border-green-300 dark:border-green-700",children:[e.jsx("code",{className:"flex-1 text-sm font-mono text-slate-900 dark:text-white break-all",children:B}),e.jsx("button",{onClick:()=>E(B),className:"flex-shrink-0 p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded transition-colors",title:"Copy",children:e.jsx(xe,{size:18,className:"text-slate-600 dark:text-slate-400"})})]})]}),e.jsx("button",{onClick:()=>{I(!1),V(null)},className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Done"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Key Name"}),e.jsx("input",{type:"text",value:v,onChange:r=>_(r.target.value),placeholder:"e.g., Mobile App API",className:"w-full px-4 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Rate Limit (requests per hour)"}),e.jsx("input",{type:"number",value:S,onChange:r=>j(parseInt(r.target.value)||1e3),className:"w-full px-4 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(y).map(([r,o])=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:h=>q({...y,[r]:h.target.checked}),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:r.replace("read_","Read ").replace(/_/g," ")})]},r))})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{I(!1),_("")},className:"flex-1 px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:A,disabled:!v.trim(),className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 dark:disabled:bg-slate-600 text-white rounded-lg transition-colors disabled:cursor-not-allowed",children:"Generate"})]})]})]})}),w&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-4xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"API Usage"}),e.jsx("button",{onClick:()=>K(!1),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded transition-colors",children:e.jsx(ue,{size:20,className:"text-slate-600 dark:text-slate-400"})})]}),d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(W,{className:"mx-auto mb-4 text-slate-300 dark:text-slate-600",size:48}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"No usage records yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:"Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:"Method"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:"Endpoint"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:"IP"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:d.map(r=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/30",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-slate-900 dark:text-white whitespace-nowrap",children:new Date(r.created_at).toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded font-mono",children:r.method})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600 dark:text-slate-400 font-mono",children:r.endpoint}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded ${r.status_code>=200&&r.status_code<300?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":r.status_code>=400?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-400"}`,children:r.status_code})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600 dark:text-slate-400 font-mono",children:r.ip_address||"-"})]},r.id))})]})})]})})]})}function Ye(){const[i,U]=l.useState([]),[d,z]=l.useState(null),[f,$]=l.useState(null),[R,I]=l.useState(null),[v,_]=l.useState(!0),[S,j]=l.useState(!1),[y,q]=l.useState("overview");l.useEffect(()=>{B()},[]);const B=async()=>{try{_(!0);const{data:c}=await p.from("paas_billing_periods").select("*").order("period_start",{ascending:!1}).limit(50);U(c||[]);const{data:b}=await p.from("paas_api_usage").select("execution_time_ms, request_size, response_size");if(b&&b.length>0){const A={totalRequests:b.length,totalDataMB:b.reduce((C,n)=>C+(n.request_size+n.response_size)/1048576,0),totalCost:(c==null?void 0:c.reduce((C,n)=>C+parseFloat(n.final_cost_points||"0"),0))||0,avgExecutionTime:b.reduce((C,n)=>C+n.execution_time_ms,0)/b.length};I(A)}}catch(c){console.error("Error loading billing data:",c)}finally{_(!1)}},V=async c=>{try{const{data:b}=await p.from("paas_ai_banker_decisions").select("*").eq("billing_period_id",c).maybeSingle();$(b)}catch(b){console.error("Error loading AI decision:",b)}},w=async c=>{try{j(!0);const b=prompt("Enter admin API key to calculate billing:");if(!b)return;const A=await fetch("https://mablckeofkddwjgxhnbe.supabase.co/functions/v1/paas-billing-processor?action=calculate_billing",{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":b,Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1hYmxja2VvZmtkZHdqZ3hobmJlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNDUxNTQsImV4cCI6MjA4MTgyMTE1NH0.mO0bo8MtAF4RJUrCqQLYfz-BFbH8eUj5WmhCT2-hn-c"},body:JSON.stringify({action:"calculate_billing",billingPeriodId:c})});if(!A.ok){const n=await A.json();throw new Error(n.error||"Failed to calculate billing")}const C=await A.json();alert(`Billing calculated successfully!

Base Cost: ${C.data.pricing.baseCost.toFixed(2)} points
AI Adjustment: ${C.data.pricing.adjustmentFactor}x
Final Cost: ${C.data.pricing.finalCost.toFixed(2)} points

AI Reasoning: ${C.data.aiDecision.reasoning}`),await B()}catch(b){console.error("Error calculating billing:",b),alert("Failed to calculate billing: "+(b instanceof Error?b.message:"Unknown error"))}finally{j(!1)}},K=async c=>{try{j(!0);const b=prompt("Enter admin API key to process payment:");if(!b)return;const A=await fetch("https://mablckeofkddwjgxhnbe.supabase.co/functions/v1/paas-billing-processor?action=process_payment",{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":b,Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1hYmxja2VvZmtkZHdqZ3hobmJlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNDUxNTQsImV4cCI6MjA4MTgyMTE1NH0.mO0bo8MtAF4RJUrCqQLYfz-BFbH8eUj5WmhCT2-hn-c"},body:JSON.stringify({action:"process_payment",billingPeriodId:c})});if(!A.ok){const n=await A.json();throw new Error(n.error||"Failed to process payment")}const C=await A.json();alert(`Payment processed successfully!

Amount Paid: ${C.data.amountPaid.toFixed(2)} points
New Balance: ${C.data.newBalance.toFixed(2)} points`),await B()}catch(b){console.error("Error processing payment:",b),alert("Failed to process payment: "+(b instanceof Error?b.message:"Unknown error"))}finally{j(!1)}},x=c=>{switch(c){case"paid":return e.jsx(Q,{className:"w-5 h-5 text-green-500"});case"calculated":return e.jsx(oe,{className:"w-5 h-5 text-blue-500"});case"pending":return e.jsx(se,{className:"w-5 h-5 text-yellow-500"});default:return e.jsx(oe,{className:"w-5 h-5 text-gray-500"})}};return v?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(pe,{className:"w-8 h-8 animate-spin text-blue-500"})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"API Billing & Usage"}),e.jsx("p",{className:"text-gray-600",children:"AI-powered billing system for PaaS API usage"})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>q("overview"),className:`px-6 py-3 rounded-lg font-medium transition-colors ${y==="overview"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(W,{className:"w-5 h-5 inline mr-2"}),"Overview"]}),e.jsxs("button",{onClick:()=>q("periods"),className:`px-6 py-3 rounded-lg font-medium transition-colors ${y==="periods"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(_e,{className:"w-5 h-5 inline mr-2"}),"Billing Periods"]}),e.jsxs("button",{onClick:()=>q("usage"),className:`px-6 py-3 rounded-lg font-medium transition-colors ${y==="usage"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(re,{className:"w-5 h-5 inline mr-2"}),"Usage Stats"]})]}),y==="overview"&&R&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-gray-600 text-sm font-medium",children:"Total Requests"}),e.jsx(W,{className:"w-5 h-5 text-blue-500"})]}),e.jsx("p",{className:"text-3xl font-bold",children:R.totalRequests.toLocaleString()})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-gray-600 text-sm font-medium",children:"Data Transferred"}),e.jsx(Ae,{className:"w-5 h-5 text-green-500"})]}),e.jsxs("p",{className:"text-3xl font-bold",children:[R.totalDataMB.toFixed(2)," MB"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-gray-600 text-sm font-medium",children:"Total Cost"}),e.jsx(be,{className:"w-5 h-5 text-purple-500"})]}),e.jsxs("p",{className:"text-3xl font-bold",children:[R.totalCost.toFixed(2)," pts"]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["≈ £",(R.totalCost*.75).toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-gray-600 text-sm font-medium",children:"Avg Response Time"}),e.jsx(oe,{className:"w-5 h-5 text-orange-500"})]}),e.jsxs("p",{className:"text-3xl font-bold",children:[R.avgExecutionTime.toFixed(0),"ms"]})]})]}),y==="periods"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-bold",children:"Billing Periods"})}),e.jsxs("div",{className:"divide-y divide-gray-200",children:[i.map(c=>e.jsx("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[x(c.status),e.jsxs("span",{className:"font-mono text-sm text-gray-500",children:[new Date(c.period_start).toLocaleDateString()," - ",new Date(c.period_end).toLocaleDateString()]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${c.status==="paid"?"bg-green-100 text-green-700":c.status==="calculated"?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700"}`,children:c.status.toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Requests"}),e.jsx("p",{className:"text-lg font-semibold",children:c.total_requests.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Data Transfer"}),e.jsxs("p",{className:"text-lg font-semibold",children:[parseFloat(String(c.total_data_transferred_mb||"0")).toFixed(2)," MB"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Base Cost"}),e.jsxs("p",{className:"text-lg font-semibold",children:[parseFloat(String(c.base_cost_points||"0")).toFixed(2)," pts"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Final Cost"}),e.jsxs("p",{className:"text-lg font-bold text-purple-600",children:[parseFloat(String(c.final_cost_points||"0")).toFixed(2)," pts"]})]})]}),c.ai_reasoning&&e.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(he,{className:"w-5 h-5 text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"AI Banker Analysis"}),e.jsx("p",{className:"text-sm text-blue-700",children:c.ai_reasoning})]})]})})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[c.status==="pending"&&e.jsxs("button",{onClick:()=>w(c.id),disabled:S,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(he,{className:"w-4 h-4 inline mr-2"}),"Calculate"]}),c.status==="calculated"&&e.jsxs("button",{onClick:()=>K(c.id),disabled:S,className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(fe,{className:"w-4 h-4 inline mr-2"}),"Process Payment"]}),e.jsx("button",{onClick:()=>{z(c),V(c.id)},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Details"})]})]})},c.id)),i.length===0&&e.jsxs("div",{className:"p-12 text-center text-gray-500",children:[e.jsx(_e,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No billing periods found"})]})]})]}),d&&f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold",children:"AI Banker Decision Details"}),e.jsx("button",{onClick:()=>{z(null),$(null)},className:"text-gray-500 hover:text-gray-700",children:"×"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Usage Summary"}),e.jsx("pre",{className:"bg-gray-50 p-4 rounded-lg text-sm overflow-x-auto",children:JSON.stringify(f.usage_summary,null,2)})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"AI Analysis"}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsx("p",{className:"text-sm",children:f.ai_analysis})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Base Cost"}),e.jsxs("p",{className:"text-lg font-semibold",children:[f.base_calculation.toFixed(2)," pts"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"AI Adjustment"}),e.jsxs("p",{className:"text-lg font-semibold",children:[f.ai_adjustment_factor,"x"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Final Cost"}),e.jsxs("p",{className:"text-lg font-bold text-purple-600",children:[f.final_cost.toFixed(2)," pts"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Reasoning"}),e.jsx("p",{className:"text-sm text-gray-700",children:f.reasoning})]})]})]})})]})}const Ge={activity:W,"credit-card":fe,server:Oe,code:Ke,"alert-circle":se,wallet:me,coins:be};function He(){const[i,U]=l.useState([]),[d,z]=l.useState(null),[f,$]=l.useState(null),[R,I]=l.useState([]),[v,_]=l.useState([]),[S,j]=l.useState(!0),[y,q]=l.useState("overview"),[B,V]=l.useState(!1),[w,K]=l.useState(null),[x,c]=l.useState({allocationPercentage:0,budgetLimit:0,autoRefillEnabled:!1,autoRefillThreshold:0,autoRefillAmount:0});l.useEffect(()=>{b(),C()},[]);const b=async()=>{try{j(!0);const{data:{user:t}}=await p.auth.getUser();if(!t)return;const{data:g}=await p.from("paas_developers").select("id").eq("user_id",t.id).maybeSingle();if(!g)return;const{data:L}=await p.from("paas_developer_reserves").select(`
          *,
          paas_reserve_categories (*)
        `).eq("developer_id",g.id).eq("is_active",!0).order("created_at",{ascending:!0});U(L||[]);const{data:P}=await p.from("paas_reserve_ai_recommendations").select("*").eq("developer_id",g.id).eq("applied",!1).order("created_at",{ascending:!1}).limit(1);P&&P.length>0&&(z(P[0]),V(!0))}catch(t){console.error("Error loading reserves:",t)}finally{j(!1)}},A=async t=>{try{const{data:g}=await p.from("paas_reserve_transactions").select("*").eq("reserve_id",t).order("created_at",{ascending:!1}).limit(50);I(g||[]);const{data:L}=await p.from("paas_reserve_allocations").select("*").eq("reserve_id",t).order("created_at",{ascending:!1}).limit(50);_(L||[])}catch(g){console.error("Error loading history:",g)}},C=()=>{const t=p.channel("developer_reserves_changes").on("postgres_changes",{event:"*",schema:"public",table:"paas_developer_reserves"},()=>b()).on("postgres_changes",{event:"*",schema:"public",table:"paas_reserve_ai_recommendations"},()=>b()).subscribe();return()=>{p.removeChannel(t)}},n=async()=>{if(d)try{const{data:{user:t}}=await p.auth.getUser();if(!t)return;const{data:g}=await p.from("paas_developers").select("id").eq("user_id",t.id).maybeSingle();if(!g)return;const L=d.recommended_allocations;for(const P of i){const te=P.paas_reserve_categories.name,Y=L[te];Y!==void 0&&await p.from("paas_developer_reserves").update({allocation_percentage:Y}).eq("id",P.id)}await p.from("paas_reserve_ai_recommendations").update({applied:!0,applied_at:new Date().toISOString()}).eq("id",d.id),V(!1),await b(),alert("AI recommendation applied successfully!")}catch(t){console.error("Error applying AI recommendation:",t),alert("Failed to apply recommendation")}},E=async()=>{if(w)try{const{error:t}=await p.from("paas_developer_reserves").update({allocation_percentage:x.allocationPercentage,budget_limit_points:x.budgetLimit||null,auto_refill_enabled:x.autoRefillEnabled,auto_refill_threshold:x.autoRefillThreshold,auto_refill_amount:x.autoRefillAmount,updated_at:new Date().toISOString()}).eq("id",w.id);if(t)throw t;K(null),await b(),alert("Settings updated successfully!")}catch(t){console.error("Error updating settings:",t),alert("Failed to update settings")}},r=t=>Ge[t]||me,o=i.reduce((t,g)=>t+parseFloat(g.balance_points.toString()),0),h=i.reduce((t,g)=>t+parseFloat(g.total_allocated.toString()),0),N=i.reduce((t,g)=>t+parseFloat(g.total_spent.toString()),0);return S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(pe,{className:"w-8 h-8 animate-spin text-blue-500"})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Developer Reserve Pools"}),e.jsx("p",{className:"text-gray-600",children:"Manage and allocate your funding across different categories"})]}),B&&d&&e.jsx("div",{className:"mb-6 bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(he,{className:"w-8 h-8 text-blue-500 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"AI Banker Recommendation"}),e.jsx("p",{className:"text-gray-700 mb-4",children:d.reasoning}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-4",children:Object.entries(d.recommended_allocations).map(([t,g])=>e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:t.replace("_"," ").toUpperCase()}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[g,"%"]})]},t))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Apply Recommendation"}),e.jsx("button",{onClick:()=>V(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Dismiss"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-gray-600 text-sm font-medium",children:"Total Reserve Balance"}),e.jsx(me,{className:"w-5 h-5 text-green-500"})]}),e.jsxs("p",{className:"text-3xl font-bold",children:[o.toFixed(2)," pts"]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["≈ £",(o*.75).toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-gray-600 text-sm font-medium",children:"Total Allocated"}),e.jsx(re,{className:"w-5 h-5 text-blue-500"})]}),e.jsxs("p",{className:"text-3xl font-bold",children:[h.toFixed(2)," pts"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-gray-600 text-sm font-medium",children:"Total Spent"}),e.jsx(be,{className:"w-5 h-5 text-purple-500"})]}),e.jsxs("p",{className:"text-3xl font-bold",children:[N.toFixed(2)," pts"]})]})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>q("overview"),className:`px-6 py-3 rounded-lg font-medium transition-colors ${y==="overview"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx($e,{className:"w-5 h-5 inline mr-2"}),"Overview"]}),e.jsxs("button",{onClick:()=>q("settings"),className:`px-6 py-3 rounded-lg font-medium transition-colors ${y==="settings"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(Te,{className:"w-5 h-5 inline mr-2"}),"Settings"]}),e.jsxs("button",{onClick:()=>q("history"),className:`px-6 py-3 rounded-lg font-medium transition-colors ${y==="history"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(ke,{className:"w-5 h-5 inline mr-2"}),"History"]})]}),y==="overview"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(t=>{const g=r(t.paas_reserve_categories.icon),L=t.budget_limit_points?parseFloat(t.total_spent.toString())/parseFloat(t.budget_limit_points.toString())*100:0;return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-50 rounded-lg",children:e.jsx(g,{className:"w-6 h-6 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:t.paas_reserve_categories.display_name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.allocation_percentage,"% allocation"]})]})]})}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:t.paas_reserve_categories.description}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Balance"}),e.jsxs("span",{className:"text-lg font-bold",children:[parseFloat(t.balance_points.toString()).toFixed(2)," pts"]})]})}),e.jsx("div",{children:e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Allocated"}),e.jsxs("span",{className:"text-sm font-semibold",children:[parseFloat(t.total_allocated.toString()).toFixed(2)," pts"]})]})}),e.jsx("div",{children:e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Spent"}),e.jsxs("span",{className:"text-sm font-semibold",children:[parseFloat(t.total_spent.toString()).toFixed(2)," pts"]})]})}),t.budget_limit_points&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Budget Utilization"}),e.jsxs("span",{className:"text-sm font-semibold",children:[L.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${L>80?"bg-red-500":L>60?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(L,100)}%`}})})]}),t.auto_refill_enabled&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-2",children:e.jsxs("p",{className:"text-xs text-green-700",children:[e.jsx(Q,{className:"w-3 h-3 inline mr-1"}),"Auto-refill enabled"]})})]}),e.jsxs("button",{onClick:()=>{$(t),A(t.id),q("history")},className:"mt-4 w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:["View Details",e.jsx(Be,{className:"w-4 h-4 inline ml-2"})]})]})},t.id)})}),y==="settings"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-bold",children:"Reserve Settings"})}),e.jsx("div",{className:"divide-y divide-gray-200",children:i.map(t=>{const g=r(t.paas_reserve_categories.icon),L=(w==null?void 0:w.id)===t.id;return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"w-6 h-6 text-blue-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:t.paas_reserve_categories.display_name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.paas_reserve_categories.description})]})]}),!L&&e.jsx("button",{onClick:()=>{K(t),c({allocationPercentage:t.allocation_percentage,budgetLimit:t.budget_limit_points||0,autoRefillEnabled:t.auto_refill_enabled,autoRefillThreshold:t.auto_refill_threshold,autoRefillAmount:t.auto_refill_amount})},className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Edit"})]}),L?e.jsxs("div",{className:"space-y-4 bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Allocation Percentage"}),e.jsx("input",{type:"number",min:"0",max:"100",value:x.allocationPercentage,onChange:P=>c({...x,allocationPercentage:parseFloat(P.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Budget Limit (points)"}),e.jsx("input",{type:"number",min:"0",value:x.budgetLimit,onChange:P=>c({...x,budgetLimit:parseFloat(P.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:x.autoRefillEnabled,onChange:P=>c({...x,autoRefillEnabled:P.target.checked}),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Enable Auto-Refill"})]})}),x.autoRefillEnabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Refill Threshold (points)"}),e.jsx("input",{type:"number",min:"0",value:x.autoRefillThreshold,onChange:P=>c({...x,autoRefillThreshold:parseFloat(P.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Refill Amount (points)"}),e.jsx("input",{type:"number",min:"0",value:x.autoRefillAmount,onChange:P=>c({...x,autoRefillAmount:parseFloat(P.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:E,className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:"Save Changes"}),e.jsx("button",{onClick:()=>K(null),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"})]})]}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Allocation"}),e.jsxs("p",{className:"text-lg font-bold",children:[t.allocation_percentage,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Budget Limit"}),e.jsx("p",{className:"text-lg font-bold",children:t.budget_limit_points?`${t.budget_limit_points} pts`:"None"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Auto-Refill"}),e.jsx("p",{className:"text-lg font-bold",children:t.auto_refill_enabled?"Enabled":"Disabled"})]}),t.auto_refill_enabled&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Refill At"}),e.jsxs("p",{className:"text-lg font-bold",children:[t.auto_refill_threshold," pts"]})]})]})]},t.id)})})]}),y==="history"&&f&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Transaction History"}),e.jsx("p",{className:"text-sm text-gray-600",children:f.paas_reserve_categories.display_name})]}),e.jsxs("div",{className:"divide-y divide-gray-200 max-h-96 overflow-y-auto",children:[R.map(t=>e.jsx("div",{className:"p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.transaction_type.replace("_"," ").toUpperCase()}),e.jsx("p",{className:"text-sm text-gray-600",children:t.description||"No description"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(t.created_at).toLocaleString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`text-lg font-bold ${parseFloat(t.amount_points.toString())<0?"text-red-500":"text-green-500"}`,children:[parseFloat(t.amount_points.toString())>0?"+":"",parseFloat(t.amount_points.toString()).toFixed(2)," pts"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Balance: ",parseFloat(t.balance_after.toString()).toFixed(2)," pts"]})]})]})},t.id)),R.length===0&&e.jsxs("div",{className:"p-12 text-center text-gray-500",children:[e.jsx(ke,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No transactions yet"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-xl font-bold",children:"Allocation History"})}),e.jsxs("div",{className:"divide-y divide-gray-200 max-h-96 overflow-y-auto",children:[v.map(t=>e.jsx("div",{className:"p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.source.replace("_"," ").toUpperCase()}),e.jsx("p",{className:"text-sm text-gray-600",children:t.allocation_reason}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(t.created_at).toLocaleString()})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-lg font-bold text-green-500",children:["+",parseFloat(t.amount_points.toString()).toFixed(2)," pts"]})})]})},t.id)),v.length===0&&e.jsxs("div",{className:"p-12 text-center text-gray-500",children:[e.jsx(re,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No allocations yet"})]})]})]})]})]})}function Ze({onLogout:i}){const[U]=l.useState(!0),[d,z]=l.useState("overview"),[f,$]=l.useState([]),[R,I]=l.useState([]),[v,_]=l.useState([]),[S,j]=l.useState({totalDevelopers:0,activeDevelopers:0,totalPoints:0,totalRevenue:0,apiCalls24h:0}),[y,q]=l.useState([]),[B,V]=l.useState(""),[w,K]=l.useState("all"),[x,c]=l.useState(null),[b,A]=l.useState(!1),[C,n]=l.useState(""),[E,r]=l.useState("");l.useEffect(()=>(U&&(o(),t()),()=>{g()}),[U]);const o=async()=>{try{const{supabase:s}=await M(async()=>{const{supabase:X}=await import("./index-CGemffCt.js").then(ee=>ee.a9);return{supabase:X}},__vite__mapDeps([0,1])),{data:u}=await s.from("paas_developers").select("*").order("created_at",{ascending:!1}),{data:F}=await s.from("paas_security_events").select("*").order("created_at",{ascending:!1}).limit(50),{data:D}=await s.from("paas_transactions").select("*").order("created_at",{ascending:!1}).limit(100),{data:T}=await s.from("paas_point_accounts").select("balance_points, total_spent"),G=(T==null?void 0:T.reduce((X,ee)=>X+parseFloat(ee.balance_points),0))||0,Z=(T==null?void 0:T.reduce((X,ee)=>X+parseFloat(ee.total_spent),0))||0;$(u||[]),I(F||[]),_(D||[]),j({totalDevelopers:(u==null?void 0:u.length)||0,activeDevelopers:(u==null?void 0:u.filter(X=>X.subscription_status==="active").length)||0,totalPoints:G,totalRevenue:Z*.75,apiCalls24h:(D==null?void 0:D.filter(X=>{const ee=new Date(X.created_at),ne=new Date(Date.now()-1440*60*1e3);return ee>ne}).length)||0})}catch(s){console.error("Error loading PaaS data:",s)}},h=async s=>{try{const{supabase:u}=await M(async()=>{const{supabase:F}=await import("./index-CGemffCt.js").then(D=>D.a9);return{supabase:F}},__vite__mapDeps([0,1]));await u.from("paas_developers").update({is_verified:!0,verification_date:new Date().toISOString()}).eq("id",s),o()}catch(u){console.error("Error verifying developer:",u)}},N=async s=>{try{const{supabase:u}=await M(async()=>{const{supabase:F}=await import("./index-CGemffCt.js").then(D=>D.a9);return{supabase:F}},__vite__mapDeps([0,1]));await u.from("paas_developers").update({subscription_status:"suspended"}).eq("id",s),o()}catch(u){console.error("Error suspending developer:",u)}},t=async()=>{try{const{supabase:s}=await M(async()=>{const{supabase:G}=await import("./index-CGemffCt.js").then(Z=>Z.a9);return{supabase:G}},__vite__mapDeps([0,1])),u=s.channel("paas-developers-changes").on("postgres_changes",{event:"*",schema:"public",table:"paas_developers"},()=>{o()}).subscribe(),F=s.channel("paas-security-changes").on("postgres_changes",{event:"*",schema:"public",table:"paas_security_events"},()=>{o()}).subscribe(),D=s.channel("paas-transactions-changes").on("postgres_changes",{event:"*",schema:"public",table:"paas_transactions"},()=>{o()}).subscribe(),T=s.channel("paas-accounts-changes").on("postgres_changes",{event:"*",schema:"public",table:"paas_point_accounts"},()=>{o()}).subscribe();q([u,F,D,T])}catch(s){console.error("Error setting up real-time subscriptions:",s)}},g=async()=>{try{const{supabase:s}=await M(async()=>{const{supabase:u}=await import("./index-CGemffCt.js").then(F=>F.a9);return{supabase:u}},__vite__mapDeps([0,1]));y.forEach(u=>{s.removeChannel(u)}),q([])}catch(s){console.error("Error cleaning up subscriptions:",s)}},L=async s=>{try{const{supabase:u}=await M(async()=>{const{supabase:G}=await import("./index-CGemffCt.js").then(Z=>Z.a9);return{supabase:G}},__vite__mapDeps([0,1])),{data:F}=await u.from("paas_developers").select("*").eq("id",s).single(),{data:D}=await u.from("paas_point_accounts").select("*").eq("developer_id",s).maybeSingle(),{data:T}=await u.from("paas_api_keys").select("*").eq("developer_id",s);c({...F,point_account:D,api_keys:T||[]}),A(!0)}catch(u){console.error("Error loading developer details:",u)}},P=async()=>{if(!(!x||!C||!E))try{const{supabase:s}=await M(async()=>{const{supabase:G}=await import("./index-CGemffCt.js").then(Z=>Z.a9);return{supabase:G}},__vite__mapDeps([0,1])),u=parseFloat(C),{data:F}=await s.from("paas_point_accounts").select("balance_points").eq("developer_id",x.id).single(),D=parseFloat((F==null?void 0:F.balance_points)||"0"),T=D+u;await s.from("paas_transactions").insert({developer_id:x.id,transaction_type:"grant",amount_points:u,balance_before:D,balance_after:T,metadata:{reason:E,admin_action:!0}}),n(""),r(""),A(!1),o()}catch(s){console.error("Error adding points:",s)}},te=async s=>{try{const{supabase:u}=await M(async()=>{const{supabase:F}=await import("./index-CGemffCt.js").then(D=>D.a9);return{supabase:F}},__vite__mapDeps([0,1]));await u.from("paas_api_keys").update({is_active:!1}).eq("id",s),x&&L(x.id)}catch(u){console.error("Error revoking API key:",u)}},Y=()=>{const s={developers:f,transactions:v.slice(0,100),securityEvents:R.slice(0,50),stats:S,exportedAt:new Date().toISOString()},u=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),F=URL.createObjectURL(u),D=document.createElement("a");D.href=F,D.download=`paas-admin-export-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(F)},J=f.filter(s=>{const u=s.email.toLowerCase().includes(B.toLowerCase())||(s.organization_name||"").toLowerCase().includes(B.toLowerCase()),F=w==="all"||s.subscription_status===w;return u&&F});return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"text-blue-600 dark:text-blue-400",size:32}),e.jsx("h2",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"Stanzalink PaaS Admin"})]}),i&&e.jsx("button",{onClick:i,className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg font-medium transition-colors",children:"Logout"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ge,{className:"text-blue-600 dark:text-blue-400",size:24}),e.jsx("span",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:S.totalDevelopers})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total Developers"}),e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:[S.activeDevelopers," active"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ce,{className:"text-amber-600 dark:text-amber-400",size:24}),e.jsx("span",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:S.totalPoints.toLocaleString()})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total Points"}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:["£",(S.totalPoints*.75).toFixed(2)," value"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(be,{className:"text-green-600 dark:text-green-400",size:24}),e.jsxs("span",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:["£",S.totalRevenue.toFixed(2)]})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total Revenue"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"£0.75 per point spent"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(re,{className:"text-blue-600 dark:text-blue-400",size:24}),e.jsx("span",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:S.apiCalls24h})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"API Calls (24h)"}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:"Active system"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm mb-8",children:[e.jsx("div",{className:"border-b border-slate-200 dark:border-slate-700 overflow-x-auto",children:e.jsxs("div",{className:"flex gap-2 px-4 md:gap-4 md:px-6 min-w-max md:min-w-0",children:[e.jsxs("button",{onClick:()=>z("overview"),className:`py-3 px-3 md:py-4 md:px-4 border-b-2 font-medium transition-colors whitespace-nowrap flex items-center gap-2 ${d==="overview"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(W,{size:18}),e.jsx("span",{children:"Overview"})]}),e.jsxs("button",{onClick:()=>z("developers"),className:`py-3 px-3 md:py-4 md:px-4 border-b-2 font-medium transition-colors whitespace-nowrap flex items-center gap-2 ${d==="developers"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(ge,{size:18}),e.jsx("span",{children:"Developers"})]}),e.jsxs("button",{onClick:()=>z("security"),className:`py-3 px-3 md:py-4 md:px-4 border-b-2 font-medium transition-colors whitespace-nowrap flex items-center gap-2 ${d==="security"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(ve,{size:18}),e.jsx("span",{children:"Security"})]}),e.jsxs("button",{onClick:()=>z("transactions"),className:`py-3 px-3 md:py-4 md:px-4 border-b-2 font-medium transition-colors whitespace-nowrap flex items-center gap-2 ${d==="transactions"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(ce,{size:18}),e.jsx("span",{children:"Transactions"})]}),e.jsxs("button",{onClick:()=>z("api-keys"),className:`py-3 px-3 md:py-4 md:px-4 border-b-2 font-medium transition-colors whitespace-nowrap flex items-center gap-2 ${d==="api-keys"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(ae,{size:18}),e.jsx("span",{children:"External API"})]}),e.jsxs("button",{onClick:()=>z("billing"),className:`py-3 px-3 md:py-4 md:px-4 border-b-2 font-medium transition-colors whitespace-nowrap flex items-center gap-2 ${d==="billing"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(fe,{size:18}),e.jsx("span",{children:"Billing"})]}),e.jsxs("button",{onClick:()=>z("reserves"),className:`py-3 px-3 md:py-4 md:px-4 border-b-2 font-medium transition-colors whitespace-nowrap flex items-center gap-2 ${d==="reserves"?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(me,{size:18}),e.jsx("span",{children:"Reserves"})]})]})}),e.jsxs("div",{className:"p-6",children:[d==="overview"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-900 dark:text-white mb-4",children:"System Health"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsx(Q,{className:"text-green-600 dark:text-green-400 mb-2",size:24}),e.jsx("p",{className:"font-semibold text-green-900 dark:text-green-100",children:"All Systems Operational"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mt-1",children:"99.9% uptime"})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx(W,{className:"text-blue-600 dark:text-blue-400 mb-2",size:24}),e.jsx("p",{className:"font-semibold text-blue-900 dark:text-blue-100",children:"API Response Time"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1",children:"Average 120ms"})]}),e.jsxs("div",{className:"p-4 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800",children:[e.jsx(ie,{className:"text-amber-600 dark:text-amber-400 mb-2",size:24}),e.jsx("p",{className:"font-semibold text-amber-900 dark:text-amber-100",children:"Security Events"}),e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 mt-1",children:[R.length," total"]})]})]})]})}),d==="developers"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:"Developer Management"}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx("button",{onClick:()=>o(),className:"p-2 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg transition-colors",title:"Refresh",children:e.jsx(pe,{size:18})}),e.jsxs("button",{onClick:Y,className:"flex items-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm",children:[e.jsx(Ae,{size:18}),"Export"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{type:"text",value:B,onChange:s=>V(s.target.value),placeholder:"Search by email or organization...",className:"w-full pl-10 pr-4 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white"})]}),e.jsxs("select",{value:w,onChange:s=>K(s.target.value),className:"px-4 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"suspended",children:"Suspended"})]})]}),e.jsxs("div",{className:"space-y-3",children:[J.map(s=>e.jsx("div",{className:"p-4 border border-slate-200 dark:border-slate-700 rounded-lg hover:border-slate-300 dark:hover:border-slate-600 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:s.email})}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:[s.organization_name||"No organization"," • Joined ",new Date(s.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded ${s.subscription_status==="active"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":s.subscription_status==="suspended"?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-400"}`,children:s.subscription_status}),s.is_verified&&e.jsxs("span",{className:"px-2 py-1 text-xs rounded bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 flex items-center gap-1",children:[e.jsx(Q,{size:12}),"Verified"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>L(s.id),className:"px-3 py-1.5 bg-blue-500 hover:bg-blue-600 text-white text-sm rounded-lg transition-colors flex items-center gap-1",children:[e.jsx(Ee,{size:14}),"Details"]}),!s.is_verified&&e.jsxs("button",{onClick:()=>h(s.id),className:"px-3 py-1.5 bg-green-500 hover:bg-green-600 text-white text-sm rounded-lg transition-colors flex items-center gap-1",children:[e.jsx(Q,{size:14}),"Verify"]}),s.subscription_status!=="suspended"&&e.jsxs("button",{onClick:()=>N(s.id),className:"px-3 py-1.5 bg-red-500 hover:bg-red-600 text-white text-sm rounded-lg transition-colors flex items-center gap-1",children:[e.jsx(Ue,{size:14}),"Suspend"]})]})]})},s.id)),J.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ge,{className:"mx-auto mb-4 text-slate-300 dark:text-slate-600",size:48}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"No developers found"})]})]})]}),d==="security"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-900 dark:text-white mb-4",children:"Security Events"}),e.jsx("div",{className:"space-y-3",children:R.map(s=>e.jsx("div",{className:"p-4 border border-slate-200 dark:border-slate-700 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[s.severity==="critical"?e.jsx(ue,{className:"text-red-600 dark:text-red-400 mt-1",size:20}):e.jsx(ve,{className:"text-amber-600 dark:text-amber-400 mt-1",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:s.event_type}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:s.reason}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-500 mt-1",children:new Date(s.created_at).toLocaleString()})]})]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${s.severity==="critical"?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400":s.severity==="high"?"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400":"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400"}`,children:s.severity})]})},s.id))})]}),d==="transactions"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-900 dark:text-white mb-4",children:"Recent Transactions"}),e.jsx("div",{className:"space-y-3",children:v.map(s=>e.jsx("div",{className:"p-4 border border-slate-200 dark:border-slate-700 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:s.transaction_type}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:s.endpoint||"No endpoint"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-500 mt-1",children:new Date(s.created_at).toLocaleString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`font-semibold ${parseFloat(s.amount_points.toString())>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[parseFloat(s.amount_points.toString())>0?"+":"",s.amount_points," points"]}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:["£",Math.abs(parseFloat(s.amount_gbp.toString())).toFixed(2)]})]})]})},s.id))})]}),d==="api-keys"&&e.jsx(Je,{}),d==="billing"&&e.jsx(Ye,{}),d==="reserves"&&e.jsx(He,{})]})]}),b&&x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:x.email}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:x.organization_name||"No organization"})]}),e.jsx("button",{onClick:()=>A(!1),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(ue,{className:"text-slate-600 dark:text-slate-400",size:24})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(ie,{size:20}),"Account Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Status"}),e.jsx("span",{className:`inline-block mt-1 px-2 py-1 text-xs rounded ${x.subscription_status==="active"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-400"}`,children:x.subscription_status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Verified"}),e.jsx("p",{className:"font-medium text-slate-900 dark:text-white mt-1",children:x.is_verified?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Member Since"}),e.jsx("p",{className:"font-medium text-slate-900 dark:text-white mt-1",children:new Date(x.created_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Developer ID"}),e.jsx("p",{className:"font-mono text-xs text-slate-900 dark:text-white mt-1 break-all",children:x.id})]})]})]}),x.point_account&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(ce,{size:20}),"Point Account"]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Balance"}),e.jsx("p",{className:"text-lg font-bold text-slate-900 dark:text-white",children:parseFloat(x.point_account.balance_points.toString()).toLocaleString()}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"points"})]}),e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"GBP Value"}),e.jsxs("p",{className:"text-lg font-bold text-slate-900 dark:text-white",children:["£",parseFloat(x.point_account.balance_gbp.toString()).toFixed(2)]})]}),e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Total Earned"}),e.jsx("p",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:parseFloat(x.point_account.total_earned.toString()).toLocaleString()})]}),e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Total Spent"}),e.jsx("p",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:parseFloat(x.point_account.total_spent.toString()).toLocaleString()})]})]}),e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsx("h5",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-3",children:"Add Points"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"number",value:C,onChange:s=>n(s.target.value),placeholder:"Amount",className:"w-full px-3 py-2 bg-white dark:bg-slate-700 border border-blue-300 dark:border-blue-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white"}),e.jsx("input",{type:"text",value:E,onChange:s=>r(s.target.value),placeholder:"Reason for grant",className:"w-full px-3 py-2 bg-white dark:bg-slate-700 border border-blue-300 dark:border-blue-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white"}),e.jsx("button",{onClick:P,disabled:!C||!E,className:"w-full py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 dark:disabled:bg-slate-600 text-white rounded-lg font-medium transition-colors disabled:cursor-not-allowed",children:"Grant Points"})]})]})]}),x.api_keys&&x.api_keys.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(ae,{size:20}),"API Keys (",x.api_keys.length,")"]}),e.jsx("div",{className:"space-y-3",children:x.api_keys.map(s=>e.jsx("div",{className:"p-3 border border-slate-200 dark:border-slate-700 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:s.name}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 font-mono",children:[s.key_prefix,"..."]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${s.is_active?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400"}`,children:s.is_active?"Active":"Revoked"}),s.last_used_at&&e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:["Last used: ",new Date(s.last_used_at).toLocaleDateString()]})]})]}),s.is_active&&e.jsx("button",{onClick:()=>te(s.id),className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white text-sm rounded-lg transition-colors",children:"Revoke"})]})},s.id))})]})]})]})})]})}function Xe(){const[i,U]=l.useState(null),[d,z]=l.useState([]),[f,$]=l.useState(!0);if(l.useEffect(()=>{(async()=>{try{const[j,y]=await Promise.all([p.from("distribution_progress").select("*").order("started_at",{ascending:!1}).limit(1).maybeSingle(),p.from("economy_funds").select("fund_type, remaining_amount").order("fund_type")]);if(j.error)throw j.error;if(y.error)throw y.error;U(j.data),z(y.data||[])}catch(j){console.error("Error fetching data:",j)}finally{$(!1)}})();const S=p.channel("distribution_realtime").on("postgres_changes",{event:"*",schema:"public",table:"distribution_progress"},j=>{U(j.new),$(!1)}).on("postgres_changes",{event:"*",schema:"public",table:"economy_funds"},async()=>{const{data:j}=await p.from("economy_funds").select("fund_type, remaining_amount").order("fund_type");j&&z(j)}).subscribe();return()=>{p.removeChannel(S)}},[]),f)return e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Se,{className:"w-6 h-6 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600 dark:text-gray-300",children:"Loading distribution status..."})]})});if(!i)return e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"No distribution progress available"})});const R=i.status==="running",I=i.status==="completed",v=i.status==="failed";return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Daily Distribution Progress"}),e.jsxs("div",{className:"flex items-center gap-2",children:[R&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-5 h-5 animate-spin text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-600",children:"Running"})]}),I&&e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-600",children:"Completed"})]}),v&&e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-sm font-medium text-red-600",children:"Failed"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-300 mb-2",children:[e.jsxs("span",{children:[i.processed_users.toLocaleString()," / ",i.total_users.toLocaleString()," users"]}),e.jsxs("span",{className:"font-semibold",children:[i.progress_percentage.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-300 rounded-full ${I?"bg-green-600":v?"bg-red-600":"bg-blue-600 animate-pulse"}`,style:{width:`${i.progress_percentage}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Points per User"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:i.points_per_user})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Total Distributed"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:i.total_points_distributed.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Batch Progress"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-white",children:[i.current_batch," / ",i.total_batches]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Distribution Date"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:new Date(i.distribution_date).toLocaleDateString()})]})]}),d.length>0&&e.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Economy Fund Balance (Real-Time)"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:d.map(_=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 capitalize mb-1",children:_.fund_type}),e.jsxs("p",{className:"text-sm font-bold text-gray-900 dark:text-white",children:["£",(Number(_.remaining_amount)/1e9).toFixed(2),"B"]})]},_.fund_type))}),e.jsx("div",{className:"mt-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium",children:["Total Annual Budget: £",(d.reduce((_,S)=>_+Number(S.remaining_amount),0)/1e9).toFixed(2),"B remaining"]})})]}),v&&i.error_message&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200 font-medium",children:"Error:"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:i.error_message})]}),i.completed_at&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:[I?"Completed":"Failed"," at"," ",new Date(i.completed_at).toLocaleTimeString()]})]})]})}function Qe(){const[i,U]=l.useState(null),[d,z]=l.useState(null),[f,$]=l.useState([]),[R,I]=l.useState([]),[v,_]=l.useState([]),[S,j]=l.useState(!1),[y,q]=l.useState(""),[B,V]=l.useState(null),[w,K]=l.useState("overview"),[x,c]=l.useState(!0),[b,A]=l.useState(!1),[C,n]=l.useState(null),[E,r]=l.useState(!1),[o,h]=l.useState(""),[N,t]=l.useState("user"),[g,L]=l.useState(""),[P,te]=l.useState(""),[Y,J]=l.useState(null),[s,u]=l.useState([]),[F,D]=l.useState(!1),[T,G]=l.useState(null);l.useEffect(()=>{Z()},[]),l.useEffect(()=>{if(!i)return;const a=p.channel("developer-realtime").on("postgres_changes",{event:"*",schema:"public",table:"paas_developers",filter:`id=eq.${i.id}`},m=>{m.eventType==="UPDATE"&&U(m.new)}).on("postgres_changes",{event:"*",schema:"public",table:"paas_point_accounts",filter:`developer_id=eq.${i.id}`},m=>{if(m.eventType==="UPDATE"||m.eventType==="INSERT"){const k=m.new;z(O=>{if(O&&k.balance_points!==O.balance_points){const H=parseFloat(k.balance_points.toString())-parseFloat(O.balance_points.toString());H!==0&&console.log(`Points ${H>0?"added":"deducted"}: ${Math.abs(H)}`)}return k})}}).on("postgres_changes",{event:"*",schema:"public",table:"paas_api_keys",filter:`developer_id=eq.${i.id}`},async m=>{if(m.eventType==="INSERT"){const{data:k}=await p.from("paas_api_keys").select("*").eq("developer_id",i.id).order("created_at",{ascending:!1});k&&$(k)}else m.eventType==="UPDATE"?$(k=>k.map(O=>O.id===m.new.id?m.new:O)):m.eventType==="DELETE"&&$(k=>k.filter(O=>O.id!==m.old.id))}).on("postgres_changes",{event:"INSERT",schema:"public",table:"paas_transactions",filter:`developer_id=eq.${i.id}`},async m=>{const{data:k}=await p.from("paas_transactions").select("*").eq("developer_id",i.id).order("created_at",{ascending:!1}).limit(20);if(k){I(k);const O=m.new;console.log(`New transaction: ${O.transaction_type} - ${O.amount_points} points`)}}).on("postgres_changes",{event:"INSERT",schema:"public",table:"feedback"},async()=>{const{data:m}=await p.from("feedback").select("*, user_profiles(display_name)").order("created_at",{ascending:!1}).limit(50);m&&(_(m),console.log("New feedback received"))}).subscribe(m=>{m==="SUBSCRIBED"?(r(!0),console.log("Real-time connected")):(m==="CLOSED"||m==="CHANNEL_ERROR")&&(r(!1),console.log("Real-time disconnected"))});return()=>{p.removeChannel(a),r(!1)}},[i]);const Z=async(a=!1)=>{try{a?A(!0):c(!0),n(null);const{data:{user:m}}=await p.auth.getUser();if(!m){n("Not authenticated"),c(!1),A(!1);return}const{data:k,error:O}=await p.from("paas_developers").select("*").eq("user_id",m.id).maybeSingle();if(O||!k){n("Developer profile not found"),c(!1),A(!1);return}const[{data:H},{data:le},{data:de},{data:Fe}]=await Promise.all([p.from("paas_point_accounts").select("*").eq("developer_id",k.id).maybeSingle(),p.from("paas_api_keys").select("*").eq("developer_id",k.id).order("created_at",{ascending:!1}),p.from("paas_transactions").select("*").eq("developer_id",k.id).order("created_at",{ascending:!1}).limit(20),p.from("feedback").select("*, user_profiles(display_name)").order("created_at",{ascending:!1}).limit(50)]);U(k),z(H||null),$(le||[]),I(de||[]),_(Fe||[]),c(!1),A(!1)}catch(m){console.error("Error loading developer data:",m),n("Failed to load dashboard data"),c(!1),A(!1)}},X=async()=>{if(!(!y.trim()||!i))try{const a="pk_"+Array.from(crypto.getRandomValues(new Uint8Array(32))).map(H=>H.toString(16).padStart(2,"0")).join(""),m=a.substring(0,12),{error:k}=await p.from("paas_api_keys").insert({developer_id:i.id,key_hash:a,key_prefix:m,name:y,is_active:!0}).select().single();if(k)throw k;V(a),q("");const{data:O}=await p.from("paas_api_keys").select("*").eq("developer_id",i.id).order("created_at",{ascending:!1});$(O||[])}catch(a){console.error("Error generating API key:",a)}},ee=async a=>{if(i)try{await p.from("paas_api_keys").update({is_active:!1}).eq("id",a);const{data:m}=await p.from("paas_api_keys").select("*").eq("developer_id",i.id).order("created_at",{ascending:!1});$(m||[])}catch(m){console.error("Error revoking API key:",m)}},ne=a=>{navigator.clipboard.writeText(a)},je=async()=>{if(o.trim())try{if(D(!0),u([]),G(null),N==="user"){const{data:a,error:m}=await p.from("user_profiles").select("user_id, username").or(`username.ilike.%${o}%`).limit(10);if(m)throw m;u(a||[])}else{const{data:a,error:m}=await p.from("paas_developers").select("id, email, organization_name, is_verified").ilike("email",`%${o}%`).limit(10);if(m)throw m;u(a||[])}}catch(a){console.error("Error searching recipients:",a),J({type:"error",message:"Failed to search recipients"})}finally{D(!1)}},Ie=async()=>{if(!T||!g||!P.trim()){J({type:"error",message:"Please fill all required fields"});return}const a=parseFloat(g);if(isNaN(a)||a<=0){J({type:"error",message:"Please enter a valid positive number"});return}try{const m=N==="user"?T.user_id:T.id;if(N==="user"){const{data:k,error:O}=await p.from("user_profiles").select("points_balance, points_earned_total").eq("user_id",m).maybeSingle();if(O)throw O;if(!k){J({type:"error",message:"User profile not found"});return}const H=(k.points_balance||0)+a,le=(k.points_earned_total||0)+a,{error:de}=await p.from("user_profiles").update({points_balance:H,points_earned_total:le}).eq("user_id",m);if(de)throw de;J({type:"success",message:`Successfully granted ${a} points to @${T.username}`})}else{const{data:k,error:O}=await p.from("paas_point_accounts").select("*").eq("developer_id",m).maybeSingle();if(O)throw O;if(!k)await p.from("paas_point_accounts").insert({developer_id:m,balance_points:a,balance_gbp:a*.75,total_earned:a,total_spent:0});else{const H=parseFloat(k.balance_points)+a,le=parseFloat(k.total_earned)+a;await p.from("paas_point_accounts").update({balance_points:H,balance_gbp:H*.75,total_earned:le}).eq("developer_id",m)}await p.from("paas_transactions").insert({developer_id:m,transaction_type:"admin_grant",amount_points:a,endpoint:"/admin/manual-grant",metadata:{reason:P,granted_by:i==null?void 0:i.email}}),J({type:"success",message:`Successfully granted ${a} points to ${T.organization_name||T.email}`})}h(""),L(""),te(""),G(null),u([]),setTimeout(()=>J(null),5e3)}catch(m){console.error("Error granting points:",m),J({type:"error",message:"Failed to grant points. Please try again."})}};return x?e.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(W,{className:"animate-spin mx-auto mb-4 text-blue-600",size:48}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Loading dashboard..."})]})}):C||!i?e.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[e.jsx(se,{className:"mx-auto mb-4 text-red-600",size:48}),e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:C||"Developer profile not found"}),e.jsx("button",{onClick:()=>Z(),className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Try Again"})]})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 p-4 sm:p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2",children:"Developer Dashboard"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:i.email}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("span",{className:`px-3 py-1 text-sm rounded-full ${i.subscription_status==="active"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-400"}`,children:i.subscription_status}),i.is_verified&&e.jsxs("span",{className:"px-3 py-1 text-sm rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 flex items-center gap-1",children:[e.jsx(Q,{size:14}),"Verified"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[E&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm text-green-700 dark:text-green-400 font-medium",children:"Live"})]}),e.jsxs("button",{onClick:()=>Z(!0),disabled:b,className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-300 border border-slate-300 dark:border-slate-600 rounded-lg transition-colors disabled:opacity-50",title:"Refresh data",children:[e.jsx(pe,{size:18,className:b?"animate-spin":""}),"Refresh"]})]})]}),e.jsxs("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:[e.jsx("button",{onClick:()=>K("overview"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${w==="overview"?"bg-blue-600 text-white":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:"Overview"}),e.jsx("button",{onClick:()=>K("keys"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${w==="keys"?"bg-blue-600 text-white":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:"API Keys"}),e.jsx("button",{onClick:()=>K("usage"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${w==="usage"?"bg-blue-600 text-white":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:"Usage"}),e.jsx("button",{onClick:()=>K("billing"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${w==="billing"?"bg-blue-600 text-white":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:"Billing"}),e.jsx("button",{onClick:()=>K("admin"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${w==="admin"?"bg-blue-600 text-white":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:"Admin"})]}),w==="overview"&&e.jsxs("div",{className:"space-y-6",children:[!i.is_verified&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(se,{className:"text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5",size:20}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-yellow-900 dark:text-yellow-100",children:"Account Verification Pending"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:"Your account is pending verification. Some features may be limited until verification is complete."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(ce,{className:"text-blue-600 dark:text-blue-400",size:24})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:d?parseFloat(d.balance_points.toString()).toLocaleString():"0"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Available Points"}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500 mt-1",children:["≈ £",d?parseFloat(d.balance_gbp.toString()).toFixed(2):"0.00"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(ae,{className:"text-green-600 dark:text-green-400",size:24})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:f.filter(a=>a.is_active).length}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Active API Keys"}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500 mt-1",children:[f.length," total"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(re,{className:"text-purple-600 dark:text-purple-400",size:24})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:d?parseFloat(d.total_earned.toString()).toLocaleString():"0"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total Earned"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(W,{className:"text-red-600 dark:text-red-400",size:24})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:d?parseFloat(d.total_spent.toString()).toLocaleString():"0"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Total Spent"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white mb-4",children:"Getting Started"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold",children:"1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:"Create an API Key"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"Generate your first API key to start making requests to our platform."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold",children:"2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:"Read the Documentation"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"Check out our API documentation to learn how to integrate with our services."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold",children:"3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:"Monitor Your Usage"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:"Track your API calls and point consumption in the Usage tab."})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ne,{size:20}),"User Feedback"]}),e.jsx("span",{className:"px-2 py-1 text-xs font-semibold bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded-full",children:v.length})]}),v.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ne,{className:"mx-auto mb-3 text-slate-300 dark:text-slate-600",size:40}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"No feedback yet"})]}):e.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto",children:v.map(a=>{var m;return e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg border border-slate-200 dark:border-slate-600",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white text-sm line-clamp-1",children:a.title}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:[((m=a.user_profiles)==null?void 0:m.display_name)||"Anonymous"," • ",new Date(a.created_at).toLocaleDateString()]})]}),e.jsx("span",{className:`px-2 py-0.5 text-xs rounded whitespace-nowrap ${a.category==="bug"?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400":a.category==="feature"?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":a.category==="improvement"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-400"}`,children:a.category})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-2",children:a.message})]},a.id)})})]})]})]}),w==="keys"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:"API Keys"}),e.jsxs("button",{onClick:()=>j(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(De,{size:18}),"New Key"]})]}),f.length===0?e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-12 border border-slate-200 dark:border-slate-700 text-center",children:[e.jsx(ae,{className:"mx-auto mb-4 text-slate-300 dark:text-slate-600",size:48}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"No API Keys Yet"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Create your first API key to get started."}),e.jsx("button",{onClick:()=>j(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Create API Key"})]}):e.jsx("div",{className:"space-y-3",children:f.map(a=>e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white",children:a.name}),e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${a.is_active?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400"}`,children:a.is_active?"Active":"Revoked"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("code",{className:"text-sm font-mono text-slate-600 dark:text-slate-400 bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded",children:[a.key_prefix,"..."]}),e.jsx("button",{onClick:()=>ne(a.key_prefix),className:"p-1 hover:bg-slate-100 dark:hover:bg-slate-700 rounded transition-colors",title:"Copy prefix",children:e.jsx(xe,{size:16,className:"text-slate-600 dark:text-slate-400"})})]}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:["Created ",new Date(a.created_at).toLocaleDateString(),a.last_used_at&&` • Last used ${new Date(a.last_used_at).toLocaleDateString()}`]})]}),a.is_active&&e.jsxs("button",{onClick:()=>ee(a.id),className:"flex items-center gap-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors",children:[e.jsx(Pe,{size:16}),"Revoke"]})]})},a.id))})]}),w==="usage"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:"Recent Transactions"}),R.length===0?e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-12 border border-slate-200 dark:border-slate-700 text-center",children:[e.jsx(W,{className:"mx-auto mb-4 text-slate-300 dark:text-slate-600",size:48}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-2",children:"No Transactions Yet"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Your API usage will appear here."})]}):e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:"Endpoint"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-slate-600 dark:text-slate-400 uppercase",children:"Points"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:R.map(a=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/30 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-900 dark:text-white",children:new Date(a.created_at).toLocaleString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded ${a.transaction_type==="api_call"?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":a.transaction_type==="grant"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-400"}`,children:a.transaction_type})}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600 dark:text-slate-400",children:a.endpoint||"-"}),e.jsxs("td",{className:`px-6 py-4 whitespace-nowrap text-sm text-right font-medium ${a.amount_points>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[a.amount_points>0?"+":"",parseFloat(a.amount_points.toString()).toLocaleString()]})]},a.id))})]})})})]}),w==="billing"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:"Billing & Points"}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white mb-4",children:"Point Balance"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Current Balance"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:d?parseFloat(d.balance_points.toString()).toLocaleString():"0"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-500 mt-1",children:"points"})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"GBP Value"}),e.jsxs("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:["£",d?parseFloat(d.balance_gbp.toString()).toFixed(2):"0.00"]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Lifetime Earned"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:d?parseFloat(d.total_earned.toString()).toLocaleString():"0"})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"How Points Work"}),e.jsxs("ul",{className:"text-sm text-blue-700 dark:text-blue-300 space-y-1",children:[e.jsx("li",{children:"• 1 point = £0.75"}),e.jsx("li",{children:"• Points are deducted for each API call based on usage"}),e.jsx("li",{children:"• Add more points to continue using the platform"}),e.jsx("li",{children:"• Contact support for bulk point purchases"})]})]})]})]}),w==="admin"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(Xe,{}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Me,{className:"text-blue-600 dark:text-blue-400",size:28}),e.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-white",children:"Manual Point Distribution"})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Grant points directly to users or developers"}),Y&&e.jsx("div",{className:`p-4 rounded-lg border ${Y.type==="success"?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[Y.type==="success"?e.jsx(Q,{className:"text-green-600 dark:text-green-400",size:20}):e.jsx(se,{className:"text-red-600 dark:text-red-400",size:20}),e.jsx("p",{className:`text-sm font-medium ${Y.type==="success"?"text-green-900 dark:text-green-100":"text-red-900 dark:text-red-100"}`,children:Y.message})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm p-6 border border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Recipient Type"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"user",checked:N==="user",onChange:a=>{t(a.target.value),u([]),G(null)},className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"Regular User"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"developer",checked:N==="developer",onChange:a=>{t(a.target.value),u([]),G(null)},className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"Developer"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["Search ",N==="user"?"User":"Developer"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:a=>h(a.target.value),placeholder:N==="user"?"Username":"Email or organization",className:"flex-1 px-4 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white",onKeyDown:a=>a.key==="Enter"&&je()}),e.jsxs("button",{onClick:je,disabled:F||!o.trim(),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-400 dark:disabled:bg-slate-600 text-white rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(Re,{size:18}),"Search"]})]}),s.length>0&&e.jsx("div",{className:"mt-3 border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden",children:e.jsx("div",{className:"max-h-60 overflow-y-auto",children:s.map(a=>e.jsx("button",{onClick:()=>{G(a),u([])},className:"w-full px-4 py-3 text-left hover:bg-slate-50 dark:hover:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700 last:border-b-0 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:N==="user"?`@${a.username}`:a.organization_name||a.email}),N==="developer"&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:a.email})]}),N==="developer"&&a.is_verified&&e.jsx(Q,{className:"text-blue-600 dark:text-blue-400",size:18})]})},N==="user"?a.user_id:a.id))})}),T&&e.jsx("div",{className:"mt-3 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:"Selected:"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:N==="user"?`@${T.username}`:`${T.organization_name||T.email}`})]}),e.jsx("button",{onClick:()=>G(null),className:"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 text-sm",children:"Change"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Points to Grant"}),e.jsx("input",{type:"number",value:g,onChange:a=>L(a.target.value),placeholder:"Enter amount",min:"0",step:"1",className:"w-full px-4 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white"}),g&&!isNaN(parseFloat(g))&&e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:["≈ £",(parseFloat(g)*.75).toFixed(2)," GBP"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Reason for Grant"}),e.jsx("textarea",{value:P,onChange:a=>te(a.target.value),placeholder:"Enter reason for granting points (required for audit trail)",rows:3,className:"w-full px-4 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white resize-none"})]}),e.jsxs("button",{onClick:Ie,disabled:!T||!g||!P.trim(),className:"w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-400 dark:disabled:bg-slate-600 text-white rounded-lg transition-colors flex items-center justify-center gap-2 font-medium disabled:cursor-not-allowed",children:[e.jsx(Ve,{size:18}),"Grant Points"]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(se,{className:"text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5",size:18}),e.jsxs("div",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Important Notes:"}),e.jsxs("ul",{className:"space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Points are granted immediately and cannot be revoked"}),e.jsx("li",{children:"All transactions are logged for audit purposes"}),e.jsx("li",{children:"Provide a clear reason for accountability"}),e.jsx("li",{children:"1 point = £0.75 GBP value"})]})]})]})})]})})]})]}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-4",children:"Create New API Key"}),B?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Q,{className:"text-green-600 dark:text-green-400",size:20}),e.jsx("p",{className:"font-semibold text-green-900 dark:text-green-100",children:"API Key Created!"})]}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mb-3",children:"Copy this key now. You won't be able to see it again."}),e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-slate-800 p-3 rounded border border-green-300 dark:border-green-700",children:[e.jsx("code",{className:"flex-1 text-sm font-mono text-slate-900 dark:text-white break-all",children:B}),e.jsx("button",{onClick:()=>ne(B),className:"flex-shrink-0 p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded transition-colors",title:"Copy",children:e.jsx(xe,{size:18,className:"text-slate-600 dark:text-slate-400"})})]})]}),e.jsx("button",{onClick:()=>{j(!1),V(null)},className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Done"})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:y,onChange:a=>q(a.target.value),placeholder:"Key name (e.g., Production API)",className:"w-full px-4 py-2 bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white mb-4"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{j(!1),q("")},className:"flex-1 px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:X,disabled:!y.trim(),className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 dark:disabled:bg-slate-600 text-white rounded-lg transition-colors disabled:cursor-not-allowed",children:"Generate"})]})]})]})})]})}function bt(){const{user:i}=Le(),[U,d]=l.useState("select"),[z,f]=l.useState("none"),[$,R]=l.useState(""),[I,v]=l.useState(""),[_,S]=l.useState(""),[j,y]=l.useState(""),[q,B]=l.useState(""),[V,w]=l.useState(""),[K,x]=l.useState(!1);l.useEffect(()=>{(async()=>{if(!i){f("none");return}try{const{supabase:E}=await M(async()=>{const{supabase:o}=await import("./index-CGemffCt.js").then(h=>h.a9);return{supabase:o}},__vite__mapDeps([0,1])),{data:r}=await E.from("paas_developers").select("id").eq("user_id",i.id).maybeSingle();f(r?"developer":"none")}catch(E){console.error("Error checking developer status:",E),f("none")}})()},[i]);const c=()=>{$==="1798"?(f("admin"),v("")):v("Invalid admin code")},b=async()=>{if(!_||!j||!q||!V){v("All fields are required");return}x(!0),v("");try{const{supabase:n}=await M(async()=>{const{supabase:o}=await import("./index-CGemffCt.js").then(h=>h.a9);return{supabase:o}},__vite__mapDeps([0,1])),{data:E,error:r}=await n.auth.signUp({email:_,password:j});if(r)throw r.message.includes("already registered")?new Error("This email is already registered. Please login instead."):r;if(E.user){const{data:o,error:h}=await n.rpc("verify_developer_access_code",{access_code:V,user_id:E.user.id});if(h)throw await n.auth.signOut(),new Error(h.message||"Invalid or expired access code.");const{error:N}=await n.from("paas_developers").insert({user_id:E.user.id,email:E.user.email,organization_name:q,subscription_status:"inactive",is_verified:!1,access_code_id:o});if(N)throw N.message.includes("duplicate")||N.code==="23505"?new Error("Developer account already exists. Please login instead."):new Error("Failed to create developer profile. Please contact support.");f("developer")}}catch(n){v(n.message||"Signup failed")}finally{x(!1)}},A=async()=>{if(!_||!j){v("Email and password are required");return}x(!0),v("");try{const{supabase:n}=await M(async()=>{const{supabase:N}=await import("./index-CGemffCt.js").then(t=>t.a9);return{supabase:N}},__vite__mapDeps([0,1])),{data:E,error:r}=await n.auth.signInWithPassword({email:_,password:j});if(r)throw r;if(!E.user)throw new Error("Login failed");const{data:o,error:h}=await n.from("paas_developers").select("id, email, organization_name, subscription_status, is_verified").eq("user_id",E.user.id).maybeSingle();if(h)throw await n.auth.signOut(),new Error("Error checking developer account");if(!o)throw await n.auth.signOut(),new Error("No developer account found for this email. Please sign up first.");f("developer")}catch(n){v(n.message||"Login failed")}finally{x(!1)}},C=async()=>{try{const{supabase:n}=await M(async()=>{const{supabase:E}=await import("./index-CGemffCt.js").then(r=>r.a9);return{supabase:E}},__vite__mapDeps([0,1]));await n.auth.signOut(),f("none"),d("select"),S(""),y(""),B(""),w(""),R("")}catch(n){console.error("Logout error:",n)}};return z==="admin"?e.jsx(Ze,{onLogout:()=>{f("none"),d("select")}}):z==="developer"&&i?e.jsxs("div",{children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 p-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"PaaS Platform"}),e.jsx("button",{onClick:C,className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg transition-colors",children:"Logout"})]})}),e.jsx(Qe,{})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-slate-50 to-purple-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-2xl mb-4",children:e.jsx(ie,{className:"text-white",size:32})}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2",children:"PaaS Platform"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Access your developer dashboard or admin panel"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-8 border border-slate-200 dark:border-slate-700",children:[U==="select"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>d("admin"),className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-xl font-semibold transition-all transform hover:scale-105",children:[e.jsx(ie,{size:20}),"Admin Access"]}),e.jsxs("button",{onClick:()=>d("developer-login"),className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white rounded-xl font-semibold transition-all transform hover:scale-105",children:[e.jsx(qe,{size:20}),"Developer Login"]}),e.jsxs("button",{onClick:()=>d("developer-signup"),className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-900 dark:text-white rounded-xl font-semibold transition-colors",children:[e.jsx(we,{size:20}),"Developer Signup"]})]}),U==="admin"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-6",children:"Admin Access"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Admin Code"}),e.jsx("input",{type:"password",value:$,onChange:n=>R(n.target.value),onKeyPress:n=>n.key==="Enter"&&c(),placeholder:"Enter admin code",className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-slate-900 dark:text-white"})]}),I&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-sm text-red-700 dark:text-red-400",children:I}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{d("select"),v(""),R("")},className:"flex-1 px-4 py-3 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg font-medium transition-colors",children:"Back"}),e.jsx("button",{onClick:c,className:"flex-1 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors",children:"Access"})]})]})]}),U==="developer-login"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-6",children:"Developer Login"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(ye,{className:"inline mr-2",size:16}),"Email"]}),e.jsx("input",{type:"email",value:_,onChange:n=>S(n.target.value),placeholder:"your@email.com",className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(Ce,{className:"inline mr-2",size:16}),"Password"]}),e.jsx("input",{type:"password",value:j,onChange:n=>y(n.target.value),onKeyPress:n=>n.key==="Enter"&&A(),placeholder:"••••••••",className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-900 dark:text-white"})]}),I&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-sm text-red-700 dark:text-red-400",children:I}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{d("select"),v(""),S(""),y("")},className:"flex-1 px-4 py-3 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg font-medium transition-colors",children:"Back"}),e.jsx("button",{onClick:A,disabled:K,className:"flex-1 px-4 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-slate-300 dark:disabled:bg-slate-600 text-white rounded-lg font-medium transition-colors disabled:cursor-not-allowed",children:K?"Loading...":"Login"})]}),e.jsxs("p",{className:"text-center text-sm text-slate-600 dark:text-slate-400",children:["Don't have an account?"," ",e.jsx("button",{onClick:()=>{d("developer-signup"),v("")},className:"text-purple-600 dark:text-purple-400 hover:underline font-medium",children:"Sign up"})]})]})]}),U==="developer-signup"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white mb-6",children:"Developer Signup"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(ye,{className:"inline mr-2",size:16}),"Email"]}),e.jsx("input",{type:"email",value:_,onChange:n=>S(n.target.value),placeholder:"your@email.com",className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(we,{className:"inline mr-2",size:16}),"Organization Name"]}),e.jsx("input",{type:"text",value:q,onChange:n=>B(n.target.value),placeholder:"Your Company",className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(ae,{className:"inline mr-2",size:16}),"Developer Access Code"]}),e.jsx("input",{type:"text",value:V,onChange:n=>w(n.target.value.toUpperCase()),placeholder:"POET2026",className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-900 dark:text-white font-mono"}),e.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:"Contact support to obtain a valid access code"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(Ce,{className:"inline mr-2",size:16}),"Password"]}),e.jsx("input",{type:"password",value:j,onChange:n=>y(n.target.value),onKeyPress:n=>n.key==="Enter"&&b(),placeholder:"••••••••",className:"w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-900 dark:text-white"})]}),I&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-sm text-red-700 dark:text-red-400",children:I}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{d("select"),v(""),S(""),y(""),B(""),w("")},className:"flex-1 px-4 py-3 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg font-medium transition-colors",children:"Back"}),e.jsx("button",{onClick:b,disabled:K,className:"flex-1 px-4 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-slate-300 dark:disabled:bg-slate-600 text-white rounded-lg font-medium transition-colors disabled:cursor-not-allowed",children:K?"Creating...":"Sign Up"})]}),e.jsxs("p",{className:"text-center text-sm text-slate-600 dark:text-slate-400",children:["Already have an account?"," ",e.jsx("button",{onClick:()=>{d("developer-login"),v("")},className:"text-purple-600 dark:text-purple-400 hover:underline font-medium",children:"Log in"})]})]})]})]}),e.jsx("p",{className:"text-center text-sm text-slate-600 dark:text-slate-400 mt-6",children:"Secure access to the PaaS platform"})]})})}export{bt as default};
