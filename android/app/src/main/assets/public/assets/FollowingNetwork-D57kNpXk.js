import{u as P,r as c,s,j as e,n as b,T as U,B as v,q as T,p as $}from"./index-CGemffCt.js";import{U as C}from"./user-check-DSCbPaLA.js";import{S as D}from"./search-CC5W77On.js";function G(){const{user:t}=P(),[q,S]=c.useState([]),[p,_]=c.useState([]),[j,k]=c.useState([]),[l,f]=c.useState("discover"),[m,E]=c.useState(""),[F,g]=c.useState(!0);c.useEffect(()=>{t&&N()},[t,l]);const N=async()=>{g(!0);try{if(l==="discover"){const{data:r,error:i}=await s.from("user_profiles").select("*").neq("user_id",t==null?void 0:t.id).limit(50);if(i)throw i;const n=await Promise.all((r||[]).map(async a=>{const{count:d}=await s.from("poems").select("id",{count:"exact",head:!0}).eq("user_id",a.user_id).eq("is_public",!0),{count:u}=await s.from("follows").select("id",{count:"exact",head:!0}).eq("following_id",a.user_id),{count:o}=await s.from("follows").select("id",{count:"exact",head:!0}).eq("follower_id",a.user_id),{data:w}=await s.from("follows").select("id").eq("follower_id",t==null?void 0:t.id).eq("following_id",a.user_id).maybeSingle();return{user_id:a.user_id,username:a.username||"Anonymous",display_name:a.display_name||a.username||"Anonymous",bio:a.bio||"",poem_count:d||0,follower_count:u||0,following_count:o||0,is_following:!!w}}));S(n.sort((a,d)=>d.follower_count-a.follower_count))}else if(l==="following"){const{data:r,error:i}=await s.from("follows").select("following_id").eq("follower_id",t==null?void 0:t.id);if(i)throw i;const n=(r==null?void 0:r.map(o=>o.following_id))||[];if(n.length===0){_([]),g(!1);return}const{data:a,error:d}=await s.from("user_profiles").select("*").in("user_id",n);if(d)throw d;const u=await Promise.all((a||[]).map(async o=>{const{count:w}=await s.from("poems").select("id",{count:"exact",head:!0}).eq("user_id",o.user_id).eq("is_public",!0),{count:h}=await s.from("follows").select("id",{count:"exact",head:!0}).eq("following_id",o.user_id),{count:y}=await s.from("follows").select("id",{count:"exact",head:!0}).eq("follower_id",o.user_id);return{user_id:o.user_id,username:o.username||"Anonymous",display_name:o.display_name||o.username||"Anonymous",bio:o.bio||"",poem_count:w||0,follower_count:h||0,following_count:y||0,is_following:!0}}));_(u)}else if(l==="followers"){const{data:r,error:i}=await s.from("follows").select("follower_id").eq("following_id",t==null?void 0:t.id);if(i)throw i;const n=(r==null?void 0:r.map(o=>o.follower_id))||[];if(n.length===0){k([]),g(!1);return}const{data:a,error:d}=await s.from("user_profiles").select("*").in("user_id",n);if(d)throw d;const u=await Promise.all((a||[]).map(async o=>{const{count:w}=await s.from("poems").select("id",{count:"exact",head:!0}).eq("user_id",o.user_id).eq("is_public",!0),{count:h}=await s.from("follows").select("id",{count:"exact",head:!0}).eq("following_id",o.user_id),{count:y}=await s.from("follows").select("id",{count:"exact",head:!0}).eq("follower_id",o.user_id),{data:A}=await s.from("follows").select("id").eq("follower_id",t==null?void 0:t.id).eq("following_id",o.user_id).maybeSingle();return{user_id:o.user_id,username:o.username||"Anonymous",display_name:o.display_name||o.username||"Anonymous",bio:o.bio||"",poem_count:w||0,follower_count:h||0,following_count:y||0,is_following:!!A}}));k(u)}}catch(r){console.error("Error loading poets:",r)}finally{g(!1)}},L=async(r,i)=>{if(t)try{i?await s.from("follows").delete().eq("follower_id",t.id).eq("following_id",r):await s.from("follows").insert({follower_id:t.id,following_id:r}),N()}catch(n){console.error("Error toggling follow:",n)}},x=(()=>{switch(l){case"discover":return q;case"following":return p;case"followers":return j;default:return[]}})().filter(r=>!m||r.username.toLowerCase().includes(m.toLowerCase())||r.display_name.toLowerCase().includes(m.toLowerCase())||r.bio.toLowerCase().includes(m.toLowerCase()));return e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(b,{className:"w-8 h-8 text-emerald-600 dark:text-emerald-400"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Poetry Community"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Connect with fellow poets, follow their work, and build your writing community."}),e.jsxs("div",{className:"flex flex-wrap gap-2 border-b border-gray-200 dark:border-gray-700 mb-6",children:[e.jsx("button",{onClick:()=>f("discover"),className:`px-4 py-2 font-medium border-b-2 transition-colors ${l==="discover"?"border-emerald-600 text-emerald-600 dark:text-emerald-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Discover Poets"]})}),e.jsx("button",{onClick:()=>f("following"),className:`px-4 py-2 font-medium border-b-2 transition-colors ${l==="following"?"border-emerald-600 text-emerald-600 dark:text-emerald-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),"Following (",p.length,")"]})}),e.jsx("button",{onClick:()=>f("followers"),className:`px-4 py-2 font-medium border-b-2 transition-colors ${l==="followers"?"border-emerald-600 text-emerald-600 dark:text-emerald-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),"Followers (",j.length,")"]})})]}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search poets...",value:m,onChange:r=>E(r.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent"})]}),F?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"inline-block w-8 h-8 border-4 border-emerald-600 border-t-transparent rounded-full animate-spin"})}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:x.length===0?e.jsx("div",{className:"col-span-full text-center py-12 text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:m?"No poets found matching your search.":l==="following"?"You're not following anyone yet. Discover poets to connect with!":l==="followers"?"No followers yet. Keep sharing your work to build your audience!":"No poets to discover right now."}):x.map(r=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 hover:border-emerald-400 dark:hover:border-emerald-600 transition-colors",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center text-white font-bold text-lg flex-shrink-0",children:r.display_name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white truncate",children:r.display_name}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:["@",r.username]})]})]})}),r.bio&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2",children:r.bio}),e.jsxs("div",{className:"flex items-center gap-4 mb-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{className:"w-4 h-4"}),e.jsxs("span",{children:[r.poem_count," poems"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsxs("span",{children:[r.follower_count," followers"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>L(r.user_id,r.is_following),className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 ${r.is_following?"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600":"bg-emerald-600 text-white hover:bg-emerald-700"}`,children:r.is_following?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4"}),"Following"]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4"}),"Follow"]})}),e.jsx("button",{className:"px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",title:"View Profile",children:e.jsx(v,{className:"w-4 h-4"})})]})]},r.user_id))}),l==="discover"&&x.length>0&&e.jsxs("div",{className:"mt-8 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg border border-emerald-200 dark:border-emerald-800 p-6",children:[e.jsxs("h3",{className:"font-bold text-emerald-900 dark:text-emerald-100 mb-3 flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5"}),"Growing Your Network"]}),e.jsxs("ul",{className:"text-sm text-emerald-800 dark:text-emerald-200 space-y-2",children:[e.jsx("li",{children:"• Follow poets whose work resonates with you"}),e.jsx("li",{children:"• Engage with their poems through likes and comments"}),e.jsx("li",{children:"• Share your own work regularly to attract followers"}),e.jsx("li",{children:"• Participate in contests and challenges to gain visibility"}),e.jsx("li",{children:"• Join book clubs and study groups to connect with like-minded writers"})]})]})]})}export{G as default};
