import{u as I,r as l,s as i,j as e,M as g,X as W}from"./index-CGemffCt.js";import{A as G}from"./arrow-left-DtVZ9cb3.js";import{P}from"./pin-DhG77uX4.js";import{C as A}from"./clock-CH5mnwFd.js";import{E as R}from"./eye-CihzmZqK.js";import{S as Y}from"./send-DpFuWiTj.js";import{P as b}from"./plus-zAg5GACl.js";function Z(){var D,E;const{user:c}=I(),[F,U]=l.useState([]),[j,v]=l.useState([]),[u,N]=l.useState([]),[o,k]=l.useState(null),[t,f]=l.useState(null),[M,m]=l.useState(!1),[$,p]=l.useState(!0),[_,C]=l.useState(""),[x,y]=l.useState({title:"",content:""});l.useEffect(()=>{B()},[]),l.useEffect(()=>{o&&!t&&S(o)},[o,t]),l.useEffect(()=>{t&&(T(t.id),L(t.id))},[t]);const B=async()=>{var r;p(!0);try{const{data:a,error:s}=await i.from("forum_categories").select("*").order("order_index",{ascending:!0});if(s)throw s;const d=[{id:"craft",name:"Poetry Craft",description:"Discuss techniques, forms, and writing methods",icon:"âœï¸",order_index:1},{id:"feedback",name:"Feedback & Critique",description:"Get constructive feedback on your work",icon:"ðŸ’¬",order_index:2},{id:"inspiration",name:"Inspiration & Prompts",description:"Share ideas and writing prompts",icon:"ðŸ’¡",order_index:3},{id:"general",name:"General Discussion",description:"Talk about poetry and related topics",icon:"ðŸ—¨ï¸",order_index:4}];U(a&&a.length>0?a:d),(a&&a.length>0||d.length>0)&&k(a&&((r=a[0])==null?void 0:r.id)||d[0].id)}catch(a){console.error("Error loading categories:",a)}finally{p(!1)}},S=async r=>{p(!0);try{const{data:a,error:s}=await i.from("forum_topics").select("*").eq("category_id",r).order("is_pinned",{ascending:!1}).order("last_activity_at",{ascending:!1}).limit(20);if(s)throw s;const d=await Promise.all((a||[]).map(async h=>{const{data:n}=await i.from("user_profiles").select("username").eq("user_id",h.user_id).maybeSingle();return{...h,username:(n==null?void 0:n.username)||"Anonymous"}}));v(d)}catch(a){console.error("Error loading topics:",a),v([])}finally{p(!1)}},T=async r=>{try{const{data:a,error:s}=await i.from("forum_replies").select("*").eq("topic_id",r).order("created_at",{ascending:!0});if(s)throw s;const d=await Promise.all((a||[]).map(async h=>{const{data:n}=await i.from("user_profiles").select("username").eq("user_id",h.user_id).maybeSingle();return{...h,username:(n==null?void 0:n.username)||"Anonymous"}}));N(d)}catch(a){console.error("Error loading replies:",a),N([])}},L=async r=>{try{await i.rpc("increment_topic_views",{topic_id:r})}catch(a){console.error("Error incrementing view count:",a)}},q=async r=>{if(r.preventDefault(),!c){alert("Please sign in to create a topic");return}try{const{error:a}=await i.from("forum_topics").insert({category_id:o,title:x.title,content:x.content,user_id:c.id,is_pinned:!1,reply_count:0,view_count:0});if(a)throw a;m(!1),y({title:"",content:""}),o&&S(o)}catch(a){console.error("Error creating topic:",a),alert("Failed to create topic. Please try again.")}},z=async r=>{if(r.preventDefault(),!(!c||!t))try{const{error:a}=await i.from("forum_replies").insert({topic_id:t.id,content:_,user_id:c.id});if(a)throw a;await i.from("forum_topics").update({reply_count:(t.reply_count||0)+1,last_activity_at:new Date().toISOString()}).eq("id",t.id),C(""),T(t.id)}catch(a){console.error("Error posting reply:",a),alert("Failed to post reply. Please try again.")}},w=r=>{const a=new Date(r),d=Math.floor((new Date().getTime()-a.getTime())/(1e3*60*60));return d<1?"Just now":d<24?`${d}h ago`:d<48?"Yesterday":a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})};return t?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-emerald-50/30 to-gray-50 dark:from-gray-900 dark:via-emerald-900/10 dark:to-gray-900",children:e.jsxs("div",{className:"max-w-5xl mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsxs("button",{onClick:()=>f(null),className:"group flex items-center gap-2 text-emerald-600 dark:text-emerald-400 hover:text-emerald-700 dark:hover:text-emerald-300 mb-6 font-medium transition-all",children:[e.jsx("div",{className:"p-1.5 rounded-lg group-hover:bg-emerald-100 dark:group-hover:bg-emerald-900/30 transition-colors",children:e.jsx(G,{className:"w-5 h-5"})}),"Back to Topics"]}),e.jsx("div",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden mb-6",children:e.jsxs("div",{className:"p-6 sm:p-8",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[t.is_pinned&&e.jsx("div",{className:"p-2 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg",children:e.jsx(P,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white mb-4 leading-tight",children:t.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 sm:gap-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-full flex items-center justify-center text-white font-medium text-sm",children:((E=(D=t.username)==null?void 0:D[0])==null?void 0:E.toUpperCase())||"A"}),e.jsx("span",{className:"font-medium",children:t.username})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:w(t.created_at)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.view_count," views"]})]})]})]})]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-base leading-relaxed whitespace-pre-wrap",children:t.content})})]})}),e.jsx("div",{className:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:e.jsxs("div",{className:"p-6 sm:p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(g,{className:"w-6 h-6 text-emerald-600 dark:text-emerald-400"}),e.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white",children:[u.length," ",u.length===1?"Reply":"Replies"]})]}),e.jsxs("div",{className:"space-y-4 mb-8",children:[u.map(r=>{var a,s;return e.jsx("div",{className:"group relative pl-6 py-4 border-l-4 border-emerald-200 dark:border-emerald-800 hover:border-emerald-400 dark:hover:border-emerald-600 transition-all rounded-r-lg hover:bg-emerald-50/50 dark:hover:bg-emerald-900/10",children:e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center text-white font-semibold shadow-md",children:((s=(a=r.username)==null?void 0:a[0])==null?void 0:s.toUpperCase())||"A"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:r.username}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:w(r.created_at)})]}),e.jsx("p",{className:"mt-2 text-gray-700 dark:text-gray-300 leading-relaxed whitespace-pre-wrap",children:r.content})]})]})},r.id)}),u.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(g,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 font-medium",children:"No replies yet. Be the first to respond!"})]})]}),c&&e.jsxs("form",{onSubmit:z,className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("label",{className:"block text-base font-semibold text-gray-900 dark:text-white mb-3",children:"Add Your Reply"}),e.jsx("textarea",{value:_,onChange:r=>C(r.target.value),placeholder:"Share your thoughts, provide feedback, or ask questions...",rows:5,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-900 text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all resize-none"}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs("button",{type:"submit",className:"px-6 py-3 bg-gradient-to-r from-emerald-600 to-emerald-500 text-white font-medium rounded-xl hover:from-emerald-700 hover:to-emerald-600 shadow-lg shadow-emerald-500/30 hover:shadow-xl hover:shadow-emerald-500/40 transition-all flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Post Reply"]})})]}),!c&&e.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Please sign in to join the conversation"})})]})})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-emerald-50/30 to-gray-50 dark:from-gray-900 dark:via-emerald-900/10 dark:to-gray-900",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl shadow-lg shadow-emerald-500/30",children:e.jsx(g,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white",children:"Discussion Forums"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Connect, share insights, and grow together"})]})]}),e.jsxs("button",{onClick:()=>m(!0),className:"hidden sm:flex px-5 py-2.5 bg-gradient-to-r from-emerald-600 to-emerald-500 text-white font-medium rounded-xl hover:from-emerald-700 hover:to-emerald-600 shadow-lg shadow-emerald-500/30 hover:shadow-xl hover:shadow-emerald-500/40 transition-all items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5"}),"New Topic"]})]}),e.jsxs("button",{onClick:()=>m(!0),className:"sm:hidden w-full px-5 py-2.5 bg-gradient-to-r from-emerald-600 to-emerald-500 text-white font-medium rounded-xl hover:from-emerald-700 hover:to-emerald-600 shadow-lg shadow-emerald-500/30 transition-all flex items-center justify-center gap-2",children:[e.jsx(b,{className:"w-5 h-5"}),"New Topic"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"lg:sticky lg:top-6 space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide px-1 mb-3",children:"Categories"}),F.map(r=>e.jsx("button",{onClick:()=>{k(r.id),f(null)},className:`group w-full text-left p-4 rounded-xl transition-all ${o===r.id?"bg-gradient-to-br from-emerald-500 to-emerald-600 shadow-lg shadow-emerald-500/30 scale-105":"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border border-gray-200 dark:border-gray-700 hover:border-emerald-400 dark:hover:border-emerald-600 hover:shadow-md"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`text-2xl transition-transform group-hover:scale-110 ${o===r.id?"drop-shadow-lg":""}`,children:r.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold truncate ${o===r.id?"text-white":"text-gray-900 dark:text-white"}`,children:r.name}),e.jsx("p",{className:`text-xs line-clamp-1 ${o===r.id?"text-emerald-50":"text-gray-600 dark:text-gray-400"}`,children:r.description})]})]})},r.id))]})}),e.jsx("div",{className:"lg:col-span-3",children:$?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"inline-block w-12 h-12 border-4 border-emerald-600 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400 font-medium",children:"Loading discussions..."})]}):e.jsx("div",{className:"space-y-4",children:j.length===0?e.jsxs("div",{className:"text-center py-16 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl border border-gray-200 dark:border-gray-700",children:[e.jsx(g,{className:"w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"No discussions yet"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:"Be the first to start a conversation in this category"}),e.jsxs("button",{onClick:()=>m(!0),className:"px-6 py-3 bg-gradient-to-r from-emerald-600 to-emerald-500 text-white font-medium rounded-xl hover:from-emerald-700 hover:to-emerald-600 shadow-lg shadow-emerald-500/30 transition-all inline-flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5"}),"Start Discussion"]})]}):j.map(r=>{var a,s;return e.jsx("div",{onClick:()=>f(r),className:"group bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl border border-gray-200 dark:border-gray-700 p-5 hover:border-emerald-400 dark:hover:border-emerald-600 hover:shadow-lg transition-all cursor-pointer",children:e.jsxs("div",{className:"flex items-start gap-4",children:[r.is_pinned&&e.jsx("div",{className:"p-2 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg flex-shrink-0",children:e.jsx(P,{className:"w-4 h-4 text-emerald-600 dark:text-emerald-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 dark:text-white mb-2 group-hover:text-emerald-600 dark:group-hover:text-emerald-400 transition-colors line-clamp-2",children:r.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2 leading-relaxed",children:r.content}),e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-full flex items-center justify-center text-white text-xs font-semibold",children:((s=(a=r.username)==null?void 0:a[0])==null?void 0:s.toUpperCase())||"A"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 font-medium",children:r.username})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1.5 px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-lg",children:[e.jsx(g,{className:"w-3.5 h-3.5"}),r.reply_count||0]}),e.jsxs("span",{className:"flex items-center gap-1.5 px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-lg",children:[e.jsx(R,{className:"w-3.5 h-3.5"}),r.view_count||0]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(A,{className:"w-3.5 h-3.5"}),w(r.last_activity_at||r.created_at)]})]})]})]})]})},r.id)})})})]})]}),M&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"px-6 py-5 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-emerald-50 to-blue-50 dark:from-emerald-900/20 dark:to-blue-900/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-xl shadow-lg shadow-emerald-500/30",children:e.jsx(b,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Create New Topic"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Start a new discussion with the community"})]})]}),e.jsx("button",{onClick:()=>m(!1),className:"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(W,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:q,className:"p-6 space-y-5 overflow-y-auto max-h-[calc(90vh-160px)]",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 dark:text-white mb-2",children:"Topic Title"}),e.jsx("input",{type:"text",required:!0,value:x.title,onChange:r=>y({...x,title:r.target.value}),placeholder:"What would you like to discuss?",className:"w-full px-4 py-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-900 text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 dark:text-white mb-2",children:"Content"}),e.jsx("textarea",{required:!0,value:x.content,onChange:r=>y({...x,content:r.target.value}),placeholder:"Share your thoughts, questions, or ideas in detail...",rows:10,className:"w-full px-4 py-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-900 text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all resize-none"}),e.jsx("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:"Be clear and descriptive to get the best responses"})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"flex-1 px-4 py-2.5 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-medium rounded-xl hover:bg-gray-100 dark:hover:bg-gray-800 transition-all",children:"Cancel"}),e.jsx("button",{type:"submit",onClick:q,className:"flex-1 px-4 py-2.5 bg-gradient-to-r from-emerald-600 to-emerald-500 text-white font-medium rounded-xl hover:from-emerald-700 hover:to-emerald-600 shadow-lg shadow-emerald-500/30 hover:shadow-xl hover:shadow-emerald-500/40 transition-all",children:"Create Topic"})]})]})})]})}export{Z as default};
