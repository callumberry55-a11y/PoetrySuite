import{u as ce,r,s as c,j as e,l as u,p as f,m as xe,T as H,S as me,A as ue,B as he}from"./index-CGemffCt.js";import{C as O}from"./circle-check-big-gJTh1YIL.js";import{C as pe}from"./circle-x-Dj4cGIT8.js";import{R as be,P as fe}from"./rotate-ccw-CFQf6qtS.js";import{C as A}from"./clock-CH5mnwFd.js";function ke(){const{user:x}=ce(),[E,G]=r.useState([]),[K,T]=r.useState(!0),[o,y]=r.useState(null),[i,L]=r.useState([]),[d,g]=r.useState(0),[h,_]=r.useState({}),[z,j]=r.useState(!1),[U,w]=r.useState(!1),[p,C]=r.useState(null),[v,W]=r.useState(0),[X,J]=r.useState(0),[S,b]=r.useState(!1),[N,V]=r.useState("all"),[k,Z]=r.useState("all"),[B,D]=r.useState([]),[ee,Q]=r.useState(!1),[te,se]=r.useState(0),q=r.useCallback(async()=>{if(x){T(!0);try{let t=c.from("poetry_quizzes").select("*").eq("is_active",!0);N!=="all"&&(t=t.eq("category",N)),k!=="all"&&(t=t.eq("difficulty",k));const{data:s,error:l}=await t.order("created_at",{ascending:!1});if(l)throw l;const n=await Promise.all((s||[]).map(async a=>{var Y;const{count:m}=await c.from("quiz_questions").select("id",{count:"exact",head:!0}).eq("quiz_id",a.id),{data:$}=await c.from("quiz_attempts").select("score").eq("quiz_id",a.id).eq("user_id",x.id).order("score",{ascending:!1}).limit(1),{count:de}=await c.from("quiz_attempts").select("id",{count:"exact",head:!0}).eq("quiz_id",a.id).eq("user_id",x.id);return{...a,question_count:m||0,best_score:((Y=$==null?void 0:$[0])==null?void 0:Y.score)||void 0,attempts_count:de||0}}));G(n)}catch(t){console.error("Error loading quizzes:",t)}finally{T(!1)}}},[x,N,k]);r.useEffect(()=>{q()},[q]),r.useEffect(()=>{if(z&&p!==null&&p>0){const t=setInterval(()=>{C(s=>s===null||s<=1?(I(),0):s-1)},1e3);return()=>clearInterval(t)}},[z,p]);const P=async t=>{y(t),Q(!1);try{const{data:s,error:l}=await c.from("quiz_questions").select("*").eq("quiz_id",t.id).order("question_order");if(l)throw l;L(s||[]),g(0),_({}),j(!0),w(!1),b(!1),C(t.time_limit_seconds),se(Date.now())}catch(s){console.error("Error loading questions:",s)}},ae=(t,s)=>{_({...h,[t]:s})},re=()=>{d<i.length-1&&(g(d+1),b(!1))},le=()=>{d>0&&(g(d-1),b(!1))},I=async()=>{if(!o||!x)return;let t=0;i.forEach(a=>{h[a.id]===a.correct_answer&&t++});const s=Math.round(t/i.length*100),l=s>=o.passing_score,n=Math.round((Date.now()-te)/1e3);W(s),J(t),w(!0),j(!1);try{const{error:a}=await c.from("quiz_attempts").insert({quiz_id:o.id,user_id:x.id,score:s,correct_answers:t,total_questions:i.length,time_taken_seconds:n,passed:l,answers:h});if(a)throw a;l&&await c.rpc("handle_point_transaction",{p_user_id:x.id,p_amount:o.points_reward,p_type:"add"}),q()}catch(a){console.error("Error saving quiz attempt:",a)}},oe=async t=>{try{const{data:s,error:l}=await c.from("quiz_attempts").select(`
          user_id,
          score,
          time_taken_seconds,
          completed_at,
          user_profiles!inner(username)
        `).eq("quiz_id",t).order("score",{ascending:!1}).order("time_taken_seconds",{ascending:!0}).limit(10);if(l)throw l;const n=(s||[]).map(a=>{var m;return{user_id:a.user_id,username:((m=a.user_profiles)==null?void 0:m.username)||"Anonymous",score:a.score,time_taken_seconds:a.time_taken_seconds,completed_at:a.completed_at}});D(n)}catch(s){console.error("Error loading leaderboard:",s),D([])}},R=t=>{y(t),Q(!0),j(!1),w(!1),oe(t.id)},F=()=>{y(null),L([]),g(0),_({}),j(!1),w(!1),b(!1),Q(!1),C(null)},ie=t=>{switch(t){case"forms":return e.jsx(he,{size:20});case"poets":return e.jsx(ue,{size:20});case"devices":return e.jsx(me,{size:20});case"history":return e.jsx(A,{size:20});default:return e.jsx(u,{size:20})}},ne=t=>{switch(t){case"beginner":return"text-green-600 bg-green-50 dark:bg-green-900/20";case"intermediate":return"text-yellow-600 bg-yellow-50 dark:bg-yellow-900/20";case"advanced":return"text-red-600 bg-red-50 dark:bg-red-900/20";default:return"text-slate-600 bg-slate-50 dark:bg-slate-900/20"}},M=t=>{const s=Math.floor(t/60),l=t%60;return`${s}:${l.toString().padStart(2,"0")}`};if(K)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(u,{className:"w-12 h-12 text-primary animate-pulse mx-auto mb-4"}),e.jsx("p",{className:"text-on-surface-variant",children:"Loading quizzes..."})]})});if(ee&&o)return e.jsxs("div",{className:"h-full flex flex-col bg-gradient-to-br from-purple-50 via-white to-blue-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white px-4 sm:px-6 py-8 sm:py-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("button",{onClick:F,className:"mb-4 text-white/90 hover:text-white text-sm flex items-center gap-2",children:"â† Back to Quizzes"}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(f,{className:"w-8 h-8"}),e.jsx("h1",{className:"text-2xl sm:text-4xl font-bold",children:"Leaderboard"})]}),e.jsx("p",{className:"text-lg opacity-90",children:o.title})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 sm:px-6 py-6",children:e.jsx("div",{className:"max-w-4xl mx-auto space-y-4",children:B.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-500",children:[e.jsx(f,{className:"w-16 h-16 mx-auto mb-4 opacity-30"}),e.jsx("p",{children:"No attempts yet. Be the first to take this quiz!"})]}):B.map((t,s)=>e.jsxs("div",{className:`flex items-center gap-4 p-4 rounded-xl ${s===0?"bg-gradient-to-r from-yellow-400 to-yellow-500 text-white shadow-lg":s===1?"bg-gradient-to-r from-slate-300 to-slate-400 text-slate-900 shadow-md":s===2?"bg-gradient-to-r from-orange-400 to-orange-500 text-white shadow-md":"bg-white dark:bg-slate-800 shadow"}`,children:[e.jsx("div",{className:"text-2xl font-bold w-12 text-center",children:s+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold",children:t.username}),e.jsx("p",{className:`text-sm ${s<3?"opacity-90":"text-slate-500"}`,children:t.time_taken_seconds?M(t.time_taken_seconds):"N/A"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold",children:[t.score,"%"]}),s<3&&e.jsx(f,{className:"w-5 h-5 mx-auto mt-1"})]})]},`${t.user_id}-${s}`))})})]});if(U&&o){const t=v>=o.passing_score;return e.jsx("div",{className:"h-full flex items-center justify-center bg-gradient-to-br from-purple-50 via-white to-blue-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 p-4",children:e.jsxs("div",{className:"max-w-2xl w-full bg-white dark:bg-slate-800 rounded-3xl shadow-2xl p-8 text-center",children:[t?e.jsx(O,{className:"w-20 h-20 text-green-500 mx-auto mb-4"}):e.jsx(pe,{className:"w-20 h-20 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2",children:t?"Congratulations!":"Keep Trying!"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:t?`You passed with ${v}% and earned ${o.points_reward} points!`:`You scored ${v}%. You need ${o.passing_score}% to pass.`}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700 rounded-xl p-4",children:[e.jsx(xe,{className:"w-8 h-8 text-blue-500 mx-auto mb-2"}),e.jsxs("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:[v,"%"]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Score"})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700 rounded-xl p-4",children:[e.jsx(O,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),e.jsxs("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:[X,"/",i.length]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Correct"})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700 rounded-xl p-4",children:[e.jsx(f,{className:"w-8 h-8 text-yellow-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:t?o.points_reward:0}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Points"})]})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs("button",{onClick:()=>P(o),className:"flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors",children:[e.jsx(be,{size:20}),"Retake Quiz"]}),e.jsxs("button",{onClick:()=>R(o),className:"flex items-center gap-2 px-6 py-3 bg-purple-600 text-white rounded-xl font-semibold hover:bg-purple-700 transition-colors",children:[e.jsx(H,{size:20}),"Leaderboard"]}),e.jsx("button",{onClick:F,className:"px-6 py-3 bg-slate-200 dark:bg-slate-700 text-slate-900 dark:text-white rounded-xl font-semibold hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors",children:"Back to Quizzes"})]})]})})}if(z&&o&&i.length>0){const t=i[d],s=h[t.id],l=(d+1)/i.length*100;return e.jsxs("div",{className:"h-full flex flex-col bg-gradient-to-br from-purple-50 via-white to-blue-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white px-4 sm:px-6 py-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-6 h-6"}),e.jsxs("span",{className:"font-semibold",children:["Question ",d+1," of ",i.length]})]}),p!==null&&e.jsxs("div",{className:"flex items-center gap-2 bg-white/20 px-3 py-1.5 rounded-lg",children:[e.jsx(A,{className:"w-5 h-5"}),e.jsx("span",{className:"font-mono font-bold",children:M(p)})]})]}),e.jsx("div",{className:"h-2 bg-white/20 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-white transition-all duration-300",style:{width:`${l}%`}})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 sm:px-6 py-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-6 sm:p-8 mb-6",children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-slate-900 dark:text-white mb-6",children:t.question_text}),e.jsx("div",{className:"space-y-3",children:["A","B","C","D"].map(n=>{const a=t[`option_${n.toLowerCase()}`],m=s===n;return e.jsx("button",{onClick:()=>ae(t.id,n),className:`w-full text-left p-4 rounded-xl border-2 transition-all ${m?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-slate-200 dark:border-slate-700 hover:border-blue-300 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold ${m?"bg-blue-500 text-white":"bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-400"}`,children:n}),e.jsx("span",{className:"text-slate-900 dark:text-white",children:a})]})},n)})}),S&&e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl",children:[e.jsxs("p",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100 mb-2",children:["Correct Answer: ",t.correct_answer]}),e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:t.explanation})]})]}),e.jsxs("div",{className:"flex gap-3 justify-between",children:[e.jsx("button",{onClick:le,disabled:d===0,className:"px-6 py-3 bg-slate-200 dark:bg-slate-700 text-slate-900 dark:text-white rounded-xl font-semibold hover:bg-slate-300 dark:hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Previous"}),e.jsxs("button",{onClick:()=>b(!S),className:"px-6 py-3 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded-xl font-semibold hover:bg-purple-200 dark:hover:bg-purple-900/50 transition-colors",children:[S?"Hide":"Show"," Answer"]}),d===i.length-1?e.jsx("button",{onClick:I,disabled:Object.keys(h).length!==i.length,className:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl font-semibold hover:from-green-600 hover:to-emerald-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg hover:shadow-xl",children:"Submit Quiz"}):e.jsx("button",{onClick:re,className:"px-6 py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors",children:"Next"})]})]})})]})}return e.jsxs("div",{className:"h-full flex flex-col bg-gradient-to-br from-purple-50 via-white to-blue-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white px-4 sm:px-6 py-8 sm:py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(u,{className:"w-10 h-10"}),e.jsx("h1",{className:"text-2xl sm:text-4xl font-bold",children:"Poetry Quizzes"})]}),e.jsx("p",{className:"text-lg opacity-90",children:"Test your poetry knowledge and earn points"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 sm:px-6 py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-wrap gap-3 mb-6",children:[e.jsxs("select",{value:N,onChange:t=>V(t.target.value),className:"px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Categories"}),e.jsx("option",{value:"forms",children:"Poetic Forms"}),e.jsx("option",{value:"poets",children:"Famous Poets"}),e.jsx("option",{value:"devices",children:"Literary Devices"}),e.jsx("option",{value:"history",children:"Poetry History"}),e.jsx("option",{value:"general",children:"General"})]}),e.jsxs("select",{value:k,onChange:t=>Z(t.target.value),className:"px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Difficulties"}),e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:E.map(t=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-lg hover:shadow-xl transition-all p-6 border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-600 dark:text-purple-400",children:[ie(t.category),e.jsx("span",{className:"text-sm font-semibold capitalize",children:t.category})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold capitalize ${ne(t.difficulty)}`,children:t.difficulty})]}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-2",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-600 dark:text-slate-400 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{size:16}),e.jsxs("span",{children:[t.question_count," questions"]})]}),t.time_limit_seconds&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{size:16}),e.jsxs("span",{children:[Math.floor(t.time_limit_seconds/60)," min"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{size:16}),e.jsxs("span",{children:[t.points_reward," pts"]})]})]}),t.best_score!==void 0&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm font-semibold text-green-700 dark:text-green-300",children:["Best Score: ",t.best_score,"% (",t.attempts_count," ",t.attempts_count===1?"attempt":"attempts",")"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>P(t),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl font-semibold hover:from-purple-700 hover:to-blue-700 transition-all shadow-md hover:shadow-lg",children:[e.jsx(fe,{size:18}),"Start Quiz"]}),e.jsx("button",{onClick:()=>R(t),className:"px-4 py-3 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-xl hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors",children:e.jsx(H,{size:18})})]})]},t.id))}),E.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(u,{className:"w-20 h-20 text-slate-300 dark:text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"No quizzes found"})]})]})})]})}export{ke as default};
