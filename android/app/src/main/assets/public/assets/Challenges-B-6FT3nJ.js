import{u as k,r as l,s as r,j as e,h,Z as v,l as C}from"./index-2dP_p1EG.js";import{C as g}from"./circle-check-big-Dekx_aag.js";import{C as S}from"./clock-DJOLL9Lo.js";function E(){const{user:s}=k(),[x,f]=l.useState([]),[n,b]=l.useState(null),[j,p]=l.useState(!0),c=l.useCallback(async()=>{if(!s)return;const t=new Date().toISOString(),{data:a,error:i}=await r.from("challenges").select("*").lte("start_date",t).gte("end_date",t).order("end_date",{ascending:!0});if(i){console.error("Error loading challenges:",i),p(!1);return}const m=await Promise.all((a||[]).map(async o=>{const{count:y}=await r.from("challenge_participations").select("id",{count:"exact",head:!0}).eq("challenge_id",o.id),{data:d}=await r.from("challenge_participations").select("completed").eq("challenge_id",o.id).eq("user_id",s.id).maybeSingle();return{...o,participant_count:y||0,user_has_joined:!!d,user_completed:(d==null?void 0:d.completed)||!1}}));f(m),p(!1)},[s]),u=l.useCallback(async()=>{if(!s)return;const t=new Date().toISOString().split("T")[0],{data:a,error:i}=await r.from("daily_prompts").select("*").eq("prompt_date",t).maybeSingle();if(i||!a){console.error("Error loading prompt:",i);return}const{count:m}=await r.from("prompt_responses").select("id",{count:"exact",head:!0}).eq("prompt_id",a.id),{data:o}=await r.from("prompt_responses").select("id").eq("prompt_id",a.id).eq("user_id",s.id).maybeSingle();b({...a,response_count:m||0,user_has_responded:!!o})},[s]);l.useEffect(()=>{s&&(c(),u())},[s,c,u]);const _=async t=>{if(!s)return;const{error:a}=await r.from("challenge_participations").insert([{challenge_id:t,user_id:s.id}]);if(a){console.error("Error joining challenge:",a);return}c()},w=t=>{switch(t){case"timed":return e.jsx(S,{size:20});case"word_count":return e.jsx(h,{size:20});case"form":return e.jsx(C,{size:20});case"daily":return e.jsx(v,{size:20});default:return e.jsx(h,{size:20})}},N=t=>new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"});return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4 sm:py-8 pb-24",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-slate-900 dark:text-white mb-4 sm:mb-6",children:"Challenges & Prompts"}),n&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-violet-100 dark:from-purple-900/20 dark:to-violet-800/20 rounded-lg p-4 sm:p-6 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3 gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold text-slate-900 dark:text-white mb-1",children:"Today's Writing Prompt"}),e.jsxs("p",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:[n.response_count," poets have responded today"]})]}),n.user_has_responded&&e.jsxs("span",{className:"flex items-center gap-1 text-green-600 dark:text-green-400 text-xs sm:text-sm font-medium flex-shrink-0",children:[e.jsx(g,{size:14,className:"sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Completed"})]})]}),e.jsxs("p",{className:"text-base sm:text-lg text-slate-900 dark:text-white font-serif mb-3",children:['"',n.prompt_text,'"']}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-xs px-2 py-1 bg-purple-200 dark:bg-purple-800 text-purple-800 dark:text-purple-200 rounded",children:n.category})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:j?e.jsx("div",{className:"col-span-full text-center py-12",children:e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"})}):x.length===0?e.jsx("div",{className:"col-span-full text-center py-12",children:e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"No active challenges at the moment"})}):x.map(t=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-purple-100 to-violet-200 dark:from-purple-900/20 dark:to-violet-800/20 text-purple-600 dark:text-purple-400",children:w(t.challenge_type)}),t.user_completed&&e.jsxs("span",{className:"flex items-center gap-1 text-green-600 dark:text-green-400 text-xs sm:text-sm font-medium",children:[e.jsx(g,{size:14,className:"sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Done"})]})]}),e.jsx("h3",{className:"text-base sm:text-lg font-bold text-slate-900 dark:text-white mb-2",children:t.title}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400 mb-4 line-clamp-2",children:t.description}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs sm:text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Target:"}),e.jsxs("span",{className:"font-semibold text-slate-900 dark:text-white",children:[t.target_value," ",t.challenge_type==="word_count"?"words":t.challenge_type==="timed"?"minutes":"poems"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs sm:text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Ends:"}),e.jsx("span",{className:"font-semibold text-slate-900 dark:text-white",children:N(t.end_date)})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs sm:text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Participants:"}),e.jsx("span",{className:"font-semibold text-slate-900 dark:text-white",children:t.participant_count})]})]}),t.user_has_joined?e.jsx("button",{disabled:!0,className:"w-full px-4 py-2 bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-400 rounded-lg font-medium cursor-not-allowed text-sm sm:text-base",children:t.user_completed?"Completed":"In Progress"}):e.jsx("button",{onClick:()=>_(t.id),className:"w-full px-4 py-2 bg-purple-500 hover:bg-purple-600 active:bg-purple-700 text-white rounded-lg font-medium transition-colors touch-manipulation text-sm sm:text-base",children:"Join Challenge"})]},t.id))})]})}export{E as default};
