import{c as w,r as a,u as re,s as n,j as e,B as oe,X as R,P as ie,D as ne}from"./index-DSaTw0cA.js";import{P as ce}from"./plus-DSQlmcyZ.js";import{S as de}from"./sparkles-BSW2FsuD.js";import{S as $}from"./search-j1OQYiiI.js";import{S as H,G as me,L as xe}from"./star-DNR7Arxs.js";import{T as ue}from"./trash-2-DSuqYn0V.js";const he=w("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);const B=w("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);const be=w("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);const pe=w("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);function fe({onNewPoem:W,onEditPoem:Q}){const{user:r}=re(),[z,K]=a.useState([]),[N,U]=a.useState([]),[b,G]=a.useState(""),[i,E]=a.useState("all"),[O,C]=a.useState(!1),[f,S]=a.useState(""),[c,V]=a.useState(null),[g,Y]=a.useState(null),[P,Z]=a.useState({}),[d,L]=a.useState("library"),[y,A]=a.useState([]),[_,F]=a.useState(!1),[j,M]=a.useState(""),[p,q]=a.useState(""),m=a.useCallback(async()=>{if(!r)return;const{data:t,error:s}=await n.from("poems").select("*").eq("user_id",r.id).order("updated_at",{ascending:!1});if(s){console.error("Error loading poems:",s);return}K(t||[])},[r]),v=a.useCallback(async()=>{if(!r)return;const{data:t,error:s}=await n.from("collections").select("*").eq("user_id",r.id).order("created_at",{ascending:!1});if(s){console.error("Error loading collections:",s);return}U(t||[])},[r]),x=a.useCallback(async()=>{if(!r)return;const{data:t,error:s}=await n.from("poem_collections").select("poem_id, collection_id");if(s){console.error("Error loading poem collections:",s);return}const l={};t?.forEach(o=>{l[o.poem_id]||(l[o.poem_id]=[]),l[o.poem_id].push(o.collection_id)}),Z(l)},[r]);a.useEffect(()=>{r&&(m(),v(),x())},[r,m,v,x]);const u=a.useCallback(async(t,s={})=>{if(r){F(!0);try{const o=`undefined/functions/v1/fetch-poems?${new URLSearchParams({action:t,...s})}`,k=await fetch(o,{headers:{Authorization:"Bearer undefined","Content-Type":"application/json"}});if(!k.ok)throw new Error("Failed to fetch poems");const le=await k.json();A(le.poems||[])}catch(l){console.error("Error fetching internet poems:",l),A([])}finally{F(!1)}}},[r]),h=a.useCallback(()=>{u("random",{count:"20"})},[u]),D=a.useCallback(()=>{p?u("by_author",{author:p}):j?u("by_title",{title:j}):h()},[p,j,u,h]),J=a.useCallback(async t=>{if(!r)return;const s=t.lines.join(`
`),l=s.split(/\s+/).filter(k=>k.length>0).length,{error:o}=await n.from("poems").insert([{user_id:r.id,title:`${t.title} by ${t.author}`,content:s,is_public:!1,word_count:l,favorited:!1}]);if(o){console.error("Error saving poem:",o),alert("Failed to save poem");return}alert("Poem saved to your library!"),m()},[r,m]);a.useEffect(()=>{d==="discover"&&y.length===0&&h()},[d,y.length,h]);const X=a.useCallback(async(t,s)=>{const{error:l}=await n.from("poem_collections").insert([{poem_id:t,collection_id:s}]);if(l){console.error("Error adding poem to collection:",l);return}x()},[x]),ee=a.useCallback(async(t,s)=>{const{error:l}=await n.from("poem_collections").delete().eq("poem_id",t).eq("collection_id",s);if(l){console.error("Error removing poem from collection:",l);return}x()},[x]),T=a.useMemo(()=>{let t=[...z];if(b){const s=b.toLowerCase();t=t.filter(l=>l.title.toLowerCase().includes(s)||l.content.toLowerCase().includes(s))}return i==="favorites"?t=t.filter(s=>s.favorited):i==="public"?t=t.filter(s=>s.is_public):i==="private"&&(t=t.filter(s=>!s.is_public)),c&&(t=t.filter(s=>P[s.id]?.includes(c))),t},[z,b,i,c,P]),te=a.useCallback(async t=>{if(!confirm("Are you sure you want to delete this poem?"))return;const{error:s}=await n.from("poems").delete().eq("id",t);if(s){console.error("Error deleting poem:",s);return}m()},[m]),I=a.useCallback(async()=>{if(!r||!f.trim())return;const{error:t}=await n.from("collections").insert([{user_id:r.id,name:f,description:"",color:"#6366f1"}]);if(t){console.error("Error creating collection:",t);return}S(""),C(!1),v()},[r,f,v]),se=a.useCallback(t=>new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),[]),ae=["William Shakespeare","Emily Dickinson","Walt Whitman","Robert Frost","Maya Angelou","Langston Hughes","Edgar Allan Poe","Pablo Neruda","Sylvia Plath","T. S. Eliot","William Wordsworth","John Keats"];return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4 sm:py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-slate-900 dark:text-white",children:d==="library"?"Your Library":"Discover Poems"}),e.jsxs("button",{onClick:W,className:"flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors",children:[e.jsx(ce,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"New Poem"}),e.jsx("span",{className:"sm:hidden",children:"New"})]})]}),e.jsxs("div",{className:"flex gap-2 mb-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("button",{onClick:()=>L("library"),className:`px-4 py-2 font-medium transition-colors border-b-2 ${d==="library"?"border-blue-500 text-blue-500":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{size:18}),"Your Poems"]})}),e.jsx("button",{onClick:()=>L("discover"),className:`px-4 py-2 font-medium transition-colors border-b-2 ${d==="discover"?"border-blue-500 text-blue-500":"border-transparent text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{size:18}),"Discover"]})})]}),d==="library"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("label",{htmlFor:"poem-search",className:"sr-only",children:"Search poems"}),e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:20,"aria-hidden":"true"}),e.jsx("input",{id:"poem-search",type:"search",value:b,onChange:t=>G(t.target.value),placeholder:"Search poems...",className:"w-full pl-10 pr-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white","aria-label":"Search poems by title or content"})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto",role:"group","aria-label":"Filter poems",children:[e.jsx("button",{onClick:()=>E("all"),className:`px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors text-sm whitespace-nowrap ${i==="all"?"bg-blue-500 text-white":"bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-400"}`,"aria-pressed":i==="all","aria-label":"Show all poems",children:"All"}),e.jsxs("button",{onClick:()=>E("favorites"),className:`px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-1.5 text-sm whitespace-nowrap ${i==="favorites"?"bg-blue-500 text-white":"bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-400"}`,"aria-pressed":i==="favorites","aria-label":"Show favorite poems only",children:[e.jsx(H,{size:16,"aria-hidden":"true"}),e.jsx("span",{className:"hidden xs:inline",children:"Favorites"})]})]})]}),e.jsxs("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",role:"group","aria-label":"Collections",children:[e.jsxs("button",{onClick:()=>C(!0),className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors whitespace-nowrap","aria-label":"Create new collection",children:[e.jsx(he,{size:18,"aria-hidden":"true"}),e.jsx("span",{className:"text-sm font-medium",children:"New Collection"})]}),N.map(t=>e.jsxs("button",{onClick:()=>V(c===t.id?null:t.id),className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-colors whitespace-nowrap ${c===t.id?"bg-blue-500 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400"}`,"aria-pressed":c===t.id,"aria-label":`${c===t.id?"Hide":"Show"} collection: ${t.name}`,children:[e.jsx(B,{size:18,"aria-hidden":"true"}),e.jsx("span",{className:"text-sm font-medium",children:t.name})]},t.id))]}),O&&e.jsx("div",{className:"mb-6 p-4 bg-slate-100 dark:bg-slate-800 rounded-lg",role:"form","aria-label":"Create new collection",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"new-collection-name",className:"sr-only",children:"Collection name"}),e.jsx("input",{id:"new-collection-name",type:"text",value:f,onChange:t=>S(t.target.value),placeholder:"Collection name...",className:"flex-1 px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white",onKeyDown:t=>t.key==="Enter"&&I(),"aria-label":"New collection name"}),e.jsx("button",{onClick:I,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium","aria-label":"Create collection",children:"Create"}),e.jsx("button",{onClick:()=>{C(!1),S("")},className:"px-3 py-2 bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-400 rounded-lg","aria-label":"Cancel creating collection",children:e.jsx(R,{size:20,"aria-hidden":"true"})})]})})]}):e.jsxs("div",{className:"space-y-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:20}),e.jsx("input",{type:"search",value:j,onChange:t=>M(t.target.value),placeholder:"Search by title...",className:"w-full pl-10 pr-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white",onKeyDown:t=>t.key==="Enter"&&D()})]}),e.jsxs("button",{onClick:D,disabled:_,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-slate-400 text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:[e.jsx($,{size:18}),"Search"]}),e.jsxs("button",{onClick:h,disabled:_,className:"px-4 py-2 bg-green-500 hover:bg-green-600 disabled:bg-slate-400 text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:[e.jsx(be,{size:18}),"Random"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-3",children:"Popular Authors:"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:ae.map(t=>e.jsx("button",{onClick:()=>{q(t),M(""),u("by_author",{author:t})},className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${p===t?"bg-blue-500 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:t},t))}),p&&e.jsxs("button",{onClick:()=>{q(""),h()},className:"mt-3 text-sm text-blue-500 hover:text-blue-600 flex items-center gap-1",children:[e.jsx(R,{size:14}),"Clear author filter"]})]})]})]}),d==="library"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",role:"list","aria-label":"Poem library",children:T.length===0?e.jsx("div",{className:"col-span-full text-center py-12",role:"status",children:e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:b||i!=="all"?"No poems found matching your criteria":"No poems yet. Start writing!"})}):T.map(t=>e.jsxs("article",{className:"bg-white dark:bg-slate-800 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow group relative",role:"listitem","aria-label":`Poem: ${t.title}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white line-clamp-1 flex-1",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity",role:"group","aria-label":"Poem actions",children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),Q(t.id)},className:"text-blue-500 hover:text-blue-600","aria-label":`Edit ${t.title}`,children:e.jsx(ie,{size:16,"aria-hidden":"true"})}),t.favorited&&e.jsx(H,{size:16,className:"text-yellow-500",fill:"currentColor","aria-label":"Favorited"}),t.is_public?e.jsx(me,{size:16,className:"text-green-500","aria-label":"Public poem"}):e.jsx(xe,{size:16,className:"text-slate-400","aria-label":"Private poem"}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:s=>{s.stopPropagation(),Y(g===t.id?null:t.id)},className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300","aria-label":`${g===t.id?"Close":"Open"} collection menu for ${t.title}`,"aria-expanded":g===t.id,"aria-haspopup":"menu",children:e.jsx(pe,{size:16,"aria-hidden":"true"})}),g===t.id&&e.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-slate-700 rounded-lg shadow-lg border border-slate-200 dark:border-slate-600 z-10",role:"menu","aria-label":"Collection menu",children:e.jsxs("div",{className:"p-2",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 px-2 py-1",children:"Add to Collection"}),N.length===0?e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 px-2 py-2",children:"No collections yet"}):N.map(s=>{const l=P[t.id]?.includes(s.id);return e.jsx("button",{onClick:o=>{o.stopPropagation(),l?ee(t.id,s.id):X(t.id,s.id)},className:`w-full text-left px-2 py-1.5 rounded text-sm transition-colors ${l?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"hover:bg-slate-100 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300"}`,role:"menuitem","aria-label":`${l?"Remove from":"Add to"} collection: ${s.name}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{size:14,"aria-hidden":"true"}),e.jsx("span",{children:s.name})]})},s.id)})]})})]}),e.jsx("button",{onClick:s=>{s.stopPropagation(),te(t.id)},className:"text-red-500 hover:text-red-600","aria-label":`Delete ${t.title}`,children:e.jsx(ue,{size:16,"aria-hidden":"true"})})]})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 text-sm line-clamp-3 mb-4 font-serif",children:t.content||"No content yet..."}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.jsxs("span",{children:[t.word_count," words"]}),e.jsx("span",{children:se(t.created_at)})]})]},t.id))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:_?e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-4",children:"Loading poems..."})]}):y.length===0?e.jsx("div",{className:"col-span-full text-center py-12",children:e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"No poems found. Try searching or loading random poems."})}):y.map((t,s)=>e.jsxs("article",{className:"bg-white dark:bg-slate-800 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow group",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white line-clamp-2",children:t.title}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["by ",t.author]})]}),e.jsx("button",{onClick:()=>J(t),className:"text-blue-500 hover:text-blue-600 opacity-0 group-hover:opacity-100 transition-opacity",title:"Save to your library",children:e.jsx(ne,{size:18})})]}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400 text-sm line-clamp-6 mb-4 font-serif whitespace-pre-wrap",children:[t.lines.slice(0,8).join(`
`),t.lines.length>8&&`
...`]}),e.jsx("div",{className:"flex items-center justify-between text-xs text-slate-500",children:e.jsxs("span",{children:[t.linecount," lines"]})})]},`${t.author}-${t.title}-${s}`))})]})}const Ne=a.memo(fe);export{Ne as default};
