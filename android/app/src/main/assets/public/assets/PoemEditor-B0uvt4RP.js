import{c as C,u as E,r as a,s as j,j as e}from"./index-DSaTw0cA.js";import{S as _,G as q,L as $}from"./star-DNR7Arxs.js";const A=C("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const M=C("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);function G({selectedPoemId:d,onBack:P}){const{user:n}=E(),[x,p]=a.useState(d),[c,b]=a.useState(""),[r,f]=a.useState(""),[l,h]=a.useState(!1),[o,g]=a.useState(!1),[y,N]=a.useState(!1),[v,w]=a.useState(null),[S,i]=a.useState(null),m=a.useRef(),u=r.trim()?r.trim().split(/\s+/).length:0,F=r.split(`
`).length;a.useEffect(()=>{p(d),d?z(d):L()},[d]),a.useEffect(()=>(m.current&&clearTimeout(m.current),(r.trim()||c.trim())&&(m.current=setTimeout(()=>{T()},1500)),()=>{m.current&&clearTimeout(m.current)}),[c,r,l,o,n,x,u]);const L=()=>{b(""),f(""),h(!1),g(!1),w(null),i(null),p(null)},z=async s=>{if(!(!s||!n))try{const{data:t,error:k}=await j.from("poems").select("*").eq("id",s).eq("user_id",n.id).maybeSingle();if(k){console.debug("Failed to load poem"),i("Failed to load poem");return}t&&(b(t.title),f(t.content),h(t.is_public),g(t.favorited),i(null))}catch{console.debug("Failed to load poem"),i("Failed to load poem")}},T=async()=>{if(!(!n||!r.trim()&&!c.trim())){N(!0),i(null);try{const s={user_id:n.id,title:c.trim()||"Untitled",content:r,is_public:l,favorited:o,word_count:u,updated_at:new Date().toISOString()};if(x){const{error:t}=await j.from("poems").update(s).eq("id",x).eq("user_id",n.id);if(t){console.debug("Failed to save poem"),i("Failed to save poem");return}}else{const{data:t,error:k}=await j.from("poems").insert([s]).select("id").single();if(k){console.debug("Failed to save poem"),i("Failed to save poem");return}t&&p(t.id)}w(new Date)}catch{console.debug("Failed to save poem"),i("Failed to save poem")}finally{N(!1)}}};return e.jsx("div",{className:"h-full flex flex-col bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-slate-800",children:e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6 sm:py-8",children:[e.jsxs("button",{onClick:P,className:"flex items-center gap-2 text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white mb-6 transition-colors","aria-label":"Go back to library",children:[e.jsx(A,{size:20,"aria-hidden":"true"}),e.jsx("span",{children:"Back to Library"})]}),S&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-300",role:"alert","aria-live":"assertive",children:S}),e.jsxs("div",{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm rounded-2xl shadow-xl overflow-hidden border border-slate-200/50 dark:border-slate-700/50",children:[e.jsxs("div",{className:"p-6 sm:p-8 border-b border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-6",children:[e.jsx("label",{htmlFor:"poem-title",className:"sr-only",children:"Poem Title"}),e.jsx("input",{id:"poem-title",type:"text",value:c,onChange:s=>b(s.target.value),className:"text-3xl sm:text-4xl font-bold bg-transparent border-none outline-none text-slate-900 dark:text-white flex-1 placeholder:text-slate-400 dark:placeholder:text-slate-600",placeholder:"Untitled Poem","aria-label":"Poem title"}),e.jsxs("div",{className:"flex items-center gap-3","aria-live":"polite","aria-atomic":"true",children:[y&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 px-3 py-1.5 rounded-full",children:[e.jsx(M,{size:14,className:"animate-pulse","aria-hidden":"true"}),e.jsx("span",{className:"hidden sm:inline",children:"Saving"}),e.jsx("span",{className:"sr-only",children:"Saving poem"})]}),!y&&v&&e.jsx("div",{className:"text-sm text-slate-500 dark:text-slate-400 bg-slate-100 dark:bg-slate-700/50 px-3 py-1.5 rounded-full hidden sm:block",children:e.jsxs("span",{"aria-label":`Poem saved at ${v.toLocaleTimeString()}`,children:["Saved ",v.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>g(!o),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all duration-200 ${o?"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400":"bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700"}`,"aria-pressed":o,"aria-label":o?"Remove from favorites":"Add to favorites",children:[e.jsx(_,{size:18,fill:o?"currentColor":"none","aria-hidden":"true"}),e.jsx("span",{className:"text-sm",children:"Favorite"})]}),e.jsxs("button",{onClick:()=>h(!l),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all duration-200 ${l?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400":"bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700"}`,"aria-pressed":l,"aria-label":l?"Make poem private":"Make poem public",children:[l?e.jsx(q,{size:18,"aria-hidden":"true"}):e.jsx($,{size:18,"aria-hidden":"true"}),e.jsx("span",{className:"text-sm",children:l?"Public":"Private"})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-4 text-sm text-slate-600 dark:text-slate-400 bg-slate-100 dark:bg-slate-700/50 px-4 py-2 rounded-xl",role:"status","aria-live":"polite",children:[e.jsxs("span",{className:"font-medium","aria-label":`${u} words`,children:[u," words"]}),e.jsx("span",{className:"text-slate-400 dark:text-slate-600","aria-hidden":"true",children:"Â·"}),e.jsxs("span",{className:"font-medium","aria-label":`${F} lines`,children:[F," lines"]})]})]})]}),e.jsxs("div",{className:"p-6 sm:p-8",children:[e.jsx("label",{htmlFor:"poem-content",className:"sr-only",children:"Poem Content"}),e.jsx("textarea",{id:"poem-content",value:r,onChange:s=>f(s.target.value),className:"w-full min-h-[500px] bg-transparent border-none outline-none text-slate-900 dark:text-white text-lg sm:text-xl leading-relaxed resize-none font-serif placeholder:text-slate-400 dark:placeholder:text-slate-600",placeholder:"Let your words flow...","aria-label":"Poem content","aria-describedby":"poem-stats"})]})]})]})})})}export{G as default};
