import{r as i,u as T,j as e,B as k,F as M,b as L,T as A}from"./index-CGemffCt.js";import{c as W,q as z,o as P,w as q,b as C,d as E}from"./firebase-DRdGEDvY.js";import{C as F}from"./calendar-_Ckto2X5.js";import"./index.esm-hzf3Ma5u.js";function H(){const{user:x}=T(),[j,w]=i.useState([]),[g,y]=i.useState(0),[v,D]=i.useState(0),[S,p]=i.useState(0),[_,b]=i.useState(0),N=i.useCallback(t=>{if(t.length===0){p(0),b(0);return}const a=Array.from(new Set(t.map(n=>new Date(n.created_at).toDateString()))).sort((n,s)=>new Date(s).getTime()-new Date(n).getTime()),m=new Date;m.setHours(0,0,0,0);let o=0;const u=new Date(m);for(const n of a){const s=new Date(n);if(s.setHours(0,0,0,0),s.getTime()===u.getTime())o++,u.setDate(u.getDate()-1);else break}let l=0,c=1;for(let n=0;n<a.length-1;n++){const s=new Date(a[n]),r=new Date(a[n+1]);s.setHours(0,0,0,0),r.setHours(0,0,0,0),Math.floor((s.getTime()-r.getTime())/(1e3*60*60*24))===1?c++:(l=Math.max(l,c),c=1)}l=Math.max(l,c,o),p(o),b(l)},[]);i.useEffect(()=>{if(!(x!=null&&x.id))return;const t=W(E,"poems"),a=z(t,q("user_id","==",x.id),P("created_at","desc")),m=C(a,o=>{const l=o.docs.map(s=>s.data())||[];y(l.length),D(l.reduce((s,r)=>s+(r.word_count||0),0)),N(l);const c={};l.forEach(s=>{const r=new Date(s.created_at).toISOString().split("T")[0];c[r]||(c[r]={date:r,poems_written:0,words_written:0,minutes_writing:0}),c[r].poems_written++,c[r].words_written+=s.word_count||0,c[r].minutes_writing+=Math.ceil((s.word_count||0)/50)});const n=Object.values(c).sort((s,r)=>new Date(r.date).getTime()-new Date(s.date).getTime()).slice(0,30);w(n)});return()=>m()},[x,N]);const d=i.useMemo(()=>j.slice(0,7).reverse(),[j]),f=i.useMemo(()=>d.reduce((t,a)=>t+a.words_written,0),[d]),h=i.useMemo(()=>d.reduce((t,a)=>t+a.poems_written,0),[d]);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8 flex-1",children:[e.jsx("h2",{className:"text-3xl font-bold text-on-surface mb-8",children:"Your Analytics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-surface rounded-xl p-6 shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary-container flex items-center justify-center",children:e.jsx(k,{className:"text-on-primary-container",size:24})})}),e.jsx("p",{className:"text-3xl font-bold text-on-surface mb-1",children:g}),e.jsx("p",{className:"text-sm text-on-surface-variant",children:"Total Poems"})]}),e.jsxs("div",{className:"bg-surface rounded-xl p-6 shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-tertiary-container flex items-center justify-center",children:e.jsx(M,{className:"text-on-tertiary-container",size:24})})}),e.jsx("p",{className:"text-3xl font-bold text-on-surface mb-1",children:v.toLocaleString()}),e.jsx("p",{className:"text-sm text-on-surface-variant",children:"Total Words"})]}),e.jsxs("div",{className:"bg-surface rounded-xl p-6 shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-error-container flex items-center justify-center",children:e.jsx(L,{className:"text-on-error-container",size:24})})}),e.jsx("p",{className:"text-3xl font-bold text-on-surface mb-1",children:S}),e.jsx("p",{className:"text-sm text-on-surface-variant",children:"Day Streak"})]}),e.jsxs("div",{className:"bg-surface rounded-xl p-6 shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-secondary-container flex items-center justify-center",children:e.jsx(A,{className:"text-on-secondary-container",size:24})})}),e.jsx("p",{className:"text-3xl font-bold text-on-surface mb-1",children:_}),e.jsx("p",{className:"text-sm text-on-surface-variant",children:"Longest Streak"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-surface rounded-xl p-6 shadow-sm",children:[e.jsx("h3",{className:"text-xl font-semibold text-on-surface mb-6",children:"Last 7 Days Activity"}),e.jsx("div",{className:"space-y-4",children:d.length===0?e.jsx("p",{className:"text-on-surface-variant text-center py-8",children:"No activity in the last 7 days"}):d.map(t=>{const a=new Date(t.date),m=a.toLocaleDateString("en-US",{weekday:"short"}),o=a.toLocaleDateString("en-US",{month:"short",day:"numeric"});return e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-outline last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-container flex items-center justify-center",children:e.jsx(F,{className:"text-on-primary-container",size:18})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-on-surface",children:[m,", ",o]}),e.jsxs("p",{className:"text-sm text-on-surface-variant",children:[t.poems_written," poems, ",t.words_written," words"]})]})]}),e.jsxs("div",{className:"text-sm text-on-surface-variant",children:[t.minutes_writing," min"]})]},t.date)})})]}),e.jsxs("div",{className:"bg-surface rounded-xl p-6 shadow-sm",children:[e.jsx("h3",{className:"text-xl font-semibold text-on-surface mb-6",children:"Weekly Summary"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-on-surface-variant",children:"Poems Written"}),e.jsx("span",{className:"text-2xl font-bold text-on-surface",children:h})]}),e.jsx("div",{className:"w-full bg-surface-variant rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all",style:{width:`${Math.min(h/7*100,100)}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-on-surface-variant",children:"Words Written"}),e.jsx("span",{className:"text-2xl font-bold text-on-surface",children:f.toLocaleString()})]}),e.jsx("div",{className:"w-full bg-surface-variant rounded-full h-2",children:e.jsx("div",{className:"bg-tertiary h-2 rounded-full transition-all",style:{width:`${Math.min(f/1e3*100,100)}%`}})})]}),e.jsxs("div",{className:"pt-4 border-t border-outline",children:[e.jsx("p",{className:"text-sm text-on-surface-variant mb-2",children:"Average per day (last 7 days)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-on-surface",children:(h/7).toFixed(1)}),e.jsx("p",{className:"text-xs text-on-surface-variant",children:"poems/day"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-on-surface",children:Math.round(f/7)}),e.jsx("p",{className:"text-xs text-on-surface-variant",children:"words/day"})]})]})]})]})]})]})]})}const I=i.memo(H);export{I as default};
