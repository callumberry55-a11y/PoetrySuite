import{u as R,r as o,s as c,j as e,M as Y,X as I,B as V,p as T,T as K,n as Q,q as Z,H as W,e as G}from"./index-CGemffCt.js";import{r as ee}from"./security-CwStJ5w9.js";import{T as te}from"./trash-2-CpZgBkr4.js";import{S as se}from"./send-DpFuWiTj.js";import{P as ae}from"./plus-zAg5GACl.js";import{C as re,a as le,B as ie,b as oe}from"./chevron-right-D8OndkQm.js";import{E as ne}from"./eye-CihzmZqK.js";import{U as de}from"./upload-BBqDmfB7.js";import{U as ce}from"./user-check-DSCbPaLA.js";import"./index.esm-hzf3Ma5u.js";function xe({poemId:s}){const{user:m}=R(),[N,x]=o.useState([]),[D,p]=o.useState(""),[y,b]=o.useState(!0),[C,i]=o.useState(!1),v=o.useCallback(async()=>{try{b(!0);const{data:n,error:h}=await c.from("comments").select(`
          id,
          poem_id,
          user_id,
          content,
          created_at,
          updated_at
        `).eq("poem_id",s).order("created_at",{ascending:!0});if(h)throw h;const w=await Promise.all((n||[]).map(async k=>{const{data:f}=await c.from("user_profiles").select("username").eq("user_id",k.user_id).maybeSingle();return{...k,username:(f==null?void 0:f.username)||"Anonymous"}}));x(w)}catch(n){console.error("Error loading comments:",n)}finally{b(!1)}},[s]);o.useEffect(()=>{v()},[v]);const P=async n=>{if(n.preventDefault(),!D.trim()||!m)return;const h=D.trim();p("");try{i(!0);const{data:w,error:k}=await c.from("comments").insert({poem_id:s,user_id:m.id,content:h}).select().single();if(k)throw k;const{data:f}=await c.from("user_profiles").select("username").eq("user_id",m.id).maybeSingle(),S={...w,username:(f==null?void 0:f.username)||"Anonymous"};x([...N,S])}catch(w){console.error("Error posting comment:",w),p(h),alert("Failed to post comment. Please try again.")}finally{i(!1)}},q=async n=>{if(confirm("Delete this comment?"))try{const{error:h}=await c.from("comments").delete().eq("id",n);if(h)throw h;x(N.filter(w=>w.id!==n))}catch(h){console.error("Error deleting comment:",h),alert("Failed to delete comment")}},U=n=>{const h=new Date(n),k=new Date().getTime()-h.getTime(),f=Math.floor(k/6e4),S=Math.floor(k/36e5),t=Math.floor(k/864e5);return f<1?"Just now":f<60?`${f}m ago`:S<24?`${S}h ago`:t<7?`${t}d ago`:h.toLocaleDateString()};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-on-surface-variant",children:[e.jsx(Y,{size:20}),e.jsxs("h3",{className:"font-semibold",children:["Comments (",N.length,")"]})]}),y?e.jsx("div",{className:"text-center py-8 text-on-surface-variant",children:"Loading comments..."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:N.length===0?e.jsx("p",{className:"text-center py-8 text-on-surface-variant",children:"No comments yet. Be the first to comment!"}):N.map(n=>e.jsx("div",{className:"bg-surface-variant rounded-lg p-3 space-y-2",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-semibold text-on-surface",children:n.username}),e.jsx("span",{className:"text-on-surface-variant text-xs",children:U(n.created_at)})]}),e.jsx("p",{className:"text-on-surface mt-1 whitespace-pre-wrap break-words",children:n.content})]}),m&&m.id===n.user_id&&e.jsx("button",{onClick:()=>q(n.id),className:"flex-shrink-0 p-1.5 rounded-lg hover:bg-error-container hover:text-error transition-colors","aria-label":"Delete comment",children:e.jsx(te,{size:16})})]})},n.id))}),m&&e.jsxs("form",{onSubmit:P,className:"space-y-3",children:[e.jsx("textarea",{value:D,onChange:n=>p(n.target.value),placeholder:"Write a comment...",className:"w-full px-4 py-3 bg-surface-variant text-on-surface rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-primary",rows:3,maxLength:500}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-on-surface-variant",children:[D.length,"/500"]}),e.jsxs("button",{type:"submit",disabled:!D.trim()||C,className:"flex items-center gap-2 px-4 py-2 bg-primary text-on-primary rounded-lg font-medium hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(se,{size:16}),C?"Posting...":"Post Comment"]})]})]})]})]})}function me(){const{user:s}=R(),[m,N]=o.useState([]),[x,D]=o.useState(null),[p,y]=o.useState(0),[b,C]=o.useState(!1),[i,v]=o.useState(null),[P,q]=o.useState(""),[U,n]=o.useState(""),[h,w]=o.useState(!1),[k,f]=o.useState(0),S=o.useRef(null);o.useEffect(()=>{s&&t()},[s]),o.useEffect(()=>{if(x&&x.stories[p])return f(0),S.current=setInterval(()=>{f(a=>a>=100?(j(),0):a+2)},100),()=>{S.current&&clearInterval(S.current)}},[x,p]);const t=async()=>{if(!s)return;const{data:a,error:d}=await c.from("stories").select(`
        *,
        user_profiles!inner(username, avatar_url)
      `).gt("expires_at",new Date().toISOString()).order("created_at",{ascending:!1});if(d){console.error("Error loading stories:",d);return}const{data:$}=await c.from("story_views").select("story_id").eq("viewer_id",s.id),A=new Set(($==null?void 0:$.map(u=>u.story_id))||[]),E=a.map(u=>({id:u.id,user_id:u.user_id,content_url:u.content_url,content_type:u.content_type,caption:u.caption,created_at:u.created_at,expires_at:u.expires_at,view_count:u.view_count,username:u.user_profiles.username,avatar_url:u.user_profiles.avatar_url,has_viewed:A.has(u.id)})).reduce((u,F)=>{const B=u.find(X=>X.user_id===F.user_id);return B?(B.stories.push(F),F.has_viewed||(B.has_unviewed=!0)):u.push({user_id:F.user_id,username:F.username,avatar_url:F.avatar_url,stories:[F],has_unviewed:!F.has_viewed}),u},[]),O=E.filter(u=>u.user_id===s.id),J=E.filter(u=>u.user_id!==s.id);N([...O,...J])},r=async(a,d=0)=>{D(a),y(d),f(0),a.stories[d]&&a.stories[d].user_id!==(s==null?void 0:s.id)&&await g(a.stories[d].id)},g=async a=>{s&&(await c.from("story_views").insert({story_id:a,viewer_id:s.id}).select().maybeSingle(),t())},j=async()=>{if(x)if(p<x.stories.length-1){const a=p+1;y(a),f(0),x.stories[a].user_id!==(s==null?void 0:s.id)&&await g(x.stories[a].id)}else{const a=m.findIndex(d=>d.user_id===x.user_id);a<m.length-1?r(m[a+1],0):_()}},l=()=>{if(x)if(p>0)y(p-1),f(0);else{const a=m.findIndex(d=>d.user_id===x.user_id);if(a>0){const d=m[a-1];r(d,d.stories.length-1)}}},_=()=>{D(null),y(0),f(0),S.current&&clearInterval(S.current)},L=a=>{var $;const d=($=a.target.files)==null?void 0:$[0];if(d){v(d);const A=URL.createObjectURL(d);n(A)}},M=async()=>{if(!i||!s)return;w(!0);const a=i.name.split(".").pop(),d=`${s.id}/${Date.now()}.${a}`,$=i.type.startsWith("video/")?"video":"image",{error:A}=await c.storage.from("stories").upload(d,i);if(A){console.error("Upload error:",A),alert("Failed to upload story"),w(!1);return}const{data:H}=c.storage.from("stories").getPublicUrl(d),{error:E}=await c.from("stories").insert({user_id:s.id,content_url:H.publicUrl,content_type:$,caption:P});if(E){console.error("Database error:",E),alert("Failed to create story"),w(!1);return}w(!1),C(!1),v(null),n(""),q(""),t()},z=x==null?void 0:x.stories[p];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-4 py-3 overflow-x-auto",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>C(!0),className:"flex-shrink-0 flex flex-col items-center gap-1.5 w-16",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center border-2 border-white dark:border-slate-800 shadow-sm",children:e.jsx(ae,{size:24,className:"text-white"})}),e.jsx("span",{className:"text-xs text-slate-600 dark:text-slate-400 truncate w-full text-center",children:"Add Story"})]}),m.map(a=>e.jsxs("button",{onClick:()=>r(a,0),className:"flex-shrink-0 flex flex-col items-center gap-1.5 w-16",children:[e.jsx("div",{className:`w-16 h-16 rounded-full p-0.5 ${a.has_unviewed?"bg-gradient-to-tr from-yellow-400 via-pink-500 to-purple-600":"bg-slate-300 dark:bg-slate-600"}`,children:e.jsx("div",{className:"w-full h-full rounded-full bg-white dark:bg-slate-800 p-0.5",children:e.jsx("div",{className:"w-full h-full rounded-full bg-gradient-to-br from-blue-500 to-violet-600 flex items-center justify-center text-white text-lg font-bold",children:a.username.charAt(0).toUpperCase()})})}),e.jsx("span",{className:"text-xs text-slate-600 dark:text-slate-400 truncate w-full text-center",children:a.user_id===(s==null?void 0:s.id)?"You":a.username})]},a.user_id))]})}),x&&z&&e.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 flex gap-1 p-2 z-10",children:x.stories.map((a,d)=>e.jsx("div",{className:"flex-1 h-0.5 bg-white/30 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-white transition-all duration-100",style:{width:`${d<p?100:d===p?k:0}%`}})},d))}),e.jsxs("div",{className:"absolute top-4 left-4 right-4 flex items-center justify-between z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-violet-600 flex items-center justify-center text-white font-bold",children:x.username.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:x.username}),e.jsx("div",{className:"text-white/70 text-sm",children:new Date(z.created_at).toLocaleDateString()})]})]}),e.jsx("button",{onClick:_,className:"text-white hover:bg-white/20 p-2 rounded-full transition-colors",children:e.jsx(I,{size:24})})]}),e.jsxs("div",{className:"relative w-full h-full max-w-lg mx-auto flex items-center justify-center",children:[z.content_type==="image"?e.jsx("img",{src:z.content_url,alt:"Story",className:"max-w-full max-h-full object-contain"}):e.jsx("video",{src:z.content_url,className:"max-w-full max-h-full object-contain",autoPlay:!0,muted:!0,playsInline:!0}),e.jsx("button",{onClick:l,className:"absolute left-0 top-0 bottom-0 w-1/3 cursor-pointer","aria-label":"Previous story"}),e.jsx("button",{onClick:j,className:"absolute right-0 top-0 bottom-0 w-1/3 cursor-pointer","aria-label":"Next story"}),e.jsx("button",{onClick:l,className:"absolute left-4 top-1/2 -translate-y-1/2 bg-white/20 hover:bg-white/30 p-2 rounded-full transition-colors",children:e.jsx(re,{size:24,className:"text-white"})}),e.jsx("button",{onClick:j,className:"absolute right-4 top-1/2 -translate-y-1/2 bg-white/20 hover:bg-white/30 p-2 rounded-full transition-colors",children:e.jsx(le,{size:24,className:"text-white"})})]}),z.caption&&e.jsx("div",{className:"absolute bottom-20 left-4 right-4 bg-black/50 backdrop-blur-sm rounded-lg p-3 text-white",children:z.caption}),z.user_id===(s==null?void 0:s.id)&&e.jsxs("div",{className:"absolute bottom-6 left-4 flex items-center gap-2 bg-black/50 backdrop-blur-sm rounded-full px-3 py-1.5 text-white",children:[e.jsx(ne,{size:16}),e.jsxs("span",{className:"text-sm",children:[z.view_count," views"]})]})]}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-xl max-w-lg w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Create Story"}),e.jsx("button",{onClick:()=>{C(!1),v(null),n(""),q("")},className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300",children:e.jsx(I,{size:24})})]}),U?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative w-full h-64 bg-slate-100 dark:bg-slate-700 rounded-lg overflow-hidden",children:i!=null&&i.type.startsWith("video/")?e.jsx("video",{src:U,className:"w-full h-full object-contain",controls:!0}):e.jsx("img",{src:U,alt:"Preview",className:"w-full h-full object-contain"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Caption (optional)"}),e.jsx("textarea",{value:P,onChange:a=>q(a.target.value),rows:2,className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white",placeholder:"Add a caption...",maxLength:200})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{v(null),n("")},className:"flex-1 px-4 py-2 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors",disabled:h,children:"Change"}),e.jsx("button",{onClick:M,disabled:h,className:"flex-1 px-4 py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-colors disabled:opacity-50",children:h?"Uploading...":"Share Story"})]})]}):e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-64 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center py-6",children:[e.jsx(de,{size:48,className:"text-slate-400 mb-3"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Click to upload image or video"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-500 mt-1",children:"Story will expire in 24 hours"})]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*,video/*",onChange:L})]})]})})]})}function _e(){const{user:s}=R(),[m,N]=o.useState([]),[x,D]=o.useState([]),[p,y]=o.useState(!0),[b,C]=o.useState("feed"),[i,v]=o.useState(null),[P,q]=o.useState("checking"),U=o.useCallback(async()=>{y(!0);try{let t=c.from("poems").select("id, title, content, user_id, created_at").eq("is_public",!0).order("created_at",{ascending:!1}).limit(50);if(b==="following"&&s){const{data:l}=await c.from("follows").select("following_id").eq("follower_id",s.id),_=(l==null?void 0:l.map(L=>L.following_id))||[];if(_.length===0){N([]),y(!1);return}t=t.in("user_id",_)}const{data:r,error:g}=await t;if(g)throw g;const j=await Promise.all((r||[]).map(async l=>{const{data:_}=await c.from("user_profiles").select("username").eq("user_id",l.user_id).maybeSingle(),{count:L}=await c.from("reactions").select("id",{count:"exact",head:!0}).eq("poem_id",l.id),{count:M}=await c.from("comments").select("id",{count:"exact",head:!0}).eq("poem_id",l.id),{data:z}=s?await c.from("reactions").select("id").eq("poem_id",l.id).eq("user_id",s.id).maybeSingle():{data:null},{data:a}=s?await c.from("bookmarks").select("id").eq("poem_id",l.id).eq("user_id",s.id).maybeSingle():{data:null},{data:d}=s?await c.from("follows").select("id").eq("follower_id",s.id).eq("following_id",l.user_id).maybeSingle():{data:null};return{id:l.id,title:l.title,content:l.content,created_at:l.created_at,user_id:l.user_id,username:(_==null?void 0:_.username)||"Anonymous",like_count:L||0,comment_count:M||0,user_has_liked:!!z,user_has_bookmarked:!!a,user_is_following:!!d}}));N(j)}catch(t){console.error("Failed to load feed:",t)}finally{y(!1)}},[b,s]),n=o.useCallback(async()=>{y(!0);try{const{data:t,error:r}=await c.from("contests").select("*").order("start_date",{ascending:!1});if(r)throw r;D(t||[])}catch(t){console.error("Failed to load contests:",t)}finally{y(!1)}},[]);o.useEffect(()=>{b==="contests"?n():U()},[b,s,n,U]),o.useEffect(()=>{const t=async()=>{q("checking");const g=await ee("some-user-input");q(g?"active":"inactive")};t();const r=setInterval(t,5e3);return()=>clearInterval(r)},[]);const h=async t=>{if(!s){alert("Please sign in to like poems");return}const r=m.find(l=>l.id===t);if(!r)return;const g=r.user_has_liked,j=r.like_count;N(m.map(l=>l.id===t?{...l,user_has_liked:!l.user_has_liked,like_count:l.like_count+(l.user_has_liked?-1:1)}:l)),(i==null?void 0:i.id)===t&&v({...i,user_has_liked:!i.user_has_liked,like_count:i.like_count+(i.user_has_liked?-1:1)});try{if(g){const{error:l}=await c.from("reactions").delete().eq("poem_id",t).eq("user_id",s.id);if(l)throw l}else{const{error:l}=await c.from("reactions").insert([{poem_id:t,user_id:s.id}]);if(l)throw l}}catch(l){console.error("Error toggling like:",l),N(m.map(_=>_.id===t?{..._,user_has_liked:g,like_count:j}:_)),(i==null?void 0:i.id)===t&&v({...i,user_has_liked:g,like_count:j}),alert("Failed to update like. Please try again.")}},w=async t=>{if(!s)return;const r=m.find(g=>g.id===t);r&&(r.user_has_bookmarked?await c.from("bookmarks").delete().eq("poem_id",t).eq("user_id",s.id):await c.from("bookmarks").insert([{poem_id:t,user_id:s.id}]),U())},k=async t=>{if(!s||t===s.id)return;const r=m.find(g=>g.user_id===t);r&&(r.user_is_following?await c.from("follows").delete().eq("follower_id",s.id).eq("following_id",t):await c.from("follows").insert([{follower_id:s.id,following_id:t}]),U())},f=t=>{const r=new Date(t),j=Math.floor((new Date().getTime()-r.getTime())/(1e3*60*60));return j<1?"Just now":j<24?`${j}h ago`:j<48?"Yesterday":r.toLocaleDateString("en-US",{month:"short",day:"numeric"})},S=()=>{switch(P){case"active":return e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600 dark:text-green-400",children:[e.jsx(G,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"AI Security Guard: Active"}),e.jsx("span",{className:"sm:hidden",children:"Security Active"})]});case"inactive":return e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600 dark:text-red-400",children:[e.jsx(G,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"AI Security Guard: Inactive"}),e.jsx("span",{className:"sm:hidden",children:"Security Inactive"})]});case"checking":return e.jsxs("div",{className:"flex items-center gap-2 text-sm text-yellow-600 dark:text-yellow-400",children:[e.jsx(G,{size:18,className:"animate-pulse"}),e.jsx("span",{className:"hidden sm:inline",children:"AI Security Guard: Checking..."}),e.jsx("span",{className:"sm:hidden",children:"Checking..."})]});default:return null}};return e.jsxs("div",{className:"w-full h-full flex flex-col bg-gradient-to-b from-slate-50 via-white to-slate-50 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/80 dark:bg-slate-900/80 backdrop-blur-xl border-b border-slate-200 dark:border-slate-800",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-4 sm:py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-slate-900 to-slate-600 dark:from-white dark:to-slate-300 bg-clip-text text-transparent",children:"Poetry Feed"}),S()]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 hide-scrollbar",children:[e.jsxs("button",{onClick:()=>C("feed"),className:`flex items-center gap-2 px-4 sm:px-5 py-2.5 rounded-xl font-semibold whitespace-nowrap transition-all text-sm sm:text-base ${b==="feed"?"bg-gradient-to-r from-blue-600 to-cyan-600 text-white shadow-lg shadow-blue-500/30 scale-105":"bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 hover:scale-105"}`,children:[e.jsx(V,{size:18}),e.jsx("span",{children:"Feed"})]}),e.jsxs("button",{onClick:()=>C("contests"),className:`flex items-center gap-2 px-4 sm:px-5 py-2.5 rounded-xl font-semibold whitespace-nowrap transition-all text-sm sm:text-base ${b==="contests"?"bg-gradient-to-r from-amber-600 to-orange-600 text-white shadow-lg shadow-amber-500/30 scale-105":"bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 hover:scale-105"}`,children:[e.jsx(T,{size:18}),e.jsx("span",{children:"Contests"})]}),e.jsxs("button",{onClick:()=>C("trending"),className:`flex items-center gap-2 px-4 sm:px-5 py-2.5 rounded-xl font-semibold whitespace-nowrap transition-all text-sm sm:text-base ${b==="trending"?"bg-gradient-to-r from-rose-600 to-pink-600 text-white shadow-lg shadow-rose-500/30 scale-105":"bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 hover:scale-105"}`,children:[e.jsx(K,{size:18}),e.jsx("span",{children:"Trending"})]}),e.jsxs("button",{onClick:()=>C("following"),className:`flex items-center gap-2 px-4 sm:px-5 py-2.5 rounded-xl font-semibold whitespace-nowrap transition-all text-sm sm:text-base ${b==="following"?"bg-gradient-to-r from-emerald-600 to-teal-600 text-white shadow-lg shadow-emerald-500/30 scale-105":"bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 hover:scale-105"}`,children:[e.jsx(Q,{size:18}),e.jsx("span",{children:"Following"})]})]})]})}),b==="feed"&&e.jsx(me,{}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[p?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsxs("div",{className:"relative w-16 h-16",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-slate-200 dark:border-slate-700"}),e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-blue-600 border-t-transparent animate-spin"})]}),e.jsx("p",{className:"mt-4 text-slate-600 dark:text-slate-400 font-medium",children:"Loading feed..."})]}):b==="contests"?e.jsxs("div",{className:"max-w-5xl mx-auto p-4 sm:p-6 space-y-6",children:[x.map(t=>{const r=t.status==="active"?{bg:"bg-gradient-to-r from-emerald-500 to-teal-500",text:"text-white",badge:"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300"}:t.status==="voting"?{bg:"bg-gradient-to-r from-blue-500 to-cyan-500",text:"text-white",badge:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300"}:{bg:"bg-gradient-to-r from-slate-500 to-slate-600",text:"text-white",badge:"bg-slate-100 dark:bg-slate-900/30 text-slate-700 dark:text-slate-300"};return e.jsxs("div",{className:"group bg-white dark:bg-slate-900 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-800 overflow-hidden hover:shadow-2xl hover:scale-[1.02] transition-all duration-300",children:[e.jsx("div",{className:`h-2 ${r.bg}`}),e.jsxs("div",{className:"p-6 sm:p-8",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:`p-4 rounded-2xl ${r.bg} shadow-lg`,children:e.jsx(T,{className:"text-white",size:32})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-2xl sm:text-3xl font-bold text-slate-900 dark:text-white mb-3 leading-tight",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`px-4 py-1.5 rounded-full text-sm font-bold uppercase tracking-wide ${r.badge}`,children:t.status}),e.jsx("span",{className:"px-4 py-1.5 rounded-full text-sm font-semibold bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300",children:t.theme})]})]})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-6 leading-relaxed text-base sm:text-lg",children:t.description}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6 p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-semibold text-slate-500 dark:text-slate-400 mb-1",children:"Submissions Period"}),e.jsxs("span",{className:"text-slate-900 dark:text-white font-medium",children:[new Date(t.start_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})," - ",new Date(t.end_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-semibold text-slate-500 dark:text-slate-400 mb-1",children:"Voting Ends"}),e.jsx("span",{className:"text-slate-900 dark:text-white font-medium",children:new Date(t.voting_end_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]})]}),t.status==="active"&&e.jsxs("button",{className:`w-full px-6 py-4 ${r.bg} ${r.text} rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-3 group-hover:scale-105`,children:[e.jsx(T,{size:20}),"Submit Your Poem"]})]})]},t.id)}),x.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"p-6 bg-gradient-to-br from-amber-100 to-orange-100 dark:from-amber-900/30 dark:to-orange-900/30 rounded-3xl mb-6",children:e.jsx(T,{className:"text-amber-600 dark:text-amber-400",size:64})}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-2",children:"No Contests Available"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Check back soon for exciting poetry competitions"})]})]}):e.jsx("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 py-6 space-y-6 pb-24",children:m.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"p-6 bg-gradient-to-br from-blue-100 to-cyan-100 dark:from-blue-900/30 dark:to-cyan-900/30 rounded-3xl mb-6",children:e.jsx(V,{className:"text-blue-600 dark:text-blue-400",size:64})}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-2",children:b==="following"?"No Posts Yet":"No Poems Available"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:b==="following"?"Follow some poets to see their work here":"Be the first to share your poetry"})]}):m.map(t=>e.jsxs("article",{className:"group bg-white dark:bg-slate-900 rounded-2xl shadow-md border border-slate-200 dark:border-slate-800 overflow-hidden hover:shadow-xl hover:border-slate-300 dark:hover:border-slate-700 transition-all duration-300",children:[e.jsxs("div",{className:"p-5 sm:p-6 cursor-pointer",onClick:()=>v(t),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-11 h-11 sm:w-12 sm:h-12 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white font-bold text-base sm:text-lg shadow-lg",children:t.username.charAt(0).toUpperCase()}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-white dark:border-slate-900 rounded-full"})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-white text-sm sm:text-base truncate",children:t.username}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 font-medium",children:f(t.created_at)})]})]}),t.user_id!==(s==null?void 0:s.id)&&e.jsx("button",{onClick:r=>{r.stopPropagation(),k(t.user_id)},className:`flex items-center gap-2 px-3 sm:px-4 py-2 rounded-xl text-xs sm:text-sm font-bold transition-all touch-manipulation flex-shrink-0 ${t.user_is_following?"bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700":"bg-gradient-to-r from-blue-600 to-cyan-600 text-white shadow-lg shadow-blue-500/30 hover:shadow-xl hover:scale-105"}`,children:t.user_is_following?e.jsxs(e.Fragment,{children:[e.jsx(ce,{size:14}),e.jsx("span",{children:"Following"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:14}),e.jsx("span",{children:"Follow"})]})})]}),e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-slate-900 dark:text-white mb-3 leading-tight group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:t.title}),e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:e.jsx("p",{className:"whitespace-pre-wrap line-clamp-6 text-sm sm:text-base text-slate-600 dark:text-slate-300 leading-relaxed",children:t.content})})]}),e.jsxs("div",{className:"px-5 sm:px-6 pb-4 flex items-center gap-2 sm:gap-3 border-t border-slate-100 dark:border-slate-800 pt-4",children:[e.jsxs("button",{onClick:r=>{r.stopPropagation(),h(t.id)},className:`flex items-center gap-2 px-4 py-2.5 rounded-xl transition-all font-semibold ${t.user_has_liked?"text-rose-600 bg-rose-50 dark:bg-rose-950/30 hover:bg-rose-100 dark:hover:bg-rose-950/50 shadow-sm":"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-rose-600 dark:hover:text-rose-400"}`,children:[e.jsx(W,{size:18,className:`transition-all ${t.user_has_liked?"scale-110":""}`,fill:t.user_has_liked?"currentColor":"none"}),e.jsx("span",{className:"text-sm",children:t.like_count})]}),e.jsxs("button",{onClick:()=>v(t),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 transition-all font-semibold",children:[e.jsx(Y,{size:18}),e.jsx("span",{className:"text-sm",children:t.comment_count})]}),e.jsx("button",{onClick:r=>{r.stopPropagation(),w(t.id)},className:`flex items-center gap-2 transition-all ml-auto touch-manipulation px-4 py-2.5 rounded-xl font-semibold ${t.user_has_bookmarked?"text-amber-600 bg-amber-50 dark:bg-amber-950/30 hover:bg-amber-100 dark:hover:bg-amber-950/50 shadow-sm":"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-amber-600 dark:hover:text-amber-400"}`,children:t.user_has_bookmarked?e.jsx(ie,{size:18,fill:"currentColor"}):e.jsx(oe,{size:18})})]})]},t.id))}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 overflow-y-auto animate-in fade-in duration-200",children:e.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-3xl shadow-2xl max-w-3xl w-full my-8 border border-slate-200 dark:border-slate-800 animate-in zoom-in-95 duration-200",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-2 bg-gradient-to-r from-blue-600 via-cyan-600 to-teal-600 rounded-t-3xl"}),e.jsxs("div",{className:"flex items-start justify-between p-6 sm:p-8 border-b border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex-1 pr-4",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-slate-900 dark:text-white mb-2 leading-tight",children:i.title}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-white font-bold text-sm shadow",children:(i.username||"A").charAt(0).toUpperCase()}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300 text-sm sm:text-base font-semibold",children:i.username||"Anonymous"})]})]}),e.jsx("button",{onClick:()=>v(null),className:"flex-shrink-0 p-2 rounded-xl text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white transition-all","aria-label":"Close",children:e.jsx(I,{size:24})})]}),e.jsxs("div",{className:"p-6 sm:p-8 max-h-[60vh] overflow-y-auto",children:[e.jsx("div",{className:"prose dark:prose-invert max-w-none mb-8",children:e.jsx("p",{className:"whitespace-pre-wrap text-slate-700 dark:text-slate-200 text-base sm:text-lg leading-relaxed",children:i.content})}),e.jsx("div",{className:"flex items-center gap-3 pb-8 mb-8 border-b border-slate-200 dark:border-slate-800",children:e.jsxs("button",{onClick:()=>h(i.id),className:`flex items-center gap-2.5 px-5 py-3 rounded-xl font-bold transition-all ${i.user_has_liked?"bg-rose-50 text-rose-600 dark:bg-rose-950/30 hover:bg-rose-100 dark:hover:bg-rose-950/50 shadow-sm":"bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 hover:text-rose-600 dark:hover:text-rose-400"}`,children:[e.jsx(W,{size:20,className:`transition-all ${i.user_has_liked?"scale-110":""}`,fill:i.user_has_liked?"currentColor":"none"}),e.jsxs("span",{className:"text-sm sm:text-base",children:[i.like_count||0," ",(i.like_count||0)===1?"Like":"Likes"]})]})}),e.jsx(xe,{poemId:i.id})]})]})})})]})]})}export{_e as default};
