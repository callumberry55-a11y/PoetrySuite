import{u as _,r as s,s as n,j as e,n as y}from"./index-CGemffCt.js";import{P as S}from"./plus-zAg5GACl.js";import{S as P}from"./send-DpFuWiTj.js";function A(){const{user:i}=_(),[g,j]=s.useState([]),[l,v]=s.useState(null),[b,w]=s.useState([]),[d,f]=s.useState(""),[k,p]=s.useState(!1),[o,c]=s.useState({title:"",mode:"open",max_contributors:10}),m=s.useCallback(async()=>{const{data:t,error:a}=await n.from("collaborative_poems").select("*").eq("status","active").order("created_at",{ascending:!1});if(a){console.error("Error loading poems:",a);return}const x=await Promise.all((t||[]).map(async r=>{const{count:u}=await n.from("poem_collaborators").select("id",{count:"exact",head:!0}).eq("collaborative_poem_id",r.id);return{...r,contributor_count:u||0}}));j(x)},[]),h=s.useCallback(async t=>{const{data:a,error:x}=await n.from("poem_collaborators").select(`
        id,
        user_id,
        contribution,
        position,
        contributed_at,
        user_profiles!inner(username)
      `).eq("collaborative_poem_id",t).order("position",{ascending:!0});if(x){console.error("Error loading contributions:",x);return}w((a||[]).map(r=>{var u;return{id:r.id,user_id:r.user_id,username:((u=r.user_profiles[0])==null?void 0:u.username)||"Anonymous",contribution:r.contribution,position:r.position,contributed_at:r.contributed_at}}))},[]);s.useEffect(()=>{i&&m()},[i,m]),s.useEffect(()=>{l&&h(l)},[l,h]);const N=async()=>{if(!i||!o.title.trim())return;const{error:t}=await n.from("collaborative_poems").insert([{creator_id:i.id,...o,content:"",status:"active"}]);if(t){console.error("Error creating poem:",t),alert("Failed to create collaborative poem");return}p(!1),c({title:"",mode:"open",max_contributors:10}),m()},C=async()=>{if(!i||!l||!d.trim())return;const t=b.length+1,{error:a}=await n.from("poem_collaborators").insert([{collaborative_poem_id:l,user_id:i.id,contribution:d,position:t}]);if(a){console.error("Error adding contribution:",a),alert("Failed to add contribution");return}f(""),h(l),m()};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Collaborative Poems"}),e.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-colors",children:[e.jsx(S,{size:18}),"Start Collaboration"]})]}),k&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-4",children:"Start a Collaborative Poem"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:o.title,onChange:t=>c({...o,title:t.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white",placeholder:"Give your collaborative poem a title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Mode"}),e.jsxs("select",{value:o.mode,onChange:t=>c({...o,mode:t.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white",children:[e.jsx("option",{value:"open",children:"Open (everyone can see all contributions)"}),e.jsx("option",{value:"exquisite_corpse",children:"Exquisite Corpse (see only last line)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Max Contributors"}),e.jsx("input",{type:"number",value:o.max_contributors,onChange:t=>c({...o,max_contributors:parseInt(t.target.value)}),min:"2",max:"50",className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:N,className:"px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium",children:"Create"}),e.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-lg",children:"Cancel"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white mb-3",children:"Active Collaborations"}),g.length===0?e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"No active collaborations"}):e.jsx("div",{className:"space-y-2",children:g.map(t=>e.jsxs("button",{onClick:()=>v(t.id),className:`w-full text-left p-3 rounded-lg transition-colors ${l===t.id?"bg-purple-50 dark:bg-purple-900/20 border-2 border-purple-500":"bg-slate-50 dark:bg-slate-700 hover:bg-slate-100 dark:hover:bg-slate-600"}`,children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-white mb-1",children:t.title}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 dark:text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{size:12}),t.contributor_count,"/",t.max_contributors]}),e.jsx("span",{className:"capitalize",children:t.mode.replace("_"," ")})]})]},t.id))})]})}),e.jsx("div",{className:"lg:col-span-2",children:l?e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-4",children:"Contributions"}),e.jsx("div",{className:"space-y-4 mb-6",children:b.length===0?e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-center py-4",children:"Be the first to contribute!"}):b.map((t,a)=>e.jsxs("div",{className:"border-l-4 border-purple-500 pl-4 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-xs font-semibold text-purple-500",children:["#",a+1]}),e.jsx("span",{className:"text-sm font-medium text-slate-900 dark:text-white",children:t.username})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 font-serif",children:t.contribution})]},t.id))}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:[e.jsx("h4",{className:"font-semibold text-slate-900 dark:text-white mb-2",children:"Add Your Contribution"}),e.jsx("textarea",{value:d,onChange:t=>f(t.target.value),rows:3,className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white font-serif mb-2",placeholder:"Write your contribution..."}),e.jsxs("button",{onClick:C,disabled:!d.trim(),className:"flex items-center gap-2 px-4 py-2 bg-purple-500 hover:bg-purple-600 disabled:bg-slate-400 text-white rounded-lg font-medium transition-colors",children:[e.jsx(P,{size:16}),"Submit Contribution"]})]})]}):e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-6 text-center",children:e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Select a collaboration to view and contribute"})})})]})]})}export{A as default};
