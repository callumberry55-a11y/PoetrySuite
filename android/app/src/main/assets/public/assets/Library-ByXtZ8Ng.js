import{u as le,r,j as e,P as oe,X as W,s as y,S as H,T as ge,a as fe,B as G,R as ve,H as je,M as we,D as ke}from"./index-CGemffCt.js";import{F as X,a as Y}from"./folder-BASdsvlC.js";import{T as ie}from"./trash-2-CpZgBkr4.js";import{P as ye}from"./palette-B5Uz0oCf.js";import{S as Ne}from"./save-DRwAVCRA.js";import{g as Ce}from"./ai-DtILrpuj.js";import{S as V}from"./search-CC5W77On.js";import{M as Se}from"./mic-L0AUVI5v.js";import{C as ee}from"./clock-CH5mnwFd.js";import{S as te}from"./star-kPRirAjA.js";import{G as se}from"./globe-DrygjtXM.js";import{L as ae}from"./lock-Bpvz4WVX.js";import{T as Pe}from"./tag-CYV681ei.js";const U=[{name:"Blue",value:"from-blue-500 to-cyan-500",hex:"#3b82f6"},{name:"Purple",value:"from-purple-500 to-pink-500",hex:"#a855f7"},{name:"Green",value:"from-green-500 to-emerald-500",hex:"#10b981"},{name:"Orange",value:"from-orange-500 to-amber-500",hex:"#f97316"},{name:"Red",value:"from-red-500 to-rose-500",hex:"#ef4444"},{name:"Teal",value:"from-teal-500 to-cyan-500",hex:"#14b8a6"},{name:"Indigo",value:"from-indigo-500 to-violet-500",hex:"#6366f1"},{name:"Pink",value:"from-pink-500 to-fuchsia-500",hex:"#ec4899"}];function ze({collections:h,onCollectionChange:n,selectedCollection:w,onSelectCollection:F,poemCollections:P}){const{user:z}=le(),[L,f]=r.useState(!1),[_,m]=r.useState(null),[d,b]=r.useState({name:"",description:"",color:U[0].value}),[N,I]=r.useState(!1),$=h.map(s=>({...s,poem_count:Object.values(P).filter(u=>u.includes(s.id)).length})),C=()=>{m(null),b({name:"",description:"",color:U[0].value}),f(!0)},T=s=>{m(s),b({name:s.name,description:s.description||"",color:s.color}),f(!0)},k=()=>{f(!1),m(null),b({name:"",description:"",color:U[0].value})},D=async()=>{if(!(!z||!d.name.trim())){I(!0);try{if(_){const{error:s}=await y.from("collections").update({name:d.name,description:d.description,color:d.color}).eq("id",_.id);if(s)throw s}else{const{error:s}=await y.from("collections").insert({user_id:z.id,name:d.name,description:d.description,color:d.color});if(s)throw s}n(),k()}catch(s){console.error("Error saving collection:",s),alert("Failed to save collection")}finally{I(!1)}}},v=async s=>{if(confirm("Are you sure you want to delete this collection? Poems will not be deleted."))try{const{error:u}=await y.from("collections").delete().eq("id",s);if(u)throw u;w===s&&F(null),n()}catch(u){console.error("Error deleting collection:",u),alert("Failed to delete collection")}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"Collections"}),e.jsxs("button",{onClick:C,className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105",children:[e.jsx(X,{size:18}),"New Collection"]})]}),$.length===0?e.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-800 dark:to-slate-800/50 rounded-3xl border-2 border-dashed border-slate-300 dark:border-slate-600 p-8 text-center",children:[e.jsx(Y,{className:"w-12 h-12 mx-auto mb-3 text-slate-400"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"No collections yet. Create one to organize your poems!"}),e.jsxs("button",{onClick:C,className:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all",children:[e.jsx(X,{size:18}),"Create Your First Collection"]})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:$.map(s=>{const u=w===s.id;return e.jsxs("div",{className:`group bg-white dark:bg-slate-900 rounded-3xl shadow-lg border-2 transition-all duration-300 hover:shadow-2xl hover:scale-[1.02] cursor-pointer ${u?"border-blue-500 dark:border-blue-400 ring-2 ring-blue-500/20":"border-slate-200 dark:border-slate-800"}`,onClick:()=>F(u?null:s.id),children:[e.jsx("div",{className:`h-2 bg-gradient-to-r ${s.color} rounded-t-3xl`}),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`p-2.5 bg-gradient-to-r ${s.color} rounded-xl shadow-lg flex-shrink-0`,children:e.jsx(Y,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-base font-bold text-slate-900 dark:text-white truncate",children:s.name}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[s.poem_count," ",s.poem_count===1?"poem":"poems"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:M=>{M.stopPropagation(),T(s)},className:"p-1.5 rounded-lg bg-slate-100 dark:bg-slate-800 text-blue-600 dark:text-blue-400 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors","aria-label":`Edit ${s.name}`,children:e.jsx(oe,{size:14})}),e.jsx("button",{onClick:M=>{M.stopPropagation(),v(s.id)},className:"p-1.5 rounded-lg bg-slate-100 dark:bg-slate-800 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors","aria-label":`Delete ${s.name}`,children:e.jsx(ie,{size:14})})]})]}),s.description&&e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 line-clamp-2",children:s.description})]})]},s.id)})})]}),L&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-3xl shadow-2xl border-2 border-slate-200 dark:border-slate-800 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:`sticky top-0 bg-gradient-to-r ${d.color} p-6 rounded-t-3xl flex items-center justify-between`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-xl",children:e.jsx(Y,{className:"w-6 h-6 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-white",children:_?"Edit Collection":"Create Collection"})]}),e.jsx("button",{onClick:k,className:"p-2 hover:bg-white/20 rounded-xl transition-all",children:e.jsx(W,{className:"w-6 h-6 text-white"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"collection-name",className:"block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"Collection Name *"}),e.jsx("input",{id:"collection-name",type:"text",value:d.name,onChange:s=>b({...d,name:s.target.value}),placeholder:"e.g., Nature Poems, Love Letters, Haikus...",className:"w-full px-4 py-3 rounded-xl border-2 border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"collection-description",className:"block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"Description"}),e.jsx("textarea",{id:"collection-description",value:d.description,onChange:s=>b({...d,description:s.target.value}),placeholder:"Add a brief description of this collection...",rows:3,className:"w-full px-4 py-3 rounded-xl border-2 border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{size:16}),"Color Theme"]})}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:U.map(s=>{const u=d.color===s.value;return e.jsxs("button",{onClick:()=>b({...d,color:s.value}),className:`relative p-4 rounded-2xl transition-all duration-300 ${u?"ring-2 ring-offset-2 ring-blue-500 scale-105":"hover:scale-105"}`,children:[e.jsx("div",{className:`h-12 bg-gradient-to-r ${s.value} rounded-xl shadow-lg`}),e.jsx("p",{className:"text-xs font-medium text-slate-600 dark:text-slate-400 mt-2 text-center",children:s.name}),u&&e.jsx("div",{className:"absolute top-2 right-2 w-5 h-5 bg-white dark:bg-slate-900 rounded-full flex items-center justify-center shadow-lg",children:e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"})})]},s.value)})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:k,className:"flex-1 px-6 py-3 rounded-xl bg-slate-200 dark:bg-slate-800 text-slate-700 dark:text-slate-300 font-semibold hover:bg-slate-300 dark:hover:bg-slate-700 transition-all",children:"Cancel"}),e.jsx("button",{onClick:D,disabled:!d.name.trim()||N,className:"flex-1 flex items-center justify-center gap-2 px-6 py-3 rounded-xl bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-semibold shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{size:18}),_?"Update Collection":"Create Collection"]})})]})]})]})})]})}function re({value:h,onChange:n,onSearch:w,placeholder:F,poems:P=[],mode:z="library"}){const[L,f]=r.useState(!1),[_,m]=r.useState([]),[d,b]=r.useState(!1),[N,I]=r.useState(!1),[$,C]=r.useState([]),[T,k]=r.useState(!1),D=r.useRef(null),v=r.useRef(null);r.useEffect(()=>{const o=localStorage.getItem("recentSearches");o&&C(JSON.parse(o)),k(!0)},[]);const s=r.useCallback(async()=>{if(z==="library"&&P.length>0){const o=M(),x=P.slice(0,5).map(c=>c.title),j=[];if(N&&h.length>3)try{const c=await u(h);j.push(...c)}catch(c){console.error("AI suggestions failed:",c)}o.forEach(c=>{c.toLowerCase().includes(h.toLowerCase())&&j.push({type:"theme",text:c,icon:"ðŸŽ¨"})}),x.forEach(c=>{c.toLowerCase().includes(h.toLowerCase())&&j.push({type:"query",text:c,icon:"ðŸ“"})}),m(j.slice(0,5))}else if(z==="discover"){const o=[{type:"theme",text:"love poems",icon:"ðŸ’•"},{type:"theme",text:"nature poems",icon:"ðŸŒ¿"},{type:"theme",text:"haiku",icon:"ðŸŽ‹"},{type:"theme",text:"sonnets",icon:"ðŸ“œ"},{type:"theme",text:"free verse",icon:"âœ¨"}].filter(x=>x.text.toLowerCase().includes(h.toLowerCase()));m(o)}},[h,z,P,N]);r.useEffect(()=>{L&&h.length>0?s():m([])},[h,L,s]);const u=async o=>{const x=`Given the search query "${o}" for poetry, suggest 3 related search terms that would help find relevant poems. Return only the terms, one per line, no numbering or extra text.`;try{return(await Ce(x)).split(`
`).filter(g=>g.trim().length>0).slice(0,3).map(g=>({type:"query",text:g.trim(),icon:"âœ¨"}))}catch{return[]}},M=()=>{const o=["love","nature","life","death","time","hope","loss","joy","sadness","memory"],x=new Set;return P.forEach(j=>{const c=(j.title+" "+j.content).toLowerCase();o.forEach(g=>{c.includes(g)&&x.add(g.charAt(0).toUpperCase()+g.slice(1))})}),Array.from(x)},q=()=>{if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){alert("Voice search is not supported in your browser");return}const o=window.SpeechRecognition||window.webkitSpeechRecognition;v.current=new o,v.current.continuous=!1,v.current.interimResults=!1,v.current.onstart=()=>{b(!0)},v.current.onresult=x=>{const j=x.results[0][0].transcript;n(j),b(!1),setTimeout(()=>w(),100)},v.current.onerror=()=>{b(!1)},v.current.onend=()=>{b(!1)},v.current.start()},B=()=>{if(h.trim()){const o=[h,...$.filter(x=>x!==h)].slice(0,10);C(o),localStorage.setItem("recentSearches",JSON.stringify(o))}w(),f(!1)},R=o=>{n(o.text),setTimeout(()=>{w(),f(!1)},100)};return e.jsxs("div",{className:"relative w-full",children:[e.jsxs("div",{className:`relative flex items-center gap-1 sm:gap-2 transition-all duration-300 ${L?"ring-2 ring-blue-500 shadow-lg sm:scale-[1.02]":"ring-1 ring-slate-300 dark:ring-slate-600"} rounded-2xl sm:rounded-3xl bg-white dark:bg-slate-800`,children:[e.jsxs("div",{className:"absolute left-3 sm:left-4 flex items-center gap-1.5 sm:gap-2 pointer-events-none",children:[e.jsx(V,{className:"text-slate-400 flex-shrink-0",size:18}),N&&e.jsx(H,{className:"text-blue-500 animate-pulse flex-shrink-0",size:14})]}),e.jsx("input",{ref:D,type:"search",value:h,onChange:o=>n(o.target.value),onFocus:()=>f(!0),onBlur:()=>setTimeout(()=>f(!1),200),onKeyDown:o=>o.key==="Enter"&&B(),placeholder:F,className:"w-full pl-10 sm:pl-12 pr-[140px] sm:pr-40 py-3 sm:py-3.5 text-sm sm:text-base bg-transparent text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none"}),e.jsxs("div",{className:"absolute right-1 sm:right-2 flex items-center gap-0.5 sm:gap-1",children:[h&&e.jsx("button",{onClick:()=>n(""),className:"p-2 sm:p-2.5 rounded-lg sm:rounded-xl hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors min-w-[36px] min-h-[36px] flex items-center justify-center","aria-label":"Clear search",children:e.jsx(W,{size:16,className:"sm:w-[18px] sm:h-[18px]"})}),e.jsx("button",{onClick:()=>T&&I(!N),disabled:!T,className:`p-2 sm:p-2.5 rounded-lg sm:rounded-xl transition-all min-w-[36px] min-h-[36px] flex items-center justify-center ${N?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":T?"hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-400":"opacity-30 cursor-not-allowed text-slate-300"}`,"aria-label":`${N?"Disable":"Enable"} AI search`,title:T?"AI-powered search":"AI search unavailable - API key not configured",children:e.jsx(H,{size:16,className:"sm:w-[18px] sm:h-[18px]"})}),e.jsx("button",{onClick:q,disabled:d,className:`p-2 sm:p-2.5 rounded-lg sm:rounded-xl transition-all min-w-[36px] min-h-[36px] flex items-center justify-center ${d?"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 animate-pulse":"hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-400"}`,"aria-label":"Voice search",title:"Voice search",children:e.jsx(Se,{size:16,className:"sm:w-[18px] sm:h-[18px]"})}),e.jsxs("button",{onClick:B,className:"px-3 sm:px-4 py-2 sm:py-2.5 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white rounded-xl sm:rounded-2xl font-semibold shadow-md hover:shadow-lg transition-all text-xs sm:text-sm min-h-[36px] flex items-center justify-center",children:[e.jsx("span",{className:"hidden xs:inline",children:"Search"}),e.jsx(V,{size:16,className:"xs:hidden"})]})]})]}),L&&(_.length>0||$.length>0)&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white dark:bg-slate-800 rounded-2xl sm:rounded-3xl shadow-2xl border-2 border-slate-200 dark:border-slate-700 overflow-hidden z-50 animate-in fade-in slide-in-from-top-2 duration-200 max-h-[60vh] overflow-y-auto",children:[_.length>0&&e.jsxs("div",{className:"p-2 sm:p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 text-xs sm:text-sm font-semibold text-slate-500 dark:text-slate-400",children:[e.jsx(ge,{size:14,className:"sm:w-4 sm:h-4 flex-shrink-0"}),"Suggestions"]}),_.map((o,x)=>e.jsxs("button",{onClick:()=>R(o),className:"w-full flex items-center gap-2 sm:gap-3 px-3 py-3 sm:py-3.5 rounded-xl sm:rounded-2xl hover:bg-blue-50 dark:hover:bg-blue-900/20 text-left transition-colors group min-h-[44px] active:scale-95",children:[e.jsx("span",{className:"text-lg sm:text-xl flex-shrink-0",children:o.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm sm:text-base font-medium text-slate-900 dark:text-white truncate",children:o.text}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-500 dark:text-slate-400 capitalize",children:o.type})]}),e.jsx(V,{className:"text-slate-400 group-hover:text-blue-500 transition-colors flex-shrink-0",size:16})]},x))]}),$.length>0&&h.length===0&&e.jsxs("div",{className:"p-2 sm:p-3 border-t border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 text-xs sm:text-sm font-semibold text-slate-500 dark:text-slate-400",children:[e.jsx(ee,{size:14,className:"sm:w-4 sm:h-4 flex-shrink-0"}),"Recent Searches"]}),$.slice(0,5).map((o,x)=>e.jsxs("button",{onClick:()=>{n(o),setTimeout(()=>{w(),f(!1)},100)},className:"w-full flex items-center gap-2 sm:gap-3 px-3 py-3 sm:py-3.5 rounded-xl sm:rounded-2xl hover:bg-slate-50 dark:hover:bg-slate-700 text-left transition-colors group min-h-[44px] active:scale-95",children:[e.jsx(ee,{className:"text-slate-400 flex-shrink-0",size:16}),e.jsx("span",{className:"flex-1 text-sm sm:text-base text-slate-700 dark:text-slate-300 truncate",children:o}),e.jsx("button",{onClick:j=>{j.stopPropagation();const c=$.filter(g=>g!==o);C(c),localStorage.setItem("recentSearches",JSON.stringify(c))},className:"text-slate-400 hover:text-red-500 transition-colors opacity-0 group-hover:opacity-100 p-1 rounded min-w-[32px] min-h-[32px] flex items-center justify-center flex-shrink-0","aria-label":"Remove from recent searches",children:e.jsx(W,{size:14})})]},x))]})]})]})}function _e({onEditPoem:h}){const{user:n}=le(),w=fe(),[F,P]=r.useState([]),[z,L]=r.useState([]),[f,_]=r.useState(""),[m,d]=r.useState("all"),[b,N]=r.useState(null),[I,$]=r.useState(null),[C,T]=r.useState({}),[k,D]=r.useState("library"),[v,s]=r.useState([]),[u,M]=r.useState(!1),[q,B]=r.useState(""),[R,o]=r.useState(""),x=r.useCallback(async()=>{if(n)try{const{data:t,error:a}=await y.from("poems").select("*").eq("user_id",n.id).order("updated_at",{ascending:!1});if(a){console.error("Error loading poems:",a);return}if(!t||t.length===0){P([]);return}const l=t.map(S=>S.id),{data:i}=await y.from("reactions").select("poem_id").in("poem_id",l),{data:p}=await y.from("comments").select("poem_id").in("poem_id",l),E=new Map,A=new Map;i==null||i.forEach(S=>{E.set(S.poem_id,(E.get(S.poem_id)||0)+1)}),p==null||p.forEach(S=>{A.set(S.poem_id,(A.get(S.poem_id)||0)+1)});const O=t.map(S=>({...S,like_count:E.get(S.id)||0,comment_count:A.get(S.id)||0}));P(O)}catch(t){console.error("Error loading poems:",t),P([])}},[n]),j=r.useCallback(async()=>{if(!n)return;const{data:t,error:a}=await y.from("collections").select("*").eq("user_id",n.id).order("created_at",{ascending:!1});if(a){console.error("Error loading collections:",a);return}L(t||[])},[n]),c=r.useCallback(async()=>{if(!n)return;const{data:t,error:a}=await y.from("poem_collections").select("poem_id, collection_id");if(a){console.error("Error loading poem collections:",a);return}const l={};t==null||t.forEach(i=>{l[i.poem_id]||(l[i.poem_id]=[]),l[i.poem_id].push(i.collection_id)}),T(l)},[n]);r.useEffect(()=>{n&&(async()=>{try{await Promise.all([x(),j(),c()])}catch(a){console.error("Error loading library data:",a)}})()},[n]);const g=r.useCallback(async(t,a={})=>{if(n){M(!0);try{const i=`https://mablckeofkddwjgxhnbe.supabase.co/functions/v1/fetch-poems?${new URLSearchParams({action:t,...a})}`,p=await fetch(i,{headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1hYmxja2VvZmtkZHdqZ3hobmJlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyNDUxNTQsImV4cCI6MjA4MTgyMTE1NH0.mO0bo8MtAF4RJUrCqQLYfz-BFbH8eUj5WmhCT2-hn-c","Content-Type":"application/json"}});if(!p.ok)throw new Error("Failed to fetch poems");const E=await p.json();s(E.poems||[])}catch(l){console.error("Error fetching internet poems:",l),s([])}finally{M(!1)}}},[n]),J=r.useCallback(()=>{g("random",{count:"20"})},[g]),ne=r.useCallback(()=>{R?g("by_author",{author:R}):q?g("by_title",{title:q}):J()},[R,q,g,J]),[de,Q]=r.useState(new Set),[ce,K]=r.useState(new Set),me=r.useCallback(async(t,a)=>{if(!n){w.warning("Please sign in to save poems");return}const l=`${t.author}-${t.title}-${a}`;Q(i=>new Set(i).add(l));try{const i=t.lines.join(`
`),p=i.split(/\s+/).filter(A=>A.length>0).length,{error:E}=await y.from("poems").insert([{user_id:n.id,title:`${t.title} by ${t.author}`,content:i,is_public:!1,word_count:p,favorited:!1}]);if(E){console.error("Error saving poem:",E),E.code==="23505"?w.info("This poem is already in your library"):w.error(`Failed to save poem: ${E.message||"Unknown error"}`);return}w.success("Poem saved to your library!"),K(A=>new Set(A).add(l)),setTimeout(()=>{K(A=>{const O=new Set(A);return O.delete(l),O})},3e3),await x()}catch(i){console.error("Unexpected error saving poem:",i),w.error("An unexpected error occurred while saving the poem")}finally{Q(i=>{const p=new Set(i);return p.delete(l),p})}},[n,x]);r.useEffect(()=>{if(k==="discover"&&v.length===0&&!u){const t=setTimeout(()=>{J()},0);return()=>clearTimeout(t)}},[k,v.length,u,J]);const xe=r.useCallback(async(t,a)=>{const{error:l}=await y.from("poem_collections").insert([{poem_id:t,collection_id:a}]);if(l){console.error("Error adding poem to collection:",l);return}c()},[c]),he=r.useCallback(async(t,a)=>{const{error:l}=await y.from("poem_collections").delete().eq("poem_id",t).eq("collection_id",a);if(l){console.error("Error removing poem from collection:",l);return}c()},[c]),Z=r.useMemo(()=>{let t=[...F];if(f){const a=f.toLowerCase();t=t.filter(l=>l.title.toLowerCase().includes(a)||l.content.toLowerCase().includes(a))}return m==="favorites"?t=t.filter(a=>a.favorited):m==="public"?t=t.filter(a=>a.is_public):m==="private"&&(t=t.filter(a=>!a.is_public)),b&&(t=t.filter(a=>{var l;return(l=C[a.id])==null?void 0:l.includes(b)})),t},[F,f,m,b,C]),ue=r.useCallback(async t=>{if(!confirm("Are you sure you want to delete this poem?"))return;const{error:a}=await y.from("poems").delete().eq("id",t);if(a){console.error("Error deleting poem:",a);return}x()},[x]),pe=r.useCallback(t=>new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),[]),be=["William Shakespeare","Emily Dickinson","Walt Whitman","Robert Frost","Maya Angelou","Langston Hughes","Edgar Allan Poe","Pablo Neruda","Sylvia Plath","T. S. Eliot","William Wordsworth","John Keats"];return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4 sm:py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"mb-6",children:e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-slate-900 dark:text-white",children:k==="library"?"Your Library":"Discover Poems"})}),e.jsxs("div",{className:"inline-flex p-1 bg-slate-100 dark:bg-slate-800 rounded-xl mb-6",children:[e.jsxs("button",{onClick:()=>D("library"),className:`flex items-center gap-2 px-6 py-2.5 rounded-lg font-medium transition-all ${k==="library"?"bg-white dark:bg-slate-700 text-slate-900 dark:text-white shadow-sm":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(G,{size:18}),e.jsx("span",{children:"Your Poems"})]}),e.jsxs("button",{onClick:()=>D("discover"),className:`flex items-center gap-2 px-6 py-2.5 rounded-lg font-medium transition-all ${k==="discover"?"bg-white dark:bg-slate-700 text-slate-900 dark:text-white shadow-sm":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"}`,children:[e.jsx(H,{size:18}),e.jsx("span",{children:"Discover"})]})]}),k==="library"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsx(re,{value:f,onChange:_,onSearch:()=>{},placeholder:"Search your poems by title, content, or theme...",poems:F,mode:"library"})}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto mb-6 pb-2",role:"group","aria-label":"Filter poems",children:[e.jsx("button",{onClick:()=>d("all"),className:`px-4 py-2.5 rounded-xl font-semibold transition-all text-sm whitespace-nowrap ${m==="all"?"bg-gradient-to-r from-blue-500 to-cyan-500 text-white shadow-lg":"bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:bg-slate-300 dark:hover:bg-slate-600"}`,"aria-pressed":m==="all","aria-label":"Show all poems",children:"All Poems"}),e.jsxs("button",{onClick:()=>d("favorites"),className:`px-4 py-2.5 rounded-xl font-semibold transition-all flex items-center gap-2 text-sm whitespace-nowrap ${m==="favorites"?"bg-gradient-to-r from-amber-500 to-orange-500 text-white shadow-lg":"bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:bg-slate-300 dark:hover:bg-slate-600"}`,"aria-pressed":m==="favorites","aria-label":"Show favorite poems only",children:[e.jsx(te,{size:16,"aria-hidden":"true",fill:m==="favorites"?"currentColor":"none"}),e.jsx("span",{children:"Favorites"})]}),e.jsxs("button",{onClick:()=>d("public"),className:`px-4 py-2.5 rounded-xl font-semibold transition-all flex items-center gap-2 text-sm whitespace-nowrap ${m==="public"?"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-lg":"bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:bg-slate-300 dark:hover:bg-slate-600"}`,"aria-pressed":m==="public","aria-label":"Show public poems only",children:[e.jsx(se,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:"Public"})]}),e.jsxs("button",{onClick:()=>d("private"),className:`px-4 py-2.5 rounded-xl font-semibold transition-all flex items-center gap-2 text-sm whitespace-nowrap ${m==="private"?"bg-gradient-to-r from-slate-500 to-slate-600 text-white shadow-lg":"bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:bg-slate-300 dark:hover:bg-slate-600"}`,"aria-pressed":m==="private","aria-label":"Show private poems only",children:[e.jsx(ae,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:"Private"})]})]}),e.jsx(ze,{collections:z,onCollectionChange:j,selectedCollection:b,onSelectCollection:N,poemCollections:C})]}):e.jsxs("div",{className:"space-y-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(re,{value:q,onChange:B,onSearch:ne,placeholder:"Search poems by title, author, or theme...",mode:"discover"})}),e.jsxs("button",{onClick:J,disabled:u,className:"px-6 py-3 bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 disabled:from-slate-400 disabled:to-slate-400 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all disabled:cursor-not-allowed flex items-center gap-2 justify-center",children:[e.jsx(ve,{size:18}),"Random Poems"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-800 dark:to-slate-800/50 rounded-3xl p-6 border-2 border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("p",{className:"text-sm font-bold text-slate-700 dark:text-slate-300 flex items-center gap-2",children:[e.jsx(H,{size:16,className:"text-blue-500"}),"Popular Authors"]}),R&&e.jsxs("button",{onClick:()=>{o(""),J()},className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 flex items-center gap-1 font-semibold",children:[e.jsx(W,{size:14}),"Clear"]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:be.map(t=>e.jsx("button",{onClick:()=>{o(t),B(""),g("by_author",{author:t})},className:`px-4 py-2 rounded-xl text-sm font-semibold transition-all shadow-sm hover:shadow-md ${R===t?"bg-gradient-to-r from-blue-500 to-cyan-500 text-white scale-105":"bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-600"}`,children:t},t))})]})]})]}),k==="library"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",role:"list","aria-label":"Poem library",children:Z.length===0?e.jsx("div",{className:"col-span-full text-center py-12",role:"status",children:e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:f||m!=="all"?"No poems found matching your criteria":"No poems yet. Start writing!"})}):Z.map(t=>e.jsxs("article",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 overflow-hidden hover:border-slate-300 dark:hover:border-slate-600 transition-all hover:shadow-xl hover:-translate-y-1 group relative cursor-pointer",role:"listitem","aria-label":`Poem: ${t.title}`,onClick:()=>h(t.id),children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-500 via-cyan-500 to-teal-500"}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-2 line-clamp-2 group-hover:text-cyan-600 dark:group-hover:text-cyan-400 transition-colors",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[t.favorited&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded-full font-medium",children:[e.jsx(te,{size:12,fill:"currentColor","aria-hidden":"true"}),"Favorite"]}),t.is_public?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-full font-medium",children:[e.jsx(se,{size:12,"aria-hidden":"true"}),"Public"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 rounded-full font-medium",children:[e.jsx(ae,{size:12,"aria-hidden":"true"}),"Private"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 opacity-0 group-hover:opacity-100 transition-opacity",role:"group","aria-label":"Poem actions",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),h(t.id)},className:"p-2 rounded-lg bg-slate-100 dark:bg-slate-700 text-cyan-600 dark:text-cyan-400 hover:bg-cyan-100 dark:hover:bg-cyan-900/30 transition-colors","aria-label":`Edit ${t.title}`,children:e.jsx(oe,{size:16,"aria-hidden":"true"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),$(I===t.id?null:t.id)},className:"p-2 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors","aria-label":`${I===t.id?"Close":"Open"} collection menu for ${t.title}`,"aria-expanded":I===t.id,"aria-haspopup":"menu",children:e.jsx(Pe,{size:16,"aria-hidden":"true"})}),I===t.id&&e.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-slate-700 rounded-xl shadow-xl border border-slate-200 dark:border-slate-600 z-10",role:"menu","aria-label":"Collection menu",children:e.jsxs("div",{className:"p-2",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 px-2 py-1",children:"Add to Collection"}),z.length===0?e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 px-2 py-2",children:"No collections yet"}):z.map(a=>{var i;const l=(i=C[t.id])==null?void 0:i.includes(a.id);return e.jsx("button",{onClick:p=>{p.stopPropagation(),l?he(t.id,a.id):xe(t.id,a.id)},className:`w-full text-left px-2 py-1.5 rounded-lg text-sm transition-colors ${l?"bg-cyan-100 dark:bg-cyan-900/30 text-cyan-700 dark:text-cyan-300":"hover:bg-slate-100 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300"}`,role:"menuitem","aria-label":`${l?"Remove from":"Add to"} collection: ${a.name}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{size:14,"aria-hidden":"true"}),e.jsx("span",{children:a.name})]})},a.id)})]})})]}),e.jsx("button",{onClick:a=>{a.stopPropagation(),ue(t.id)},className:"p-2 rounded-lg bg-slate-100 dark:bg-slate-700 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors","aria-label":`Delete ${t.title}`,children:e.jsx(ie,{size:16,"aria-hidden":"true"})})]})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 text-sm leading-relaxed line-clamp-4 mb-6 font-serif",children:t.content||"No content yet..."}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-sm text-slate-500 dark:text-slate-400",children:[e.jsx(je,{size:16,className:"text-rose-500","aria-hidden":"true"}),e.jsx("span",{className:"font-medium",children:t.like_count||0})]}),e.jsxs("span",{className:"flex items-center gap-1.5 text-sm text-slate-500 dark:text-slate-400",children:[e.jsx(we,{size:16,className:"text-blue-500","aria-hidden":"true"}),e.jsx("span",{className:"font-medium",children:t.comment_count||0})]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-500 dark:text-slate-400",children:[e.jsxs("span",{className:"font-medium",children:[t.word_count," words"]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:pe(t.created_at)})]})]})]})]},t.id))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u?e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center",children:e.jsx("div",{className:"text-6xl animate-walk",children:"ðŸ¦"})}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-4",children:"Loading poems..."}),e.jsx("style",{children:`
                @keyframes walk {
                  0%, 100% { transform: translateY(0px) rotate(-5deg); }
                  25% { transform: translateY(-8px) rotate(0deg); }
                  50% { transform: translateY(0px) rotate(5deg); }
                  75% { transform: translateY(-8px) rotate(0deg); }
                }
                .animate-walk {
                  animation: walk 0.6s ease-in-out infinite;
                }
              `})]}):v.length===0?e.jsx("div",{className:"col-span-full text-center py-12",children:e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"No poems found. Try searching or loading random poems."})}):v.map((t,a)=>{const l=`${t.author}-${t.title}-${a}`,i=de.has(l),p=ce.has(l);return e.jsxs("article",{className:"bg-white dark:bg-slate-800 rounded-2xl border-2 border-slate-200 dark:border-slate-700 overflow-hidden hover:border-emerald-300 dark:hover:border-emerald-600 transition-all hover:shadow-xl hover:-translate-y-1 group relative",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-2 bg-gradient-to-r from-emerald-500 via-teal-500 to-cyan-500"}),e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsx("div",{className:"flex items-start justify-between gap-3 mb-4",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-slate-900 dark:text-white mb-2 line-clamp-2 group-hover:text-emerald-600 dark:group-hover:text-emerald-400 transition-colors",children:t.title}),e.jsxs("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-400 flex items-center gap-1.5",children:[e.jsx("span",{className:"text-slate-400",children:"by"})," ",t.author]})]})}),e.jsxs("p",{className:"text-slate-600 dark:text-slate-400 text-sm sm:text-base leading-relaxed line-clamp-6 mb-4 sm:mb-6 font-serif whitespace-pre-wrap",children:[t.lines.slice(0,8).join(`
`),t.lines.length>8&&`
...`]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t-2 border-slate-100 dark:border-slate-700 gap-3",children:[e.jsxs("span",{className:"text-xs sm:text-sm font-medium text-slate-500 dark:text-slate-400 flex items-center gap-1.5",children:[e.jsx(G,{size:14,className:"flex-shrink-0"}),t.linecount," lines"]}),e.jsx("button",{onClick:()=>me(t,a),disabled:i||p,className:`inline-flex items-center justify-center gap-2 px-3 sm:px-4 py-2 sm:py-2.5 rounded-xl font-semibold transition-all text-xs sm:text-sm shadow-md hover:shadow-lg min-h-[44px] ${p?"bg-gradient-to-r from-green-500 to-emerald-500 text-white scale-105":i?"bg-slate-300 dark:bg-slate-600 text-slate-500 dark:text-slate-400 cursor-wait":"bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white hover:scale-105 active:scale-95"} disabled:cursor-not-allowed`,"aria-label":`Save ${t.title} to your library`,children:p?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"hidden xs:inline",children:"Saved!"})]}):i?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"hidden xs:inline",children:"Saving..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{size:16,className:"sm:w-[18px] sm:h-[18px]"}),e.jsx("span",{children:"Save"})]})})]})]})]},l)})})]})}const Oe=r.memo(_e);export{Oe as default};
