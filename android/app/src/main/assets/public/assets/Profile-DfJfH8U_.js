import{u as E,r as l,s as x,j as e,X as P,a as z,A as q}from"./index-2dP_p1EG.js";import{M as F}from"./map-pin-DqGyWG48.js";import{P as A}from"./pen-DE5Ia22-.js";import{S as B}from"./save-BPjY8eN7.js";import{C as L}from"./coins-XiO7lNo2.js";import{G as W}from"./globe-CAKprFxp.js";function T(){const{user:s}=E(),[a,b]=l.useState(null),[m,v]=l.useState([]),[p,N]=l.useState(null),[h,u]=l.useState(!1),[o,n]=l.useState({}),[y,_]=l.useState(0),[C,g]=l.useState(!1),f=l.useCallback(async()=>{var i;if(!s)return;const t=((i=s.email)==null?void 0:i.split("@")[0])||"user",r={user_id:s.id,username:t,bio:"",avatar_url:"",location:"",website:"",favorite_forms:[],writing_style:"",follower_count:0,following_count:0,total_likes_received:0,is_editor:!1,is_mentor:!1},{error:d}=await x.from("user_profiles").insert(r);if(d){console.error("Error creating profile:",d),g(!0);return}},[s]),c=l.useCallback(async()=>{if(!s)return;g(!1);const{data:t,error:r}=await x.from("user_profiles").select("*").eq("user_id",s.id).maybeSingle();if(r){console.error("Error loading profile:",r),g(!0);return}if(!t){await f();const{data:d}=await x.from("user_profiles").select("*").eq("user_id",s.id).maybeSingle();d&&(b(d),n(d));return}b(t),n(t)},[s,f]),j=l.useCallback(async()=>{if(!s)return;const{data:t,error:r}=await x.from("user_badges").select(`
        id,
        earned_at,
        badges (
          name,
          description,
          icon,
          rank,
          points
        )
      `).eq("user_id",s.id);if(r){console.error("Error loading badges:",r);return}const d=t.map(i=>({id:i.id,name:i.badges.name,description:i.badges.description,icon:i.badges.icon,rank:i.badges.rank,points:i.badges.points,earned_at:i.earned_at}));v(d)},[s]),k=l.useCallback(async()=>{if(!s)return;const{data:t,error:r}=await x.from("writing_streaks").select("*").eq("user_id",s.id).maybeSingle();if(r){console.error("Error loading streak:",r);return}N(t)},[s]),w=l.useCallback(async()=>{if(!s)return;const{count:t,error:r}=await x.from("poems").select("id",{count:"exact",head:!0}).eq("user_id",s.id);if(r){console.error("Error loading poem count:",r);return}_(t||0)},[s]);l.useEffect(()=>{s&&(c(),j(),k(),w())},[s,c,j,k,w]);const S=async()=>{if(!s)return;const{error:t}=await x.from("user_profiles").update(o).eq("user_id",s.id);if(t){console.error("Error saving profile:",t),alert("Failed to save profile");return}u(!1),c()};return C?e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 sm:p-6 text-center",children:[e.jsx("p",{className:"text-red-800 dark:text-red-200 mb-4",children:"Unable to load your profile. Please try refreshing the page."}),e.jsx("button",{onClick:c,className:"px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg transition-colors",children:"Retry"})]})}):a?e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-4 sm:py-8 pb-24",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4 sm:p-6 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between mb-6 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-gradient-to-br from-purple-500 to-violet-600 flex items-center justify-center text-white text-xl sm:text-2xl font-bold flex-shrink-0",children:a.username.charAt(0).toUpperCase()}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-slate-900 dark:text-white truncate",children:a.username}),a.location&&e.jsxs("div",{className:"flex items-center gap-1 text-slate-600 dark:text-slate-400 mt-1",children:[e.jsx(F,{size:14}),e.jsx("span",{className:"text-sm truncate",children:a.location})]})]})]}),h?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:S,className:"flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white rounded-lg transition-colors touch-manipulation",children:[e.jsx(B,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Save"})]}),e.jsxs("button",{onClick:()=>{u(!1),n(a)},className:"flex items-center gap-2 px-4 py-2 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-lg transition-colors touch-manipulation",children:[e.jsx(P,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Cancel"})]})]}):e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center justify-center gap-2 px-4 py-2 bg-purple-500 hover:bg-purple-600 active:bg-purple-700 text-white rounded-lg transition-colors touch-manipulation whitespace-nowrap",children:[e.jsx(A,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Edit Profile"}),e.jsx("span",{className:"sm:hidden",children:"Edit"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3 sm:gap-4 mb-6",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700 rounded-lg p-3 sm:p-4 text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-purple-500",children:y}),e.jsx("div",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:"Poems"})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700 rounded-lg p-3 sm:p-4 text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-green-500",children:a.follower_count}),e.jsx("div",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:"Followers"})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700 rounded-lg p-3 sm:p-4 text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-cyan-500",children:a.following_count}),e.jsx("div",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:"Following"})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700 rounded-lg p-3 sm:p-4 text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-violet-500",children:a.total_likes_received}),e.jsx("div",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:"Likes"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 rounded-lg p-3 sm:p-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx(L,{size:16,className:"text-yellow-600 dark:text-yellow-400"}),e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:a.points_balance||0})]}),e.jsx("div",{className:"text-xs sm:text-sm text-yellow-700 dark:text-yellow-300",children:"Points"})]})]}),h?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Bio"}),e.jsx("textarea",{value:o.bio||"",onChange:t=>n({...o,bio:t.target.value}),rows:3,className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white",placeholder:"Tell us about yourself..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Location"}),e.jsx("input",{type:"text",value:o.location||"",onChange:t=>n({...o,location:t.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white",placeholder:"City, Country"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Website"}),e.jsx("input",{type:"url",value:o.website||"",onChange:t=>n({...o,website:t.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white",placeholder:"https://example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Writing Style"}),e.jsx("textarea",{value:o.writing_style||"",onChange:t=>n({...o,writing_style:t.target.value}),rows:2,className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white",placeholder:"Describe your writing style..."})]})]}):e.jsxs("div",{className:"space-y-4",children:[a.bio&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"About"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:a.bio})]}),a.website&&e.jsxs("div",{className:"flex items-center gap-2 text-cyan-500",children:[e.jsx(W,{size:16}),e.jsx("a",{href:a.website,target:"_blank",rel:"noopener noreferrer",className:"hover:underline",children:a.website})]}),a.writing_style&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Writing Style"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:a.writing_style})]})]})]}),p&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4 sm:p-6 mb-4 sm:mb-6",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold text-slate-900 dark:text-white mb-3 sm:mb-4 flex items-center gap-2",children:[e.jsx(z,{className:"text-orange-500",size:18}),"Writing Streak"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-lg p-3 sm:p-4",children:[e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-orange-600 dark:text-orange-400",children:p.current_streak}),e.jsx("div",{className:"text-xs sm:text-sm text-orange-700 dark:text-orange-300",children:"Current Streak"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-violet-100 dark:from-purple-900/20 dark:to-violet-800/20 rounded-lg p-3 sm:p-4",children:[e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-purple-600 dark:text-purple-400",children:p.longest_streak}),e.jsx("div",{className:"text-xs sm:text-sm text-purple-700 dark:text-purple-300",children:"Longest Streak"})]})]})]}),m.length>0&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4 sm:p-6",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold text-slate-900 dark:text-white mb-3 sm:mb-4 flex items-center gap-2",children:[e.jsx(q,{className:"text-yellow-500",size:18}),"Badges (",m.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4",children:m.map(t=>e.jsxs("div",{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 rounded-lg p-3 sm:p-4 text-center",children:[e.jsx("div",{className:"text-2xl sm:text-3xl mb-2",children:t.icon==="award"?"üèÜ":t.icon==="flame"?"üî•":t.icon==="heart"?"‚ù§Ô∏è":"üéñÔ∏è"}),e.jsx("div",{className:"font-semibold text-slate-900 dark:text-white text-xs sm:text-sm",children:t.name}),e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400 mt-1 line-clamp-2",children:t.description}),t.rank&&e.jsxs("div",{className:"mt-2 text-xs font-medium text-yellow-700 dark:text-yellow-300",children:[t.rank," ‚Ä¢ ",t.points," pts"]})]},t.id))})]})]}):e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"}),e.jsx("p",{className:"mt-4 text-slate-600 dark:text-slate-400",children:"Loading your profile..."})]})})}export{T as default};
