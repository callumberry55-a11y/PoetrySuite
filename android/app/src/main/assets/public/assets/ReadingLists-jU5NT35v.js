import{u as se,r as n,s as c,j as e,x as _,X as j,B as O}from"./index-CGemffCt.js";import{P as G}from"./plus-zAg5GACl.js";import{S as te}from"./search-CC5W77On.js";import{G as N}from"./globe-DrygjtXM.js";import{L as y}from"./lock-Bpvz4WVX.js";import{P as B}from"./pen-HIgjliAM.js";import{T as L}from"./trash-2-CpZgBkr4.js";import{G as ae}from"./grip-vertical-oymGv2OX.js";function xe(){const{user:i}=se(),[w,I]=n.useState([]),[t,h]=n.useState(null),[b,W]=n.useState([]),[z,U]=n.useState([]),[V,P]=n.useState(!0),[m,X]=n.useState(""),[H,u]=n.useState(!1),[J,f]=n.useState(!1),[K,k]=n.useState(!1),[v,S]=n.useState(""),[A,M]=n.useState(""),[p,E]=n.useState(!1),[r,l]=n.useState(null);n.useEffect(()=>{x()},[i==null?void 0:i.id]),n.useEffect(()=>{t&&C(t.id)},[t]);const x=async()=>{if(!(i!=null&&i.id))return;P(!0);const{data:s,error:a}=await c.from("reading_lists").select(`
        *,
        reading_list_items (count)
      `).eq("user_id",i.id).order("created_at",{ascending:!1});if(!a&&s){const o=s.map(d=>{var g,F;return{...d,poem_count:((F=(g=d.reading_list_items)==null?void 0:g[0])==null?void 0:F.count)||0}});I(o)}P(!1)},C=async s=>{const{data:a,error:o}=await c.from("reading_list_items").select(`
        *,
        poem:poems (
          id,
          title,
          content,
          created_at
        )
      `).eq("reading_list_id",s).order("position",{ascending:!0});!o&&a&&W(a)},Q=async()=>{if(!(i!=null&&i.id))return;const{data:s,error:a}=await c.from("poems").select("id, title, content, created_at").eq("user_id",i.id).order("created_at",{ascending:!1});!a&&s&&U(s)},Y=async()=>{if(!(i!=null&&i.id)||!v.trim())return;const{error:s}=await c.from("reading_lists").insert({user_id:i.id,name:v.trim(),description:A.trim(),is_public:p});s||(S(""),M(""),E(!1),u(!1),x())},Z=async()=>{if(!r)return;const{error:s}=await c.from("reading_lists").update({name:r.name,description:r.description,is_public:r.is_public}).eq("id",r.id);s||(f(!1),l(null),x(),(t==null?void 0:t.id)===r.id&&h(r))},R=async s=>{if(!confirm("Are you sure you want to delete this reading list?"))return;const{error:a}=await c.from("reading_lists").delete().eq("id",s);a||((t==null?void 0:t.id)===s&&h(null),x())},$=async s=>{if(!t)return;const a=b.reduce((d,g)=>Math.max(d,g.position),-1),{error:o}=await c.from("reading_list_items").insert({reading_list_id:t.id,poem_id:s,position:a+1});o||(C(t.id),x())},ee=async s=>{const{error:a}=await c.from("reading_list_items").delete().eq("id",s);!a&&t&&(C(t.id),x())},q=()=>{Q(),k(!0)},T=w.filter(s=>s.name.toLowerCase().includes(m.toLowerCase())||s.description.toLowerCase().includes(m.toLowerCase())),D=z.filter(s=>!b.some(a=>a.poem_id===s.id));return V?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"h-full flex flex-col bg-background",children:[e.jsx("div",{className:"bg-surface border-b border-outline/20 p-4 sm:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-primary/10 rounded-xl",children:e.jsx(_,{className:"w-6 h-6 sm:w-7 sm:h-7 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-on-surface",children:"Reading Lists"}),e.jsxs("p",{className:"text-sm text-on-surface-variant mt-0.5",children:[w.length," ",w.length===1?"list":"lists"]})]})]}),e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-primary text-on-primary rounded-xl hover:bg-primary/90 transition-all duration-200 font-medium shadow-sm hover:shadow-md",children:[e.jsx(G,{size:20}),e.jsx("span",{className:"hidden sm:inline",children:"New List"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-on-surface-variant w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search reading lists...",value:m,onChange:s=>X(s.target.value),className:"w-full pl-11 pr-4 py-3 bg-surface-variant/30 border border-outline/20 rounded-xl text-on-surface placeholder:text-on-surface-variant focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all"})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{className:"h-full max-w-7xl mx-auto p-4 sm:p-6",children:t?e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("button",{onClick:()=>h(null),className:"p-2 hover:bg-surface-variant/50 rounded-lg transition-colors flex-shrink-0",children:e.jsx(j,{size:20,className:"text-on-surface-variant"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h2",{className:"text-xl font-bold text-on-surface truncate",children:t.name}),t.is_public?e.jsx(N,{size:16,className:"text-primary flex-shrink-0"}):e.jsx(y,{size:16,className:"text-on-surface-variant flex-shrink-0"})]}),t.description&&e.jsx("p",{className:"text-sm text-on-surface-variant line-clamp-1",children:t.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("button",{onClick:q,className:"flex items-center gap-2 px-3 py-2 bg-primary/10 text-primary rounded-lg hover:bg-primary/20 transition-colors text-sm font-medium",children:[e.jsx(G,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Add Poems"})]}),e.jsx("button",{onClick:()=>{l(t),f(!0)},className:"p-2 hover:bg-surface-variant/50 rounded-lg transition-colors",children:e.jsx(B,{size:18,className:"text-on-surface-variant"})}),e.jsx("button",{onClick:()=>R(t.id),className:"p-2 hover:bg-error/10 rounded-lg transition-colors",children:e.jsx(L,{size:18,className:"text-error"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:b.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[e.jsx(O,{className:"w-16 h-16 text-on-surface-variant/30 mb-4"}),e.jsx("p",{className:"text-on-surface-variant text-lg mb-2",children:"No poems yet"}),e.jsx("p",{className:"text-sm text-on-surface-variant/70 mb-4",children:"Add poems to start building your reading list"}),e.jsx("button",{onClick:q,className:"px-4 py-2 bg-primary text-on-primary rounded-lg hover:bg-primary/90 transition-colors",children:"Add Poems"})]}):e.jsx("div",{className:"space-y-3",children:b.map((s,a)=>{var o,d;return e.jsx("div",{className:"bg-surface border border-outline/20 rounded-xl p-4 hover:border-primary/30 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(ae,{size:18,className:"text-on-surface-variant/40"}),e.jsx("span",{className:"text-sm font-semibold text-on-surface-variant/60 w-6",children:a+1})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-on-surface mb-1 line-clamp-1",children:((o=s.poem)==null?void 0:o.title)||"Untitled"}),e.jsx("p",{className:"text-sm text-on-surface-variant line-clamp-2",children:((d=s.poem)==null?void 0:d.content)||"No content"})]}),e.jsx("button",{onClick:()=>ee(s.id),className:"p-2 opacity-0 group-hover:opacity-100 hover:bg-error/10 rounded-lg transition-all flex-shrink-0",children:e.jsx(L,{size:16,className:"text-error"})})]})},s.id)})})})]}):e.jsx("div",{children:T.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[e.jsx(_,{className:"w-16 h-16 text-on-surface-variant/30 mb-4"}),e.jsx("p",{className:"text-on-surface-variant text-lg mb-2",children:m?"No lists found":"No reading lists yet"}),e.jsx("p",{className:"text-sm text-on-surface-variant/70 mb-4",children:m?"Try a different search term":"Create your first reading list to organize your favorite poems"}),!m&&e.jsx("button",{onClick:()=>u(!0),className:"px-4 py-2 bg-primary text-on-primary rounded-lg hover:bg-primary/90 transition-colors",children:"Create Reading List"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:T.map(s=>e.jsxs("div",{className:"bg-surface border border-outline/20 rounded-xl p-5 hover:border-primary/30 hover:shadow-lg transition-all duration-200 cursor-pointer group",onClick:()=>h(s),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(_,{size:20,className:"text-primary flex-shrink-0"}),e.jsx("h3",{className:"font-bold text-on-surface truncate group-hover:text-primary transition-colors",children:s.name})]}),s.is_public?e.jsx(N,{size:16,className:"text-primary flex-shrink-0"}):e.jsx(y,{size:16,className:"text-on-surface-variant flex-shrink-0"})]}),s.description&&e.jsx("p",{className:"text-sm text-on-surface-variant mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-outline/10",children:[e.jsxs("span",{className:"text-xs text-on-surface-variant",children:[s.poem_count||0," ",s.poem_count===1?"poem":"poems"]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),l(s),f(!0)},className:"p-1.5 hover:bg-surface-variant/50 rounded transition-colors",children:e.jsx(B,{size:14,className:"text-on-surface-variant"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),R(s.id)},className:"p-1.5 hover:bg-error/10 rounded transition-colors",children:e.jsx(L,{size:14,className:"text-error"})})]})]})]},s.id))})})})}),H&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-surface rounded-2xl shadow-2xl max-w-md w-full p-6 slide-up",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-on-surface",children:"Create Reading List"}),e.jsx("button",{onClick:()=>u(!1),className:"p-2 hover:bg-surface-variant/50 rounded-lg transition-colors",children:e.jsx(j,{size:20,className:"text-on-surface-variant"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-on-surface mb-2",children:"List Name"}),e.jsx("input",{type:"text",value:v,onChange:s=>S(s.target.value),placeholder:"e.g., Summer Poetry, Love Poems...",className:"w-full px-4 py-2.5 bg-surface-variant/30 border border-outline/20 rounded-xl text-on-surface placeholder:text-on-surface-variant focus:outline-none focus:ring-2 focus:ring-primary/50",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-on-surface mb-2",children:"Description (Optional)"}),e.jsx("textarea",{value:A,onChange:s=>M(s.target.value),placeholder:"What's this list about?",rows:3,className:"w-full px-4 py-2.5 bg-surface-variant/30 border border-outline/20 rounded-xl text-on-surface placeholder:text-on-surface-variant focus:outline-none focus:ring-2 focus:ring-primary/50 resize-none"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-surface-variant/20 rounded-xl",children:[e.jsx("input",{type:"checkbox",id:"public-list",checked:p,onChange:s=>E(s.target.checked),className:"w-5 h-5 rounded border-outline/30 text-primary focus:ring-2 focus:ring-primary/50"}),e.jsxs("label",{htmlFor:"public-list",className:"flex-1 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-on-surface",children:[p?e.jsx(N,{size:16}):e.jsx(y,{size:16}),e.jsxs("span",{children:["Make this list ",p?"public":"private"]})]}),e.jsx("p",{className:"text-xs text-on-surface-variant mt-0.5",children:p?"Anyone can view this list":"Only you can see this list"})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>u(!1),className:"flex-1 px-4 py-2.5 bg-surface-variant/50 text-on-surface rounded-xl hover:bg-surface-variant transition-colors font-medium",children:"Cancel"}),e.jsx("button",{onClick:Y,disabled:!v.trim(),className:"flex-1 px-4 py-2.5 bg-primary text-on-primary rounded-xl hover:bg-primary/90 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"Create List"})]})]})}),J&&r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-surface rounded-2xl shadow-2xl max-w-md w-full p-6 slide-up",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-on-surface",children:"Edit Reading List"}),e.jsx("button",{onClick:()=>{f(!1),l(null)},className:"p-2 hover:bg-surface-variant/50 rounded-lg transition-colors",children:e.jsx(j,{size:20,className:"text-on-surface-variant"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-on-surface mb-2",children:"List Name"}),e.jsx("input",{type:"text",value:r.name,onChange:s=>l({...r,name:s.target.value}),className:"w-full px-4 py-2.5 bg-surface-variant/30 border border-outline/20 rounded-xl text-on-surface focus:outline-none focus:ring-2 focus:ring-primary/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-on-surface mb-2",children:"Description (Optional)"}),e.jsx("textarea",{value:r.description,onChange:s=>l({...r,description:s.target.value}),rows:3,className:"w-full px-4 py-2.5 bg-surface-variant/30 border border-outline/20 rounded-xl text-on-surface focus:outline-none focus:ring-2 focus:ring-primary/50 resize-none"})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-surface-variant/20 rounded-xl",children:[e.jsx("input",{type:"checkbox",id:"edit-public-list",checked:r.is_public,onChange:s=>l({...r,is_public:s.target.checked}),className:"w-5 h-5 rounded border-outline/30 text-primary focus:ring-2 focus:ring-primary/50"}),e.jsxs("label",{htmlFor:"edit-public-list",className:"flex-1 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-on-surface",children:[r.is_public?e.jsx(N,{size:16}):e.jsx(y,{size:16}),e.jsxs("span",{children:["Make this list ",r.is_public?"public":"private"]})]}),e.jsx("p",{className:"text-xs text-on-surface-variant mt-0.5",children:r.is_public?"Anyone can view this list":"Only you can see this list"})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{f(!1),l(null)},className:"flex-1 px-4 py-2.5 bg-surface-variant/50 text-on-surface rounded-xl hover:bg-surface-variant transition-colors font-medium",children:"Cancel"}),e.jsx("button",{onClick:Z,disabled:!r.name.trim(),className:"flex-1 px-4 py-2.5 bg-primary text-on-primary rounded-xl hover:bg-primary/90 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"Save Changes"})]})]})}),K&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-surface rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] flex flex-col slide-up",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-outline/20",children:[e.jsx("h2",{className:"text-2xl font-bold text-on-surface",children:"Add Poems"}),e.jsx("button",{onClick:()=>k(!1),className:"p-2 hover:bg-surface-variant/50 rounded-lg transition-colors",children:e.jsx(j,{size:20,className:"text-on-surface-variant"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:D.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(O,{className:"w-16 h-16 text-on-surface-variant/30 mx-auto mb-4"}),e.jsx("p",{className:"text-on-surface-variant",children:z.length===0?"No poems available. Create some poems first!":"All your poems are already in this list!"})]}):e.jsx("div",{className:"space-y-3",children:D.map(s=>e.jsx("div",{className:"bg-surface-variant/30 border border-outline/20 rounded-xl p-4 hover:border-primary/30 transition-all duration-200 group",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-on-surface mb-1 line-clamp-1",children:s.title}),e.jsx("p",{className:"text-sm text-on-surface-variant line-clamp-2",children:s.content})]}),e.jsx("button",{onClick:()=>$(s.id),className:"px-3 py-1.5 bg-primary/10 text-primary rounded-lg hover:bg-primary hover:text-on-primary transition-all text-sm font-medium flex-shrink-0",children:"Add"})]})},s.id))})}),e.jsx("div",{className:"p-6 border-t border-outline/20",children:e.jsx("button",{onClick:()=>k(!1),className:"w-full px-4 py-2.5 bg-surface-variant/50 text-on-surface rounded-xl hover:bg-surface-variant transition-colors font-medium",children:"Done"})})]})})]})}export{xe as default};
